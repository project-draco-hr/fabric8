{
  if (initialized.compareAndSet(true,false)) {
    stop();
    if (mBeanServer != null) {
      if (configurationObjectName != null) {
        try {
          mBeanServer.unregisterMBean(configurationObjectName);
        }
 catch (        Throwable e) {
          LOG.error("Failed to unregister mbean: " + configurationObjectName,e);
        }
      }
      if (agentObjectName != null) {
        try {
          mBeanServer.unregisterMBean(agentObjectName);
        }
 catch (        Throwable e) {
          LOG.error("Failed to unregister mbean: " + agentObjectName,e);
        }
      }
      if (jolokiaServer != null) {
        jolokiaServer.stop();
        jolokiaServer=null;
      }
      mBeanServer=null;
    }
  }
}
