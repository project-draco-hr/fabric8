{
  ApmAgentContext apmAgentContext=ApmAgentContext.INSTANCE;
  if (apmAgentContext.isInitialized()) {
    Thread currentThread=Thread.currentThread();
    ThreadMetrics threadMetrics=apmAgentContext.threadMetricsMap.get(currentThread);
    long elapsed=-1;
    if (threadMetrics != null) {
      elapsed=threadMetrics.exit(methodName);
    }
    MethodMetrics methodMetrics=apmAgentContext.methodMetricsMap.get(methodName);
    if (methodMetrics != null) {
      methodMetrics.update(elapsed);
    }
  }
}
