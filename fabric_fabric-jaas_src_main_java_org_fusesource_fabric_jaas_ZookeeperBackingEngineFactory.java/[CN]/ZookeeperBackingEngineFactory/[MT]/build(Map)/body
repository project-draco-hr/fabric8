{
  ZookeeperBackingEngine engine=null;
  this.bundleContext=(BundleContext)options.get(BundleContext.class.getName());
  EncryptionSupport encryptionSupport=new BasicEncryptionSupport(options);
  if (bundleContext != null) {
    ServiceReference ref=bundleContext.getServiceReference(FabricService.class.getName());
    service=(FabricServiceImpl)bundleContext.getService(ref);
    encryptionSupport=new EncryptionSupport(options);
  }
  String path=(String)options.get("path");
  if (path == null) {
    path=ZookeeperBackingEngine.USERS_NODE;
  }
  try {
    ZookeeperProperties users=new ZookeeperProperties(path);
    users.bind(((FabricServiceImpl)service).getCurator());
    engine=new ZookeeperBackingEngine(users,encryptionSupport);
  }
 catch (  Exception e) {
    LOGGER.warn("Cannot initialize engine",e);
  }
 finally {
    return engine;
  }
}
