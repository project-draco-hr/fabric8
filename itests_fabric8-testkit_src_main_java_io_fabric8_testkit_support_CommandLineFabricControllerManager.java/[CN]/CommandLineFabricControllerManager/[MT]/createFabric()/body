{
  if (workDirectory == null) {
    workDirectory=createTempDirectory();
  }
  String version=System.getProperty("fabric8-version","1.1.0-SNAPSHOT");
  String home=System.getProperty("user.home","~");
  String repo=home + "/.m2/repository";
  File distro=new File(repo,"io/fabric8/fabric8-karaf/" + version + "/fabric8-karaf-"+ version+ ".tar.gz");
  FabricAssertions.assertFileExists(distro);
  installDir=new File(workDirectory,"fabric8-karaf-" + version);
  killInstanceProcesses(getInstancesFile());
  if (workDirectory.exists()) {
    Files.recursiveDelete(workDirectory);
  }
  workDirectory.mkdirs();
  executeCommand(workDirectory,"tar","zxf",distro.getAbsolutePath());
  FabricAssertions.assertDirectoryExists(installDir);
  assertTrue("install dir does not exist: " + installDir.getAbsolutePath(),installDir.exists());
  assertTrue("install dir is not a directory: " + installDir.getAbsolutePath(),installDir.isDirectory());
  System.out.println("About to boot up the fabric8 at: " + installDir.getAbsolutePath());
  File shellScript=new File(installDir,startFabricScriptName);
  FabricAssertions.assertFileExists(shellScript);
  executeCommand(installDir,"./" + startFabricScriptName);
  final FabricController restApi=createFabricRestApi();
  Thread.sleep(30 * 1000);
  List<String> containerIds=FabricAssertions.waitForNotEmptyContainerIds(restApi);
  System.out.println("Found containers: " + containerIds);
  return restApi;
}
