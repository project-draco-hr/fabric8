{
  Agent[] agents=new Agent[number];
  try {
    final String zooKeeperUrl=getZooKeeperUrl();
    URI uri=URI.create(url);
    AgentProvider provider=getProvider(uri.getScheme());
    if (provider == null) {
      throw new FabricException("Unable to find an agent provider supporting uri '" + url + "'");
    }
    for (int i=0; i < number; i++) {
      String agentName=name;
      if (number > 1) {
        agentName+=i + 1;
      }
      createAgentConfig("",agentName);
      agents[i]=new AgentImpl(null,agentName,FabricServiceImpl.this);
    }
    provider.create(getMavenRepoURI(),uri,name,zooKeeperUrl,debugAgent,number);
  }
 catch (  FabricException e) {
    throw e;
  }
catch (  Exception e) {
    throw new FabricException(e);
  }
  return agents;
}
