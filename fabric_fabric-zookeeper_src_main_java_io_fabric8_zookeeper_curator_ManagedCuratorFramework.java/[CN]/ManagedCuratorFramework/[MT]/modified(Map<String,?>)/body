{
  String zookeeperURL=getZookeeperURL(configuration);
  if (!Strings.isNullOrEmpty(zookeeperURL)) {
    State prev=state.get();
    Map<String,?> oldConfiguration=prev != null ? prev.configuration : null;
    if (isRestartRequired(oldConfiguration,configuration)) {
      State next=new State(configuration);
      if (state.compareAndSet(prev,next)) {
        executor.submit(next);
        if (prev != null) {
          prev.close();
        }
      }
 else {
        next.close();
      }
    }
  }
}
