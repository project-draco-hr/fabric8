{
  try {
    if (curator != null) {
      curator.getZookeeperClient().stop();
    }
    if (registration != null) {
      registration.unregister();
      registration=null;
    }
    try {
      Closeables.close(curator,true);
    }
 catch (    IOException e) {
    }
    curator=null;
    if (!closed.get()) {
      curator=buildCuratorFramework(configuration);
      curator.getConnectionStateListenable().addListener(this,executor);
      if (curator.getZookeeperClient().isConnected()) {
        stateChanged(curator,ConnectionState.CONNECTED);
      }
      CuratorFrameworkLocator.bindCurator(curator);
    }
  }
 catch (  Throwable th) {
    LOGGER.error("Cannot start curator framework",th);
  }
}
