{
  if (workDirectory == null) {
    workDirectory=createTempDirectory();
  }
  workDirectory.mkdirs();
  String version=System.getProperty("fabric8-version","1.1.0-SNAPSHOT");
  String home=System.getProperty("user.home","~");
  String repo=home + "/.m2/repository";
  File distro=new File(repo,"io/fabric8/fabric8-karaf/" + version + "/fabric8-karaf-"+ version+ ".tar.gz");
  FabricAssertions.assertFileExists(distro);
  executeCommand(workDirectory,"tar","zxf",distro.getAbsolutePath());
  installDir=new File(workDirectory,"fabric8-karaf-" + version);
  FabricAssertions.assertDirectoryExists(installDir);
  assertTrue("install dir does not exist: " + installDir.getAbsolutePath(),installDir.exists());
  assertTrue("install dir is not a directory: " + installDir.getAbsolutePath(),installDir.isDirectory());
  System.out.println("About to boot up the fabric8 at: " + installDir.getAbsolutePath());
  File shellScript=new File(installDir,startFabricScriptName);
  FabricAssertions.assertFileExists(shellScript);
  executeCommand(installDir,"./" + startFabricScriptName);
  final FabricRestApi restApi=createFabricRestApi();
  Thread.sleep(30 * 1000);
  Map<String,String> containerLinks=waitForContainerLinks(restApi);
  System.out.println("Found containers: " + containerLinks.keySet());
  return restApi;
}
