{
  ServerConfig serverConfig=getServerConfig(peerConfig);
  zkServer=new ZooKeeperServer();
  zkServer.setTxnLogFactory(new FileTxnSnapLog(new File(serverConfig.getDataLogDir()),new File(serverConfig.getDataDir())));
  zkServer.setTickTime(serverConfig.getTickTime());
  zkServer.setMinSessionTimeout(serverConfig.getMinSessionTimeout());
  zkServer.setMaxSessionTimeout(serverConfig.getMaxSessionTimeout());
  cnxnFactory=new NIOServerCnxnFactory(){
    protected void configureSaslLogin() throws IOException {
    }
  }
;
  cnxnFactory.configure(serverConfig.getClientPortAddress(),serverConfig.getMaxClientCnxns());
  try {
    LOGGER.debug("Starting ZooKeeper server on address %s",peerConfig.getClientPortAddress());
    cnxnFactory.startup(zkServer);
    LOGGER.debug("Started ZooKeeper server");
  }
 catch (  Exception e) {
    LOGGER.warn(String.format("Failed to start ZooKeeper server, reason : %s",e));
    cnxnFactory.shutdown();
    throw e;
  }
}
