{
  HashSet<String> rc=new HashSet<String>(packages);
  for (  Bundle bundle : bundleContext.getBundles()) {
    if (rc.isEmpty()) {
      break;
    }
    String value=(String)bundle.getHeaders().get("Export-Package");
    if (Strings.notEmpty(value)) {
      Parameters values=new Analyzer().parseHeader(value);
      for (      String packageName : packages) {
        Map<String,String> map=values.get(packageName);
        if (map != null) {
          String version=map.get("version");
          if (version != null) {
            String importedVersion=resolver.resolvePackageVersion(packageName);
            if (importedVersion != null) {
              if (Versions.inRange(version,importedVersion)) {
                rc.remove(packageName);
              }
            }
          }
        }
      }
    }
  }
  return rc;
}
