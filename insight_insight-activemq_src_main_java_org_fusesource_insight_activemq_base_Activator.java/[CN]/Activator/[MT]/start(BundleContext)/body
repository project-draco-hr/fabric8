{
  this.bundleContext=context;
  storageProxy.setContext(context);
  storageProxy.init();
  mbeanServer=lookupMBeanServer();
  if (mbeanServer != null) {
    for (    BrokerPlugin plugin : plugins.values()) {
      try {
        mbeanServer.registerMBean(plugin,getObjectName(plugin));
      }
 catch (      Exception e) {
        LOG.warn("An error occured during mbean server unregistration: " + e,e);
      }
    }
  }
  Hashtable<String,Object> props=new Hashtable<String,Object>();
  props.put(Constants.SERVICE_PID,INSIGHT_ACTIVEMQ_PID);
  registration=bundleContext.registerService(ManagedService.class,this,props);
  commandRegistrations=Arrays.asList();
  Activator.INSTANCE=this;
}
