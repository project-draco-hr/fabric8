{
  int attempts=0;
  JMSException lastException=null;
  while (!started && attempts++ < maxAttempts) {
    try {
      defaultConnection=connectionFactory.createConnection();
      if (clientId != null) {
        defaultConnection.setClientID(clientId);
      }
      defaultConnection.start();
      defaultSession=defaultConnection.createSession(transacted,transacted ? Session.SESSION_TRANSACTED : Session.AUTO_ACKNOWLEDGE);
      started=true;
    }
 catch (    JMSException e) {
      lastException=e;
      LOG.warn("Could not start a connection",e);
      try {
        Thread.sleep(1000);
      }
 catch (      InterruptedException ignore) {
      }
    }
  }
  if (!started) {
    throw lastException;
  }
}
