{
  final Properties instructions=new Properties();
  if (query != null) {
    try {
      final String segments[]=query.split("&");
      for (      String segment : segments) {
        if (segment.trim().length() > 0) {
          final Matcher matcher=INSTRUCTIONS_PATTERN.matcher(segment);
          if (matcher.matches()) {
            instructions.setProperty(matcher.group(1),URLDecoder.decode(matcher.group(2),"UTF-8"));
          }
 else {
            throw new MalformedURLException("Invalid syntax for instruction [" + segment + "]. Take a look at http://www.aqute.biz/Code/Bnd.");
          }
        }
      }
    }
 catch (    UnsupportedEncodingException e) {
      throwAsMalformedURLException("Could not retrieve the instructions from [" + query + "]",e);
    }
  }
  return instructions;
}
