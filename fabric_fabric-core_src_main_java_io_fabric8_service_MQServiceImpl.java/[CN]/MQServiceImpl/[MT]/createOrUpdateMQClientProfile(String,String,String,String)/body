{
  Version version=profileService.getRequiredVersion(versionId);
  Profile parentProfile=null;
  if (Strings.isNotBlank(parentProfileName)) {
    parentProfile=version.getRequiredProfile(parentProfileName);
  }
  if (group == null || profileId == null)   return parentProfile;
  ProfileBuilder builder;
  boolean create=!version.hasProfile(profileId);
  if (create) {
    builder=ProfileBuilder.Factory.create(versionId,profileId);
  }
 else {
    Profile profile=version.getRequiredProfile(profileId);
    builder=ProfileBuilder.Factory.createFrom(profile);
  }
  if (parentProfile != null) {
    builder.addParent(parentProfile);
  }
  Map<String,String> config=builder.getConfiguration(MQ_CONNECTION_FACTORY_PID);
  config=config != null ? new HashMap<>(config) : new HashMap<String,String>();
  config.put(GROUP,group);
  builder.addConfiguration(MQ_CONNECTION_FACTORY_PID,config);
  Profile profile=builder.getProfile();
  return create ? profileService.createProfile(profile) : profileService.updateProfile(profile);
}
