{
  assertValid();
  try {
    stopBundles();
    DataStoreRegistrationHandler dsregHandler=registrationHandler.get();
    BootstrapConfiguration bootConfig=bootstrapConfiguration.get();
    if (options.isClean()) {
      bootConfig=cleanInternal();
    }
    BootstrapCreateHandler createHandler=new BootstrapCreateHandler(bundleContext,bootConfig,dsregHandler);
    createHandler.bootstrapFabric(name,home,options);
    startBundles(options);
    if (options.isWaitForProvision() && options.isAgentEnabled()) {
      createHandler.waitForSuccessfulDeploymentOf(name,options.getProvisionTimeout());
    }
  }
 catch (  RuntimeException rte) {
    throw rte;
  }
catch (  Exception ex) {
    throw new FabricException("Unable to create zookeeper server configuration",ex);
  }
}
