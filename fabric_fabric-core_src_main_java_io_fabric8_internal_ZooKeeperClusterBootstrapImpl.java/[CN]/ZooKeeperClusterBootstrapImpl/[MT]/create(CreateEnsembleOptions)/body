{
  assertValid();
  try {
    ServiceLocator.awaitService(bundleContext,BootstrapComplete.class);
    stopBundles();
    DataStoreRegistrationHandler regHandler=registrationHandler.get();
    BootstrapConfiguration bootConfig=bootstrapConfiguration.get();
    BundleContext syscontext=bundleContext.getBundle(0).getBundleContext();
    if (options.isClean()) {
      bootConfig=cleanInternal(syscontext,bootConfig,regHandler);
    }
    BootstrapCreateHandler createHandler=new BootstrapCreateHandler(bootConfig,regHandler);
    createHandler.bootstrapFabric(name,home,options);
    startBundles(options);
    createHandler.waitForContainerAlive(name,syscontext,30000L);
    if (options.isWaitForProvision() && options.isAgentEnabled()) {
      createHandler.waitForSuccessfulDeploymentOf(name,syscontext,options.getProvisionTimeout());
    }
  }
 catch (  RuntimeException rte) {
    throw rte;
  }
catch (  Exception ex) {
    throw new FabricException("Unable to create zookeeper server configuration",ex);
  }
}
