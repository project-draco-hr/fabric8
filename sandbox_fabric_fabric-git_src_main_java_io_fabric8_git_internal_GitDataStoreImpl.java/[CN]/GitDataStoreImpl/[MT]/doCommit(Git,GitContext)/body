{
  try {
    String message=context.getCommitMessage();
    IllegalStateAssertion.assertTrue(message.length() > 0,"Empty commit message");
    git.add().addFilepattern(".").call();
    git.commit().setMessage(message).call();
    if (--commitsWithoutGC < 0) {
      commitsWithoutGC=MAX_COMMITS_WITHOUT_GC;
      LOGGER.debug("Performing 'git gc' after {} commits",MAX_COMMITS_WITHOUT_GC);
      git.gc().call();
    }
  }
 catch (  GitAPIException ex) {
    throw FabricException.launderThrowable(ex);
  }
}
