{
  final WriteLock writeLock=readWriteLock.writeLock();
  boolean success;
  try {
    success=writeLock.tryLock() || writeLock.tryLock(AQUIRE_LOCK_TIMEOUT,TimeUnit.MILLISECONDS);
  }
 catch (  InterruptedException ex) {
    success=false;
  }
  IllegalStateAssertion.assertTrue(success,"Cannot obtain profile write lock in time");
  return new LockHandle(){
    @Override public void unlock(){
      if (notificationRequired && readWriteLock.getWriteHoldCount() == 1) {
        try {
          dataStore.get().fireChangeNotifications();
        }
  finally {
          notificationRequired=false;
        }
      }
      writeLock.unlock();
    }
  }
;
}
