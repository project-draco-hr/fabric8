{
  Version version=profileService.getRequiredVersion(profile.getVersion());
  List<Profile> profiles=new ArrayList<Profile>();
  for (  String prfId : container.getProfileIds()) {
    Profile p=version.getRequiredProfile(prfId);
    if (!isAncestor(version,prfId,profile)) {
      profiles.add(p);
    }
  }
  profiles.add(profile);
  container.setProfiles(profiles.toArray(new Profile[profiles.size()]));
}
