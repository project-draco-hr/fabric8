{
  assertValid();
  Map<String,String> properties=getDataStoreProperties();
  String username=null;
  String password=null;
  if (isExternalGitConfigured(properties)) {
    username=getExternalUser(properties);
    password=getExternalCredential(properties);
  }
 else {
    username=getContainerLogin();
    password=generateContainerToken(getCurator());
  }
  return new UsernamePasswordCredentialsProvider(username,password);
}
