{
  File catalinaHome=getContainerHome();
  if (!catalinaHome.isDirectory())   throw new IllegalStateException("Not a valid Tomcat home dir: " + catalinaHome);
  String javaArgs=config.getJavaVmArguments() != null ? config.getJavaVmArguments() : "";
  if (!javaArgs.contains("-Xmx")) {
    javaArgs=TomcatContainerConfiguration.DEFAULT_JAVAVM_ARGUMENTS + javaArgs;
  }
  List<String> cmd=new ArrayList<String>();
  cmd.add("java");
  for (  String opt : javaArgs.split("\\s+")) {
    cmd.add(opt);
  }
  String absolutePath=catalinaHome.getAbsolutePath();
  String CLASS_PATH=absolutePath + "/bin/bootstrap.jar" + File.pathSeparator;
  CLASS_PATH+=absolutePath + "/bin/tomcat-juli.jar";
  cmd.add("-classpath");
  cmd.add(CLASS_PATH);
  cmd.add("-Djava.endorsed.dirs=" + absolutePath + "/endorsed");
  cmd.add("-Dcatalina.base=" + absolutePath);
  cmd.add("-Dcatalina.home=" + absolutePath);
  cmd.add("-Djava.io.tmpdir=" + absolutePath + "/temp");
  cmd.add("org.apache.catalina.startup.Bootstrap");
  cmd.add("start");
  ProcessBuilder processBuilder=new ProcessBuilder(cmd);
  processBuilder.redirectErrorStream(true);
  processBuilder.directory(new File(catalinaHome,"bin"));
  startProcess(processBuilder,config);
}
