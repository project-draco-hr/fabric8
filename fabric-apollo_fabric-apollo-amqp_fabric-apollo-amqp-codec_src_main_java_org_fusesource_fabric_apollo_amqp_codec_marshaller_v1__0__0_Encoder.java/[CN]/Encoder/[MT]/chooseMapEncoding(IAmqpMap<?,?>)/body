{
  int size=0;
  for (  Map.Entry<? extends AmqpType<?,?>,? extends AmqpType<?,?>> me : map) {
    if (me.getKey() != null) {
      size+=me.getKey().getBuffer(MARSHALLER).getEncoded().getEncodedSize();
    }
    if (me.getValue() != null) {
      size+=me.getValue().getBuffer(MARSHALLER).getEncoded().getEncodedSize();
    }
 else {
      size+=createAmqpNull(null).getBuffer(MARSHALLER).getEncoded().getEncodedSize();
    }
    if (size > 254) {
      return AmqpMapMarshaller.MAP_ENCODING.MAP32;
    }
  }
  return AmqpMapMarshaller.MAP_ENCODING.MAP8;
}
