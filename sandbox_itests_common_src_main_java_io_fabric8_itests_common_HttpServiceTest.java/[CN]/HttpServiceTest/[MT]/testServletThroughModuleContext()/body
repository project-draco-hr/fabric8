{
  Runtime runtime=RuntimeLocator.getRequiredRuntime();
  Module module=runtime.getModule(getClass().getClassLoader());
  ModuleContext context=module.getModuleContext();
  ServiceReference<HttpService> sref=context.getServiceReference(HttpService.class);
  HttpService httpService=context.getService(sref);
  String reqspec="/fabric/httpsrv/servlet?test=module";
  try {
    assertNotAvailable(reqspec);
    String servletAlias=getRuntimeAwareAlias("/httpsrv/servlet");
    httpService.registerServlet(servletAlias,new HttpServiceServlet(module),null,null);
    Assert.assertEquals("http-service:1.0.0",performCall(reqspec));
    httpService.unregister(servletAlias);
    assertNotAvailable(reqspec);
    assertNotAvailable(reqspec);
  }
  finally {
    context.ungetService(sref);
  }
}
