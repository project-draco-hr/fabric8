{
  MavenFacet maven=project.getFacet(MavenFacet.class);
  Model pom=maven.getModel();
  boolean springBoot=hasSpringBootMavenPlugin(project);
  String packaging=getProjectPackaging(project);
  boolean war=packaging != null && packaging.equals("war");
  boolean bundle=packaging != null && packaging.equals("bundle");
  boolean jar=packaging == null || packaging.equals("jar");
  Map<String,String> envs=new LinkedHashMap<>();
  if (springBoot) {
    envs.put("JAR","${project.artifactId}-${project.version}.war");
    envs.put("JAVA_OPTIONS","-Djava.security.egd=/dev/./urandom");
  }
 else   if (war) {
    envs.put("CATALINA_OPTS","-javaagent:/opt/tomcat/jolokia-agent.jar=host=0.0.0.0,port=8778");
  }
 else   if (jar && main != null) {
    envs.put("JAVA_MAIN_CLASS",main);
  }
  MavenPluginBuilder pluginBuilder;
  ConfigurationBuilder configurationBuilder;
  MavenPlugin plugin=MavenHelpers.findPlugin(project,"org.jolokia","docker-maven-plugin");
  if (plugin != null) {
    LOG.info("Found existing docker-maven-plugin");
    pluginBuilder=null;
    configurationBuilder=null;
  }
 else {
    LOG.info("Adding docker-maven-plugin");
    pluginBuilder=MavenPluginBuilder.create().setCoordinate(MavenHelpers.createCoordinate("org.jolokia","docker-maven-plugin",VersionHelper.dockerVersion()));
    configurationBuilder=ConfigurationBuilder.create(pluginBuilder);
    pluginBuilder.setConfiguration(configurationBuilder);
  }
  if (pluginBuilder != null) {
    String commandShell=null;
    if (bundle) {
      commandShell="/usr/bin/deploy-and-start";
    }
    setupDockerConfiguration(configurationBuilder,envs,commandShell,springBoot,war,bundle,jar);
    MavenPluginFacet pluginFacet=project.getFacet(MavenPluginFacet.class);
    pluginFacet.addPlugin(pluginBuilder);
  }
  setupDockerProperties(project,fromImage);
}
