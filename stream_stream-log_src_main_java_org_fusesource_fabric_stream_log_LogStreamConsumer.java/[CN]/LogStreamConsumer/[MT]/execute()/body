{
  CamelContext context=new DefaultCamelContext();
  context.disableJMX();
  context.addComponent("activemq",ActiveMQComponent.activeMQComponent(broker));
  context.addRoutes(new RouteBuilder(){
    public void configure() throws Exception {
      RouteDefinition route=from("activemq:" + source);
      if (uncompress) {
        route=route.process(new SnappyDecompressor());
      }
      route.to(target);
    }
  }
);
  context.start();
synchronized (this) {
    while (true) {
      this.wait();
    }
  }
}
