{
  final String uuid=UuidGenerator.getUUID();
  DataByteArrayOutputStream baos=new DataByteArrayOutputStream();
  baos.writeInt(0);
  ObjectOutputStream oos=new ObjectOutputStream(baos);
  oos.writeUTF(uuid);
  oos.writeUTF(service);
  oos.writeUTF(method.getName());
  oos.writeObject(method.getParameterTypes());
  oos.writeObject(args);
  final Buffer command=baos.toBuffer();
  BufferEditor editor=command.buffer().bigEndianEditor();
  editor.writeInt(command.length);
  final ResponseFuture future=new ResponseFuture(classLoader);
  queue.execute(new Runnable(){
    public void run(){
      try {
        TransportPool pool=transports.get(address);
        if (pool == null) {
          pool=new InvokerTransportPool(address,queue);
          transports.put(address,pool);
          pool.start();
        }
        requests.put(uuid,future);
        pool.offer(command);
      }
 catch (      Exception e) {
        LOGGER.info("Error while sending request",e);
      }
    }
  }
);
  return future.get(5,TimeUnit.SECONDS);
}
