{
  CamelCatalog catalog=new DefaultCamelCatalog();
  final List<CamelEndpointDetails> endpoints=new ArrayList<>();
  final Set<File> javaFiles=new LinkedHashSet<File>();
  for (  String dir : project.getCompileSourceRoots()) {
    findJavaFiles(new File(dir),javaFiles);
  }
  if (includeTest) {
    for (    String dir : project.getTestCompileSourceRoots()) {
      findJavaFiles(new File(dir),javaFiles);
    }
  }
  final Set<File> xmlFiles=new LinkedHashSet<File>();
  for (  Resource dir : project.getResources()) {
    findXmlFiles(new File(dir.getDirectory()),xmlFiles);
  }
  if (includeTest) {
    for (    Resource dir : project.getTestResources()) {
      findXmlFiles(new File(dir.getDirectory()),xmlFiles);
    }
  }
  for (  File file : javaFiles) {
    try {
      String fqn=file.getPath();
      String baseDir=".";
      JavaClassSource clazz=(JavaClassSource)Roaster.parse(file);
      if (clazz != null) {
        RouteBuilderParser.parseRouteBuilder(clazz,baseDir,fqn,endpoints);
      }
    }
 catch (    Exception e) {
      getLog().warn("Error parsing java file " + file + " code due "+ e.getMessage());
    }
  }
  for (  File file : xmlFiles) {
    try {
      String fqn=file.getPath();
      String baseDir=".";
      InputStream is=new FileInputStream(file);
      XmlRouteParser.parseXmlRoute(is,baseDir,fqn,endpoints);
      is.close();
    }
 catch (    Exception e) {
      getLog().warn("Error parsing xml file " + file + " code due "+ e.getMessage());
    }
  }
  boolean allOk=true;
  for (  CamelEndpointDetails detail : endpoints) {
    EndpointValidationResult result=catalog.validateEndpointProperties(detail.getEndpointUri());
    if (!result.isSuccess()) {
      allOk=false;
      String source=String.format("File: %s",detail.getFileName());
      String out=result.summaryErrorMessage();
      getLog().warn(source + "\n" + out);
    }
  }
  if (allOk) {
    getLog().info("Camel endpoint validation successful");
  }
}
