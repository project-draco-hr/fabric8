{
  String bsn=attributes.getValue(Constants.BUNDLE_SYMBOLICNAME);
  if (bsn != null && bsn.indexOf(';') > 0) {
    bsn=bsn.substring(0,bsn.indexOf(';'));
  }
  Version ver=VersionTable.getVersion(attributes.getValue(Constants.BUNDLE_VERSION));
  Map<VersionRange,Map<String,String>> ranges=metadata != null && bsn != null ? metadata.get(bsn) : null;
  if (ranges != null) {
    for (    Map.Entry<VersionRange,Map<String,String>> entry2 : ranges.entrySet()) {
      if (entry2.getKey().contains(ver)) {
        for (        Map.Entry<String,String> entry3 : entry2.getValue().entrySet()) {
          String val=attributes.getValue(entry3.getKey());
          if (entry3.getValue().startsWith("=")) {
            val=entry3.getValue().substring(1);
          }
 else {
            if (val != null) {
              val+="," + entry3.getValue();
            }
 else {
              val=entry3.getValue();
            }
          }
          attributes.putValue(entry3.getKey(),val);
        }
      }
    }
  }
  return attributes;
}
