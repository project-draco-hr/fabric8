{
  chechNotNull(in);
  HashMap<String,HttpProxyRule> map=new HashMap<String,HttpProxyRule>();
  try {
    JsonNode config=OM.readTree(in);
    JsonNode globalCookiePath=config.get("cookiePath");
    JsonNode globalDomain=config.get("cookieDomain");
    for (    JsonNode entry : getRuleBase(config)) {
      String rule=entry.get("rule").asText();
      map.put(rule,new HttpProxyRule(rule).to(entry.get("to").asText()).setCookiePath(getGlobal(entry,globalCookiePath,"cookiePath")).setCookieDomain(getGlobal(entry,globalDomain,"cookieDomain")));
    }
    return map;
  }
 catch (  IOException e) {
    throw new RuntimeException(e.getMessage(),e);
  }
 finally {
    safeClose(in);
  }
}
