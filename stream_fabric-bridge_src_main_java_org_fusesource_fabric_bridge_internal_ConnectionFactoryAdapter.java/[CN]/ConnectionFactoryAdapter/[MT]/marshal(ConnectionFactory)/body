{
  if (factory instanceof Referenceable) {
    Referenceable referenceable=(Referenceable)factory;
    Reference reference=referenceable.getReference();
    try {
      ByteArrayOutputStream byteStream=new ByteArrayOutputStream();
      ObjectOutputStream stream=new ObjectOutputStream(byteStream);
      stream.writeObject(reference);
      stream.flush();
      byte[] bytes=byteStream.toByteArray();
      stream.close();
      return bytes;
    }
 catch (    IOException e) {
      throw new JAXBException("Error marshalling connection factory " + factory + " : "+ e.getMessage(),e);
    }
  }
 else {
    throw new JAXBException("Not a JNDI Referenceable Connection factory " + factory);
  }
}
