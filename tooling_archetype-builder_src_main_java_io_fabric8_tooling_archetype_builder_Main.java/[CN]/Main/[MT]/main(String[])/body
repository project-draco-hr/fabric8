{
  try {
    String basedir=System.getProperty("basedir");
    if (basedir == null) {
      basedir=".";
    }
    File catalogFile=new File(basedir,"target/archetype-catalog.xml").getCanonicalFile();
    File quickStartJavaSrcDir=new File(basedir,"../../quickstarts/java").getCanonicalFile();
    File quickStartKarafSrcDir=new File(basedir,"../../quickstarts/karaf").getCanonicalFile();
    File quickStartKarafBeginnerSrcDir=new File(basedir,"../../quickstarts/karaf/beginner").getCanonicalFile();
    File quickStartKarafCxfSrcDir=new File(basedir,"../../quickstarts/karaf/cxf").getCanonicalFile();
    File quickStartSpringBootSrcDir=new File(basedir,"../../quickstarts/spring-boot").getCanonicalFile();
    File quickStartWarSrcDir=new File(basedir,"../../quickstarts/war").getCanonicalFile();
    File outputDir=args.length > 0 ? new File(args[0]) : new File(basedir,"../archetypes");
    ArchetypeBuilder builder=new ArchetypeBuilder(catalogFile);
    builder.configure();
    List<String> dirs=new ArrayList<>();
    try {
      builder.generateArchetypes("java",quickStartJavaSrcDir,outputDir,false,dirs);
      builder.generateArchetypes("karaf",quickStartKarafSrcDir,outputDir,false,dirs);
      builder.generateArchetypes("karaf",quickStartKarafBeginnerSrcDir,outputDir,false,dirs);
      builder.generateArchetypes("karaf",quickStartKarafCxfSrcDir,outputDir,false,dirs);
      builder.generateArchetypes("springboot",quickStartSpringBootSrcDir,outputDir,false,dirs);
      builder.generateArchetypes("war",quickStartWarSrcDir,outputDir,false,dirs);
    }
  finally {
      LOG.debug("Completed the generation. Closing!");
      builder.close();
    }
    StringBuffer sb=new StringBuffer();
    for (    String dir : dirs) {
      sb.append("\n\t<module>" + dir + "</module>");
    }
    LOG.info("Done creating archetypes:\n{}\n\n",sb.toString());
  }
 catch (  Exception e) {
    LOG.error("Caught: " + e.getMessage(),e);
  }
}
