{
  System.err.println("Create test profile:" + profile + " in datastore.");
  List<String> versions=Lists.transform(Arrays.<Version>asList(fabricService.getVersions()),new Function<Version,String>(){
    @Override public String apply(    Version version){
      return version.getId();
    }
  }
);
  if (!versions.contains(version)) {
    fabricService.createVersion(version);
  }
  fabricService.getDataStore().createProfile(version,profile);
  GitUtils.waitForBranchUpdate(curator,version);
  GitUtils.checkoutBranch(git,"origin",version);
  PullResult pullResult=git.pull().setCredentialsProvider(getCredentialsProvider()).setRebase(true).call();
  assertTrue(pullResult.isSuccessful());
  String relativeProfileDir="fabric/profiles/" + profile + ".profile";
  File testProfileDir=new File(git.getRepository().getWorkTree(),relativeProfileDir);
  assertTrue(testProfileDir.exists());
  File testProfileConfig=new File(testProfileDir,"io.fabric8.agent.properties");
  assertTrue(testProfileConfig.exists());
}
