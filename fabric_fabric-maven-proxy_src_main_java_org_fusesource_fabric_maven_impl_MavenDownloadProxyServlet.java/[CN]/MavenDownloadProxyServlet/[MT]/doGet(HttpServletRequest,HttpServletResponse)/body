{
  InputStream is=null;
  BufferedInputStream bis=null;
  try {
    String path=req.getPathInfo();
    if (path != null && path.startsWith("/")) {
      path=path.substring(1);
    }
    File artifactFile=download(path);
    if (artifactFile == null) {
      resp.setStatus(HttpServletResponse.SC_NOT_FOUND);
      return;
    }
    try {
      is=new FileInputStream(artifactFile);
      LOGGER.log(Level.INFO,String.format("Writing response for file : %s",path));
      resp.setStatus(HttpServletResponse.SC_OK);
      resp.setContentType("application/octet-stream");
      resp.setDateHeader("Date",System.currentTimeMillis());
      resp.setHeader("Connection","close");
      resp.setContentLength(is.available());
      resp.setHeader("Server","MavenProxy Proxy/" + FabricConstants.FABRIC_VERSION);
      byte buffer[]=new byte[8192];
      int length;
      while ((length=is.read(buffer)) != -1) {
        resp.getOutputStream().write(buffer,0,length);
      }
      resp.getOutputStream().flush();
    }
  finally {
      if (is != null) {
        try {
          is.close();
        }
 catch (        Exception ex) {
        }
      }
    }
  }
 catch (  InvalidMavenArtifactRequest ex) {
    resp.sendError(HttpServletResponse.SC_BAD_REQUEST,ex.getMessage());
  }
catch (  Exception ex) {
    resp.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);
  }
}
