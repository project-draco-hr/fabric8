{
  InputStream inputStream=null;
  String path=req.getPathInfo();
  if (path != null && path.startsWith("/")) {
    path=path.substring(1);
  }
  File artifactFile=download(path);
  if (artifactFile == null) {
    resp.setStatus(HttpServletResponse.SC_NOT_FOUND);
    return;
  }
  try {
    inputStream=new FileInputStream(artifactFile);
    LOGGER.log(Level.INFO,String.format("Writing response for file : %s",path));
    resp.setStatus(HttpServletResponse.SC_OK);
    resp.setContentType("application/octet-stream");
    resp.setDateHeader("Date",System.currentTimeMillis());
    resp.setHeader("Connection","close");
    resp.setContentLength(inputStream.available());
    resp.setHeader("Server","MavenProxy Proxy/" + FabricConstants.FABRIC_VERSION);
    byte buffer[]=new byte[4096];
    int length;
    while ((length=inputStream.read(buffer)) != -1) {
      resp.getOutputStream().write(buffer,0,length);
    }
    resp.getOutputStream().flush();
  }
  finally {
    if (inputStream != null) {
      try {
        inputStream.close();
      }
 catch (      Exception ex) {
      }
    }
  }
}
