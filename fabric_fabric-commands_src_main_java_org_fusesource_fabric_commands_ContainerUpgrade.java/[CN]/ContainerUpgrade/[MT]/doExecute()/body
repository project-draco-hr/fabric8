{
  checkFabricAvailable();
  Version version=fabricService.getVersion(this.version);
  if (containerIds == null || containerIds.isEmpty()) {
    containerIds=Arrays.asList(fabricService.getCurrentContainer().getId());
  }
  List<Container> toUpgrade=new ArrayList<Container>();
  List<Container> same=new ArrayList<Container>();
  for (  String containerName : containerIds) {
    Container container=fabricService.getContainer(containerName);
    int num=canUpgrade(version,container);
    if (num < 0) {
      throw new IllegalArgumentException("Container " + container.getId() + " already has a higher version "+ container.getVersion()+ " than the requested version "+ version+ ".");
    }
 else     if (num == 0) {
      same.add(container);
    }
 else {
      toUpgrade.add(container);
    }
  }
  for (  Container container : same) {
    System.out.println("Container " + container.getId() + " is already at version "+ version);
  }
  for (  Container container : toUpgrade) {
    Version oldVersion=container.getVersion();
    container.setVersion(version);
    log.info("Upgraded container {} from {} to {}",new Object[]{container,oldVersion,version});
    System.out.println("Upgraded container " + container.getId() + " from version "+ oldVersion+ " to "+ version);
  }
  return null;
}
