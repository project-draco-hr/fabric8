{
  for (int i=0; i < 500; i++) {
    AmqpTransfer transfer=createAmqpTransfer();
    transfer.setDeliveryTag(new Buffer(UUID.randomUUID().toString().getBytes()));
    transfer.setHandle(0);
    transfer.setTransferId(i + 1);
    transfer.setSettled(true);
    AmqpMessage message=new AmqpMessage();
    message.setHeader(createAmqpHeader());
    message.setProperties(createAmqpProperties());
    message.add(new Buffer(("Hello World Message #" + i + "!").getBytes()));
    message.setFooter(createAmqpFooter());
    transfer.setFragments(createMultiple());
    transfer.getFragments().setValue(message.construct());
    AmqpFrame in=new AmqpFrame(transfer);
    byte b[]=marshalAmqpFrame(in);
    AmqpFrame out=unmarshalAmqpFrame(b);
    Assert.assertTrue(in + " != " + out,in.equals(out));
  }
}
