{
  final Session session=connection.createSession();
  final Receiver receiver=session.createReceiver();
  receiver.setOnDetach(new Runnable(){
    public void run(){
      session.end(new Runnable(){
        public void run(){
          connection.close();
        }
      }
);
    }
  }
);
  receiver.getSourceOptionsMap().put(createAmqpSymbol("batch-size"),createAmqpLong(batch_size));
  receiver.setAddress(address);
  receiver.setListener(this);
  receiver.attach(new Runnable(){
    public void run(){
      println("Attached receiver...");
      receiver.addLinkCredit(batch_size);
    }
  }
);
}
