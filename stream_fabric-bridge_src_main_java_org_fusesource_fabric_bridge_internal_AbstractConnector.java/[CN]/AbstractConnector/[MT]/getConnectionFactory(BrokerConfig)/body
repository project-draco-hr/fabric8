{
  if (brokerConfig.getBrokerUrl() != null) {
    PooledConnectionFactory pooledConnectionFactory=null;
    if (brokerConfig.getUserName() != null) {
      ActiveMQConnectionFactory connectionFactory=new ActiveMQConnectionFactory();
      connectionFactory.setUserName(brokerConfig.getUserName());
      connectionFactory.setPassword(brokerConfig.getPassword());
      pooledConnectionFactory=new PooledConnectionFactory();
      pooledConnectionFactory.setConnectionFactory(connectionFactory);
    }
 else {
      pooledConnectionFactory=new PooledConnectionFactory(brokerConfig.getBrokerUrl());
    }
    pooledConnectionFactory.setMaxConnections(brokerConfig.getMaxConnections());
    if (brokerConfig.getMaxConnections() > 0) {
      pooledConnectionFactory.setMaxConnections(brokerConfig.getMaxConnections());
    }
    return pooledConnectionFactory;
  }
  return brokerConfig.getConnectionFactory();
}
