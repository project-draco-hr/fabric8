{
  Map<String,Service> servicesMap=KubernetesHelper.getServiceMap(kubernetes);
  Map<String,ReplicationController> controllerMap=KubernetesHelper.getReplicationControllerMap(kubernetes);
  Map<String,Pod> podMap=KubernetesHelper.getPodMap(kubernetes);
  AppViewSnapshot snapshot=new AppViewSnapshot(servicesMap,controllerMap,podMap);
  for (  Service service : servicesMap.values()) {
    String appPath=getAppPath(getId(service));
    if (appPath != null) {
      AppViewDetails dto=snapshot.getOrCreateAppView(appPath,service.getNamespace());
      dto.addService(service);
    }
  }
  for (  ReplicationController controller : controllerMap.values()) {
    String appPath=getAppPath(getId(controller));
    if (appPath != null) {
      AppViewDetails dto=snapshot.getOrCreateAppView(appPath,controller.getNamespace());
      dto.addController(controller);
    }
  }
  snapshotCache.set(snapshot);
  return snapshot;
}
