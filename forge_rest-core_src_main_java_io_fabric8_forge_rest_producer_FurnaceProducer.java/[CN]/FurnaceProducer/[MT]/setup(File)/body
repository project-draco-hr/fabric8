{
  furnace=FurnaceFactory.getInstance(Thread.currentThread().getContextClassLoader(),Thread.currentThread().getContextClassLoader());
  furnace.addRepository(AddonRepositoryMode.IMMUTABLE,repoDir);
  Future<Furnace> future=furnace.startAsync();
  try {
    future.get();
  }
 catch (  InterruptedException|ExecutionException e) {
    throw new RuntimeException("Furnace failed to start.",e);
  }
  AddonRegistry addonRegistry=furnace.getAddonRegistry();
  commandFactory=addonRegistry.getServices(CommandFactory.class).get();
  controllerFactory=(CommandControllerFactory)addonRegistry.getServices(CommandControllerFactory.class.getName()).get();
}
