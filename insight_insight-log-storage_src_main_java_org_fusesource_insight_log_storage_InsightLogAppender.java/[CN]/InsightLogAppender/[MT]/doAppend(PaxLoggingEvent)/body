{
  try {
    if ("TRACE".equals(paxLoggingEvent.getLevel().toString().toUpperCase()) && !paxLoggingEvent.getProperties().containsKey("trace-id")) {
      return;
    }
    StringBuilder writer=new StringBuilder();
    writer.append("{ \"host\" : ");
    quote(name,writer);
    writer.append(",\n  \"timestamp\" : ");
    quote(formatDate(paxLoggingEvent.getTimeStamp()),writer);
    writer.append(",\n  \"level\" : ");
    quote(paxLoggingEvent.getLevel().toString(),writer);
    writer.append(",\n  \"logger\" : ");
    quote(paxLoggingEvent.getLoggerName(),writer);
    writer.append(",\n  \"thread\" : ");
    quote(paxLoggingEvent.getThreadName(),writer);
    writer.append(",\n  \"message\" : ");
    quote(paxLoggingEvent.getMessage(),writer);
    String[] throwable=paxLoggingEvent.getThrowableStrRep();
    if (throwable != null) {
      writer.append(",\n  \"exception\" : [");
      for (int i=0; i < throwable.length; i++) {
        if (i != 0)         writer.append(", ");
        quote(throwable[i],writer);
      }
      writer.append("]");
    }
    writer.append(",\n  \"properties\" : { ");
    boolean first=true;
    for (    Object key : paxLoggingEvent.getProperties().keySet()) {
      if (first) {
        first=false;
      }
 else {
        writer.append(", ");
      }
      quote(key.toString(),writer);
      writer.append(": ");
      quote(paxLoggingEvent.getProperties().get(key).toString(),writer);
    }
    writer.append(" }");
    writer.append("\n}");
    storage.store(type,paxLoggingEvent.getTimeStamp(),writer.toString());
  }
 catch (  Exception e) {
    LOGGER.warn("Error appending log to storage",e);
  }
}
