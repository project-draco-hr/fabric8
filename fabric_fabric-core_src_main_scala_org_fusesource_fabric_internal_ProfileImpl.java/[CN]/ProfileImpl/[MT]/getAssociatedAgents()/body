{
  try {
    ArrayList<Agent> rc=new ArrayList<Agent>();
    Agent[] agents=service.getAgents();
    for (    Agent agent : agents) {
      if (!agent.getVersion().getName().equals(getVersion())) {
        continue;
      }
      for (      Profile p : agent.getProfiles()) {
        if (this.equals(p)) {
          rc.add(agent);
          break;
        }
      }
    }
    return rc.toArray(new Agent[0]);
  }
 catch (  Exception e) {
    throw new FabricException(e);
  }
}
