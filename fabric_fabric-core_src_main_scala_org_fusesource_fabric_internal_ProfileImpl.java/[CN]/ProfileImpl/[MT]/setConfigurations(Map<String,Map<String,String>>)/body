{
  if (isLocked()) {
    throw new UnsupportedOperationException("The profile " + id + " is locked and can not be modified");
  }
  try {
    IZKClient zooKeeper=service.getZooKeeper();
    Map<String,Map<String,String>> oldCfgs=getConfigurations();
    String path=ZkPath.CONFIG_VERSIONS_PROFILE.getPath(version,id);
    for (    String pid : configurations.keySet()) {
      oldCfgs.remove(pid);
      byte[] data=toBytes(toProperties(configurations.get(pid)));
      String p=path + "/" + pid+ ".properties";
      ZooKeeperUtils.set(zooKeeper,p,data);
    }
    for (    String key : oldCfgs.keySet()) {
      zooKeeper.deleteWithChildren(path + "/" + key+ ".properties");
    }
  }
 catch (  Exception e) {
    throw new FabricException(e);
  }
}
