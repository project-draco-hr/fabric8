{
  maybeDeleteProfile(newId,force);
  for (  Profile profile : this.getProfiles()) {
    if (profileId.equals(profile.getId())) {
      Profile targetProfile=this.createProfile(newId);
      targetProfile.setParents(profile.getParents());
      targetProfile.setConfigurations(profile.getConfigurations());
      for (      Map.Entry<String,String> entry : profile.getAttributes().entrySet()) {
        targetProfile.setAttribute(entry.getKey(),entry.getValue());
      }
      for (      Container container : profile.getAssociatedContainers()) {
        Profile[] containerProfiles=container.getProfiles();
        Set<Profile> profileSet=new HashSet<Profile>(Arrays.asList(containerProfiles));
        profileSet.remove(profile);
        profileSet.add(targetProfile);
        container.setProfiles(profileSet.toArray(new Profile[profileSet.size()]));
      }
      maybeDeleteProfile(profileId,true);
      return;
    }
  }
}
