{
  try {
    String path=options.getPath();
    String host=options.getHost();
    String ip=InetAddress.getByName(host).getHostAddress();
    if (host == null) {
      throw new IllegalArgumentException("Host name not specified.");
    }
    int port=options.getPort();
    if (port == -1) {
      port=22;
    }
    String containerName=options.getName();
    CreateSshContainerMetadata metadata=new CreateSshContainerMetadata();
    metadata.setCreateOptions(options);
    metadata.setContainerName(containerName);
    String script=buildInstallAndStartScript(containerName,options);
    LOGGER.debug("Running script on host {}:\n{}",host,script);
    Session session=null;
    try {
      session=createSession(options);
      if (options.doUploadDistribution()) {
        uploadTo(session,options.getProxyUri().resolve("io/fabric8/fabric8-karaf/" + FabricConstants.FABRIC_VERSION + "/fabric8-karaf-"+ FabricConstants.FABRIC_VERSION+ ".zip").toURL(),"/tmp/fabric8-karaf-" + FabricConstants.FABRIC_VERSION + ".zip");
      }
      runScriptOnHost(session,script);
    }
 catch (    Throwable ex) {
      metadata.setFailure(ex);
    }
 finally {
      if (session != null) {
        session.disconnect();
      }
    }
    return metadata;
  }
 catch (  Exception e) {
    throw FabricException.launderThrowable(e);
  }
}
