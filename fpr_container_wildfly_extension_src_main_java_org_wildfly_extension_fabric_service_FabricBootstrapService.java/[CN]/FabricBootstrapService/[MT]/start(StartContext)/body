{
  LOGGER.info("Activating Fabric Subsystem");
  final CountDownLatch latch=new CountDownLatch(1);
  final ModuleContext syscontext=injectedModuleContext.getValue();
  ServiceListener listener=new ServiceListener(){
    @Override public void serviceChanged(    ServiceEvent event){
      if (event.getType() == ServiceEvent.REGISTERED) {
        syscontext.removeServiceListener(this);
        latch.countDown();
      }
    }
  }
;
  syscontext.addServiceListener(listener,"(objectClass=" + FabricService.class.getName() + ")");
  Runtime runtime=injectedRuntime.getValue();
  ModuleClassLoader classLoader=(ModuleClassLoader)getClass().getClassLoader();
  try {
    URL url=classLoader.getResource(JarFile.MANIFEST_NAME);
    Manifest manifest=new Manifest(url.openStream());
    Dictionary<String,String> headers=new ManifestHeadersProvider(manifest).getHeaders();
    module=runtime.installModule(classLoader,headers);
    ModuleEntriesProvider entriesProvider=new ClassLoaderEntriesProvider(module);
    Attachable attachable=AbstractModule.assertAbstractModule(module);
    attachable.putAttachment(AbstractModule.MODULE_ENTRIES_PROVIDER_KEY,entriesProvider);
    module.start();
  }
 catch (  RuntimeException rte) {
    throw rte;
  }
catch (  Exception ex) {
    throw new StartException(ex);
  }
  try {
    if (!latch.await(5,TimeUnit.SECONDS)) {
      throw new StartException("Cannot obtain FabricService");
    }
  }
 catch (  InterruptedException ex) {
  }
  ServiceReference<FabricService> sref=syscontext.getServiceReference(FabricService.class);
  fabricService=syscontext.getService(sref);
  Properties brandingProperties=new Properties();
  String resname="/META-INF/branding.properties";
  try {
    URL brandingURL=getClass().getResource(resname);
    brandingProperties.load(brandingURL.openStream());
  }
 catch (  IOException e) {
    throw new StartException("Cannot read branding properties from: " + resname);
  }
  System.out.println(brandingProperties.getProperty("welcome"));
}
