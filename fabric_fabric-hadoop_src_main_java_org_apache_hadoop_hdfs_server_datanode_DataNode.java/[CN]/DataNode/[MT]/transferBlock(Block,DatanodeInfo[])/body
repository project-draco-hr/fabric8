{
  if (!data.isValidBlock(block)) {
    String errStr="Can't send invalid " + block;
    LOG.info(errStr);
    notifyNamenode(DatanodeProtocol.INVALID_BLOCK,errStr);
    return;
  }
  long onDiskLength=data.getLength(block);
  if (block.getNumBytes() > onDiskLength) {
    namenode.reportBadBlocks(new LocatedBlock[]{new LocatedBlock(block,new DatanodeInfo[]{new DatanodeInfo(dnRegistration)})});
    LOG.info("Can't replicate " + block + " because on-disk length "+ onDiskLength+ " is shorter than NameNode recorded length "+ block.getNumBytes());
    return;
  }
  int numTargets=xferTargets.length;
  if (numTargets > 0) {
    if (LOG.isInfoEnabled()) {
      StringBuilder xfersBuilder=new StringBuilder();
      for (int i=0; i < numTargets; i++) {
        xfersBuilder.append(xferTargets[i].getName());
        xfersBuilder.append(" ");
      }
      LOG.info(dnRegistration + " Starting thread to transfer " + block+ " to "+ xfersBuilder);
    }
    new Daemon(new DataTransfer(xferTargets,block,this)).start();
  }
}
