{
  if (!from.isDirectory()) {
    throw new IllegalStateException("Should only be invoked on the profiles directory but was given file " + from);
  }
  String name=from.getName();
  String pattern=path + (path.length() > 0 && !path.endsWith(File.separator) ? File.separator : "") + name;
  File[] profiles=from.listFiles();
  File toFile=new File(toDir,name);
  if (profiles != null) {
    for (    File profileDir : profiles) {
      if (isProfileDirectory(profileDir)) {
        String profileId=profileDir.getName();
        String toProfileDirName=convertProfileIdToDirectory(profileId);
        File toProfileDir=new File(toFile,toProfileDirName);
        toProfileDir.mkdirs();
        recursiveCopyAndAdd(git,profileDir,toProfileDir,pattern,true);
      }
 else {
        recursiveCopyAndAdd(git,profileDir,toFile,pattern,false);
      }
    }
  }
  git.add().addFilepattern(fixFilePattern(pattern)).call();
}
