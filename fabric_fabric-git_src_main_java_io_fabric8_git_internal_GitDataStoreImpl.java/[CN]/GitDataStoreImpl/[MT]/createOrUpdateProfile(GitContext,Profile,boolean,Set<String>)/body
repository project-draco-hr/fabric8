{
  assertWriteLock();
  IllegalStateAssertion.assertFalse(context.isRequirePull(),"Invalid pull requirement");
  IllegalStateAssertion.assertFalse(context.isRequireCommit(),"Invalid commit requirement");
  IllegalStateAssertion.assertFalse(context.isRequirePush(),"Invalid push requirement");
  String versionId=profile.getVersion();
  String profileId=profile.getId();
  if (!profiles.contains(profileId)) {
    List<Profile> parents=profile.getParents();
    for (    Profile parent : parents) {
      createOrUpdateProfile(context,parent,allowCreate,profiles);
    }
    if (allowCreate) {
      createProfileDirectoryAfterCheckout(context,versionId,profileId);
    }
    Map<String,byte[]> fileConfigurations=profile.getFileConfigurations();
    setFileConfigurationsInternal(context,versionId,profileId,fileConfigurations);
    if (context.getCommitMessage().length() == 0) {
      context.commitMessage("WARNING - Profile with no content: " + versionId + "/"+ profileId);
    }
    profiles.add(profileId);
  }
  return profileId;
}
