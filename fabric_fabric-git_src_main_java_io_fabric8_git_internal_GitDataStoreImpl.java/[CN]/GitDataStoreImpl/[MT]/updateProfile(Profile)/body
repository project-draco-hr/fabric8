{
  LockHandle writeLock=aquireWriteLock();
  try {
    assertValid();
    Profile wasProfile=getRequiredProfile(profile.getVersion(),profile.getId());
    LOGGER.info("Update " + Profiles.getProfileDifference(wasProfile,profile));
    GitOperation<String> gitop=new GitOperation<String>(){
      public String call(      Git git,      GitContext context) throws Exception {
        checkoutProfileBranch(profile.getVersion(),profile.getId());
        return createOrUpdateProfile(context,profile,false,new HashSet<String>());
      }
    }
;
    return executeWrite(gitop,false);
  }
  finally {
    writeLock.unlock();
  }
}
