{
  LockHandle writeLock=aquireWriteLock();
  try {
    assertValid();
    GitOperation<Void> gitop=new GitOperation<Void>(){
      public Void call(      Git git,      GitContext context) throws Exception {
        checkoutVersion(git,parentId);
        createOrCheckoutVersion(git,versionId);
        if (attributes != null) {
          for (          Entry<String,String> att : attributes.entrySet()) {
            setVersionAttributeInternal(context,versionId,att.getKey(),att.getValue());
          }
        }
        context.commitMessage("Create version: " + parentId + " => "+ versionId);
        return null;
      }
    }
;
    executeWrite(gitop,true);
  }
  finally {
    writeLock.unlock();
  }
}
