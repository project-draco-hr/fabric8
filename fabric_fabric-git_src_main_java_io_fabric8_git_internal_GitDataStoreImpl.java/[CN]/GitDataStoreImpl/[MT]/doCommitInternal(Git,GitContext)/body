{
  IllegalStateAssertion.assertTrue(context.incrementCommitCount(),"Commit not required in context");
  try {
    String message=context.getCommitMessage();
    IllegalStateAssertion.assertTrue(message.length() > 0,"Empty commit message");
    git.add().addFilepattern(".").call();
    git.commit().setMessage(message).call();
    if (--commitsWithoutGC < 0) {
      commitsWithoutGC=MAX_COMMITS_WITHOUT_GC;
      LOGGER.debug("Performing 'git gc' after {} commits",MAX_COMMITS_WITHOUT_GC);
      git.gc().call();
    }
    versionCache.invalidateAll();
    if (context.isRequirePush()) {
      doPushInternal(git,context,getCredentialsProvider());
    }
    dataStore.get().fireChangeNotifications();
  }
 catch (  GitAPIException ex) {
    throw FabricException.launderThrowable(ex);
  }
}
