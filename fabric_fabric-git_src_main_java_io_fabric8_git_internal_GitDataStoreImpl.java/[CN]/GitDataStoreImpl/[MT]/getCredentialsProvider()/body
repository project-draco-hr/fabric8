{
  assertValid();
  Map<String,String> properties=getDataStoreProperties();
  String username;
  String password;
  if (isExternalGitConfigured(properties)) {
    username=getExternalUser(properties);
    password=getExternalCredential(properties);
  }
 else {
    RuntimeProperties sysprops=getRuntimeProperties();
    username=getContainerLogin(sysprops);
    password=generateContainerToken(sysprops,curator.get());
  }
  return new UsernamePasswordCredentialsProvider(username,password);
}
