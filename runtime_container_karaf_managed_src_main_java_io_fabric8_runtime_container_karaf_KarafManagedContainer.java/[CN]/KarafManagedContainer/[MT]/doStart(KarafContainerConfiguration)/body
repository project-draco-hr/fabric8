{
  File karafHome=getContainerHome();
  if (!karafHome.isDirectory())   throw new IllegalStateException("Not a valid Karaf home dir: " + karafHome);
  String javaArgs=config.getJavaVmArguments() != null ? config.getJavaVmArguments() : "";
  if (!javaArgs.contains("-Xmx")) {
    javaArgs=KarafContainerConfiguration.DEFAULT_JAVAVM_ARGUMENTS + javaArgs;
  }
  ProcessBuilder processBuilder=new ProcessBuilder("bin/karaf");
  Map<String,String> env=processBuilder.environment();
  env.put("JAVA_OPTS",javaArgs);
  processBuilder.directory(karafHome);
  processBuilder.redirectErrorStream(true);
  startProcess(processBuilder,config);
}
