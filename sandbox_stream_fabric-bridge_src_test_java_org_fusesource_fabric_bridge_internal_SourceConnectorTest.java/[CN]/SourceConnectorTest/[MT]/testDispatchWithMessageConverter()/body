{
  connector.getOutboundDestinations().getDispatchPolicy().setMessageConverter(new MessageConverter(){
    @Override public Message convert(    Message message) throws JMSException {
      message.setStringProperty(TEST_HEADER,TEST_VALUE);
      return message;
    }
  }
);
  connector.afterPropertiesSet();
  connector.start();
  final long startNanos=System.nanoTime();
  for (  String sourceName : TEST_SOURCES) {
    sendMessages(TEST_LOCAL_BROKER_URL,sourceName,TEST_NUM_MESSAGES,null);
  }
  receiveMessages(TEST_REMOTE_BROKER_URL,BridgeDestinationsConfig.DEFAULT_STAGING_QUEUE_NAME,TEST_NUM_MESSAGES * TEST_SOURCES.length,new BaseMatcher<TextMessage>(){
    @Override public boolean matches(    Object message){
      boolean retVal=false;
      try {
        TextMessage textMessage=(TextMessage)message;
        retVal=textMessage.getStringProperty(BridgeDestinationsConfig.DEFAULT_DESTINATION_NAME_HEADER).matches("source[1-3]") && TEST_VALUE.equals(textMessage.getStringProperty(TEST_HEADER));
      }
 catch (      JMSException e) {
        fail(e.getMessage());
      }
      return retVal;
    }
    @Override public void describeTo(    Description description){
      description.appendText("TextMessage containing " + TEST_HEADER + " property");
    }
  }
);
  final long stopNanos=System.nanoTime();
  LOG.info("Test took " + TimeUnit.NANOSECONDS.toMillis(stopNanos - startNanos) + " milliseconds");
}
