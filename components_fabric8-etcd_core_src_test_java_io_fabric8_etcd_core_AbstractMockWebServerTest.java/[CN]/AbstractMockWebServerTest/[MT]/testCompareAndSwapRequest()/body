{
  server.enqueue(new MockResponse().setBody(Resources.toString(getClass().getClassLoader().getResource("compare-and-swap-response-2.json"),Charsets.UTF_8)));
  Response response=client.setData().prevValue("Hello world").value("Hello etcd").forKey("message");
  assertNotNull(response);
  assertEquals("compareAndSwap",response.getAction());
  assertEquals("Hello etcd",response.getNode().getValue());
  RecordedRequest request=server.takeRequest();
  assertEquals("PUT",request.getMethod());
  assertTrue(request.getPath().startsWith(Keys.makeKey("message")));
  assertTrue(request.getPath().contains("value=Hello+etcd"));
  assertTrue(request.getPath().contains("prevValue=Hello+world"));
  server.shutdown();
}
