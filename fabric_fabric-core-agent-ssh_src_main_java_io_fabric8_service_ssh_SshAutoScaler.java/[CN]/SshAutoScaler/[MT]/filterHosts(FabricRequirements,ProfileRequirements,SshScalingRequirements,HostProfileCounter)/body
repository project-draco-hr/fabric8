{
  SortedSet<LoadSortedSshHostConfiguration> answer=new TreeSet<>();
  int index=0;
  Map<String,SshHostConfiguration> hosts=requirements.getSshHostsMap();
  if (hosts != null) {
    Filter<String> hostFilter=createHostAliasFilter(sshScalingRequirements);
    Filter<SshHostConfiguration> configFilter=createHostConfigFilter(sshScalingRequirements);
    Set<Map.Entry<String,SshHostConfiguration>> entries=hosts.entrySet();
    for (    Map.Entry<String,SshHostConfiguration> entry : entries) {
      String hostAlias=entry.getKey();
      SshHostConfiguration config=entry.getValue();
      if (hostFilter.matches(hostAlias) && configFilter.matches(config)) {
        String profile=profileRequirements.getProfile();
        boolean valid=true;
        Integer maximumContainerCount=config.getMaximumContainerCount();
        if (maximumContainerCount != null) {
          int count=hostProfileCounter.containerCount(hostAlias);
          if (count >= maximumContainerCount) {
            valid=false;
          }
        }
        if (valid) {
          Integer maximumInstancesPerHost=profileRequirements.getMaximumInstancesPerHost();
          if (maximumInstancesPerHost != null) {
            int count=hostProfileCounter.profileCount(hostAlias,profile);
            if (count >= maximumInstancesPerHost) {
              valid=false;
            }
          }
        }
        if (valid) {
          answer.add(new LoadSortedSshHostConfiguration(hostAlias,config,profile,hostProfileCounter,index++));
        }
      }
    }
  }
  return answer;
}
