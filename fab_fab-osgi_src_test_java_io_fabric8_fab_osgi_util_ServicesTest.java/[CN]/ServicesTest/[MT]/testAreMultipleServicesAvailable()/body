{
  BundleContext context=createNiceMock(BundleContext.class);
  expect(context.getServiceReferences("org.apache.aries.blueprint.NamespaceHandler","(key=value)")).andReturn(someReferences());
  expect(context.getServiceReferences("some.other.class.Name",null)).andReturn(someReferences());
  replay(context);
  Set<Service> services=new HashSet<Service>();
  services.add(new Service("org.apache.aries.blueprint.NamespaceHandler",Services.createProperties("key","value")));
  services.add(new Service("some.other.class.Name"));
  assertTrue("Services are available",Services.isAvailable(context,services));
  verify(context);
  reset(context);
  replay(context);
  services.clear();
  services.add(new Service("org.apache.aries.blueprint.NamespaceHandler",Services.createProperties("key","not_the_right_value")));
  services.add(new Service("some.other.class.Name"));
  assertFalse("Services are not available",Services.isAvailable(context,services));
  verify(context);
}
