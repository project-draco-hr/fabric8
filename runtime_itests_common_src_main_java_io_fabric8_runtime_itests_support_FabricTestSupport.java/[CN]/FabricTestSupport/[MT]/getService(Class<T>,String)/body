{
  ModuleContext context=RuntimeLocator.getRequiredRuntime().getModuleContext();
  Collection<ServiceReference<T>> srefs=context.getServiceReferences(clazz,filter);
  Assert.assertFalse("ServiceReferences found: " + clazz.getName(),srefs.isEmpty());
  return context.getService(srefs.iterator().next());
}
