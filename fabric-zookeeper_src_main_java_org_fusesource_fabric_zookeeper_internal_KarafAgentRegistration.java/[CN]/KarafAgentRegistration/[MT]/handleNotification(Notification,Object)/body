{
  if (connected && mbeanServer != null && notif instanceof MBeanServerNotification) {
    MBeanServerNotification notification=(MBeanServerNotification)notif;
    String domain=notification.getMBeanName().getDomain();
    String path=AGENT_DOMAIN.getPath((String)o,domain);
    try {
      if (MBeanServerNotification.REGISTRATION_NOTIFICATION.equals(notification.getType())) {
        if (domains.add(domain) && zooKeeper.exists(path) == null) {
          zooKeeper.create(path,"",ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
        }
      }
 else       if (MBeanServerNotification.UNREGISTRATION_NOTIFICATION.equals(notification.getType())) {
        domains.clear();
        domains.addAll(Arrays.asList(mbeanServer.getDomains()));
        if (!domains.contains(domain)) {
          zooKeeper.delete(path);
        }
      }
    }
 catch (    KeeperException.SessionExpiredException e) {
      logger.debug("Session expiry detected. Handling notification once again",e);
      handleNotification(notif,o);
    }
catch (    Exception e) {
      logger.warn("Exception while jmx domain synchronization",e);
    }
  }
}
