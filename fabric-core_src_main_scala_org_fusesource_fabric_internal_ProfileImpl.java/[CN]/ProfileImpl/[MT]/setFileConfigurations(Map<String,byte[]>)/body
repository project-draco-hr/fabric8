{
  try {
    IZKClient zooKeeper=service.getZooKeeper();
    Map<String,byte[]> oldCfgs=getFileConfigurations();
    String path=ZkPath.CONFIG_VERSIONS_PROFILE.getPath(version,id);
    for (    String pid : configurations.keySet()) {
      oldCfgs.remove(pid);
      byte[] newCfg=configurations.get(pid);
      String configPath=path + "/" + pid;
      if (zooKeeper.getChildren(configPath) != null) {
        List<String> kids=zooKeeper.getChildren(configPath);
        ArrayList<String> saved=new ArrayList<String>();
        for (        String line : new String(newCfg).split("\n")) {
          if (line.startsWith("#") || line.length() == 0) {
            continue;
          }
          String name_value[]=line.split("=",2);
          if (name_value.length < 2) {
            continue;
          }
          String newPath=configPath + "/" + name_value[0].trim();
          if (zooKeeper.exists(newPath) == null) {
            zooKeeper.create(configPath + "/" + name_value[0].trim(),name_value[1].trim(),ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
          }
 else {
            zooKeeper.setData(newPath,name_value[1].trim());
          }
          saved.add(name_value[0].trim());
        }
        for (        String kid : kids) {
          if (!saved.contains(kid)) {
            zooKeeper.deleteWithChildren(configPath + "/" + kid);
          }
        }
      }
 else {
        if (zooKeeper.exists(configPath) == null) {
          zooKeeper.createBytesNode(configPath,newCfg,ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
        }
 else {
          zooKeeper.setByteData(configPath,newCfg);
        }
      }
    }
    for (    String pid : oldCfgs.keySet()) {
      zooKeeper.deleteWithChildren(path + "/" + pid);
    }
  }
 catch (  Exception e) {
    throw new FabricException(e);
  }
}
