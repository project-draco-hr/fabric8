{
  m_capSet.add(cap);
  for (  Entry<String,Map<Object,Set<C>>> entry : m_indices.entrySet()) {
    Attribute capAttr=cap.getAttribute(entry.getKey());
    if (capAttr != null) {
      Object capValue=capAttr.getValue();
      if (capValue.getClass().isArray()) {
        capValue=convertArrayToList(capValue);
      }
      Map<Object,Set<C>> index=entry.getValue();
      if (capValue instanceof Collection) {
        Collection c=(Collection)capValue;
        for (        Object o : c) {
          indexCapability(index,cap,o);
        }
      }
 else {
        indexCapability(index,cap,capValue);
      }
    }
  }
}
