{
  DataStoreSupport instance;
  String kind="zookee";
  if (configuration != null) {
    kind=configuration.get("kind");
  }
  if (kind != null && kind.startsWith("z")) {
    properties.put("kind","org.fusesource.datastore.zookeeper");
    instance=new ZooKeeperDataStore();
  }
 else {
    properties.put("kind","org.fusesource.datastore.git");
    instance=new GitDataStore();
  }
  LOG.info("Has system property " + DATASTORE_KIND + "="+ kind+ " so created DataStore: "+ instance+ " from configuration "+ configuration);
  Objects.notNull(curator,"curator");
  instance.setCurator(curator);
  instance.setPlaceholderResolvers(placeholderResolvers);
  if (instance instanceof GitDataStore) {
    GitDataStore gitDataStore=(GitDataStore)instance;
    if (isBootstrap()) {
      if (gitService == null) {
        LOG.info("Creating bootstrap GitService");
        gitService=createBootstrapGitService();
      }
    }
 else {
      Objects.notNull(gitService,"gitService");
    }
    LOG.info("Using GitService: " + gitService);
    gitDataStore.setGitService(gitService);
  }
  instance.init();
  return instance;
}
