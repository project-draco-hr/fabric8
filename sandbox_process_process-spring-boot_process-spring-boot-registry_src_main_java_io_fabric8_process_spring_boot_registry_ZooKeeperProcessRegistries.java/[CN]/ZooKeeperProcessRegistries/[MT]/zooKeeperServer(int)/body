{
  try {
    ServerConfig cfg=new ServerConfig();
    String zkData="target/zk/data/" + randomUUID();
    cfg.parse(new String[]{Integer.toString(port),zkData});
    ZooKeeperServer zkServer=new ZooKeeperServer();
    FileTxnSnapLog ftxn=new FileTxnSnapLog(new File(cfg.getDataLogDir()),new File(cfg.getDataDir()));
    zkServer.setTxnLogFactory(ftxn);
    zkServer.setTickTime(cfg.getTickTime());
    zkServer.setMinSessionTimeout(cfg.getMinSessionTimeout());
    zkServer.setMaxSessionTimeout(cfg.getMaxSessionTimeout());
    NIOServerCnxnFactory cnxnFactory=new NIOServerCnxnFactory();
    cnxnFactory.configure(cfg.getClientPortAddress(),cfg.getMaxClientCnxns());
    cnxnFactory.startup(zkServer);
    return cnxnFactory;
  }
 catch (  InterruptedException|IOException e) {
    throw new RuntimeException(e);
  }
}
