{
  List<JMXConnector> conns=new ArrayList<JMXConnector>();
  if (process.isServersMultiThreaded()) {
    ExecutorService service=null;
    try {
      service=Executors.newFixedThreadPool(process.getNumMultiThreadedServers());
      for (      Server server : process.getServers()) {
        if (server.getLocalMBeanServer() != null) {
          service.execute(new ProcessServerThread(server,null));
        }
 else {
          JMXConnector conn=JmxUtils.getServerConnection(server);
          conns.add(conn);
          service.execute(new ProcessServerThread(server,conn));
        }
      }
      service.shutdown();
    }
  finally {
      try {
        service.awaitTermination(1000 * 60,TimeUnit.SECONDS);
      }
 catch (      InterruptedException ex) {
        log.error("Error shutting down execution.",ex);
      }
    }
  }
 else {
    for (    Server server : process.getServers()) {
      if (server.getLocalMBeanServer() != null) {
        processServer(server,null);
      }
 else {
        JMXConnector conn=JmxUtils.getServerConnection(server);
        conns.add(conn);
        processServer(server,conn);
      }
    }
  }
  for (  JMXConnector conn : conns) {
    try {
      conn.close();
    }
 catch (    Exception ex) {
      log.error("Error closing connection.",ex);
    }
  }
}
