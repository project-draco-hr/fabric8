{
  System.out.println("Switching profile: " + profileName + " on container:"+ containerName);
  FabricService fabricService=getOsgiService(FabricService.class);
  assertNotNull(fabricService);
  IZKClient zookeeper=getOsgiService(IZKClient.class);
  assertNotNull(zookeeper);
  Container container=fabricService.getContainer(containerName);
  Version version=container.getVersion();
  Profile[] profiles=new Profile[]{fabricService.getProfile(version.getName(),profileName)};
  Profile[] currentProfiles=container.getProfiles();
  Arrays.sort(profiles);
  Arrays.sort(currentProfiles);
  boolean same=true;
  if (profiles.length != currentProfiles.length) {
    same=false;
  }
 else {
    for (int i=0; i < currentProfiles.length; i++) {
      if (!currentProfiles[i].configurationEquals(profiles[i])) {
        same=false;
      }
    }
  }
  if (!same) {
    ZooKeeperUtils.set(zookeeper,ZkPath.CONTAINER_PROVISION_RESULT.getPath(containerName),"switching profile");
    container.setProfiles(profiles);
    waitForProvisionSuccess(container,PROVISION_TIMEOUT);
  }
  return same;
}
