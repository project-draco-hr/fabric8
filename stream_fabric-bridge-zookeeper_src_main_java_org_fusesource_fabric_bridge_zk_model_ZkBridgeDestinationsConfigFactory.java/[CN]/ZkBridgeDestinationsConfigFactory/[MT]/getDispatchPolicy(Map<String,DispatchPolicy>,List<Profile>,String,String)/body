{
  String dispatchPolicyConfig=DISPATCH_POLICY_PID + "." + dispatchPolicyRef;
  if (dispatchPolicies.get(dispatchPolicyConfig) != null) {
    return dispatchPolicies.get(dispatchPolicyConfig);
  }
  for (  Profile profile : profiles) {
    Map<String,String> properties=profile.getConfigurations().get(dispatchPolicyConfig);
    if (properties != null) {
      DispatchPolicy dispatchPolicy=new DispatchPolicy();
      dispatchPolicy.setId(id);
      ConfigurablePropertyAccessor accessor=PropertyAccessorFactory.forDirectFieldAccess(dispatchPolicy);
      accessor.setPropertyValues(properties);
      dispatchPolicies.put(dispatchPolicyConfig,dispatchPolicy);
      return dispatchPolicy;
    }
  }
  String msg="No configuration " + dispatchPolicyConfig + " found in container profiles";
  LOG.error(msg);
  throw new BeanCreationException(msg);
}
