{
  boolean isJavaContainer=true;
  javaConfig.updateEnvironmentVariables(environmentVariables,isJavaContainer);
  Set<String> profileIds=options.getProfiles();
  String versionId=options.getVersion();
  JolokiaAgentHelper.updateSystemPropertiesEnvironmentVariable(environmentVariables,fabricService,versionId,profileIds);
  configureInstallOptionsJolokia(container.getId(),environmentVariables,javaConfig,isJavaContainer);
  Map<String,File> jarsFromProfiles=extractJarsFromProfiles(container,options);
  InstallOptions.InstallOptionsBuilder builder=InstallOptions.builder();
  if (javaConfig.getJarUrl() != null) {
    builder.url(javaConfig.getJarUrl());
  }
  builder.container(container);
  if (javaConfig.getJvmArguments() != null) {
    builder.jvmOptionsString(javaConfig.getJvmArguments());
  }
  builder.jarFiles(jarsFromProfiles);
  builder.id(options.getName());
  builder.environment(environmentVariables);
  String mainClass=environmentVariables.get(JavaContainerEnvironmentVariables.FABRIC8_JAVA_MAIN);
  String name="java";
  if (!Strings.isNullOrBlank(mainClass)) {
    name+=" " + mainClass;
  }
  builder.name(name);
  builder.downloadStrategy(createDownloadStrategy());
  metadata.setContainerType(name);
  builder.mainClass(mainClass);
  return builder.build();
}
