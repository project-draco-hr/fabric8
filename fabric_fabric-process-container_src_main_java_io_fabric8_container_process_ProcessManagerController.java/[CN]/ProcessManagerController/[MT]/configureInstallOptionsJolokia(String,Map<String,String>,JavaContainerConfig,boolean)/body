{
  if (JolokiaAgentHelper.hasJolokiaAgent(environmentVariables)) {
    String JOLOKIA_PROXY_PORT_ENV="FABRIC8_JOLOKIA_PROXY_PORT";
    String portText=environmentVariables.get(JOLOKIA_PROXY_PORT_ENV);
    Integer portObject=null;
    if (portText != null) {
      try {
        portObject=Integer.parseInt(portText);
      }
 catch (      NumberFormatException e) {
        LOG.warn("Ignoring bad port number for " + JOLOKIA_PROXY_PORT_ENV + " value '"+ portText+ ". "+ e,e);
      }
    }
    int jolokiaPort=(portObject != null) ? portObject : owner.createJolokiaPort(containerId);
    environmentVariables.put(JOLOKIA_PROXY_PORT_ENV,"" + jolokiaPort);
    JolokiaAgentHelper.substituteEnvironmentVariables(javaConfig,environmentVariables,isJavaContainer,JolokiaAgentHelper.getJolokiaPortOverride(jolokiaPort),JolokiaAgentHelper.getJolokiaAgentIdOverride(fabricService.getEnvironment()));
  }
 else {
    JolokiaAgentHelper.substituteEnvironmentVariables(javaConfig,environmentVariables,isJavaContainer,JolokiaAgentHelper.getJolokiaAgentIdOverride(fabricService.getEnvironment()));
  }
}
