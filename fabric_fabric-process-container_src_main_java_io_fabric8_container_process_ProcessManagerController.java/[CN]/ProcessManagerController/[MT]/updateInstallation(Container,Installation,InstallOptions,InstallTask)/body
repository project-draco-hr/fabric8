{
  ProcessConfig processConfig=processManager.loadProcessConfig(parameters);
  processConfig.setName(parameters.getName());
  ProcessConfig oldConfig=getProcessConfig(installation);
  String id=installation.getId();
  File installDir=installation.getInstallDir();
  InstallContext installContext=new InstallContext(parameters.getContainer(),installDir,true);
  if (processConfig != null && !oldConfig.equals(processConfig)) {
    installContext.addRestartReason("Environment Variables");
    if (LOG.isDebugEnabled()) {
      LOG.debug("Requires restart as config has changed: OLD: " + JsonHelper.toJson(oldConfig) + " and NEW: "+ JsonHelper.toJson(processConfig));
    }
    resolveEnvironmentVariables(processConfig.getEnvironment());
    JsonHelper.saveProcessConfig(processConfig,installDir);
    installation.getController().getConfig().setEnvironment(processConfig.getEnvironment());
    if (!processConfig.getDeployPath().equals(oldConfig.getDeployPath())) {
      installContext.addRedeployReason("Container Changed");
    }
  }
  if (postInstall != null) {
    postInstall.install(installContext,processConfig,id,installDir);
  }
 else {
    JarInstaller installer=new JarInstaller(parameters,processManager.getExecutor());
    installer.install(installContext,processConfig,id,installDir);
  }
  installContext.updateContainerChecksums();
  if (installContext.isRedeployRequired()) {
    LOG.info("Redeploying " + container.getId() + " due to profile changes: "+ installContext.getRedeployReasons());
    ProcessController controller=installation.getController();
    if (controller != null && container != null && container.isAlive()) {
      controller.stop();
      if (container.isAlive()) {
        controller.kill();
      }
    }
    if (controller != null && container != null) {
      LOG.info("Unininstalling " + container.getId());
      controller.uninstall();
      LOG.info("Ininstalling " + container.getId());
      controller.install();
      LOG.info("Starting " + container.getId());
      controller.start();
    }
  }
 else   if (installContext.isRestartRequired()) {
    LOG.info("Restarting " + container.getId() + " due to profile changes: "+ installContext.getRestartReasons());
    ProcessController controller=installation.getController();
    if (controller != null && container != null && container.isAlive()) {
      controller.restart();
    }
  }
}
