{
  byte formatCode=TypeRegistry.instance().picker().chooseSymbolEncoding(value);
switch (formatCode) {
case TypeRegistry.NULL_FORMAT_CODE:
    return 1;
case AMQPSymbol.SYMBOL_SYM8_CODE:
  return 1 + AMQPSymbol.SYMBOL_SYM8_WIDTH + value.length();
case AMQPSymbol.SYMBOL_SYM32_CODE:
return 1 + AMQPSymbol.SYMBOL_SYM32_CODE + value.length();
default :
throw new RuntimeException("Unknown format code 0x" + String.format("%x",formatCode));
}
}
