{
  BundleContext bundleContext=getBundleContext();
  if (bundleContext == null) {
    LOG.warn("No BundleContext available so cannot install provided dependencies");
  }
 else {
    List<Bundle> toStart=new ArrayList<Bundle>();
    for (    DependencyTree dependency : classPathResolver.getInstallDependencies()) {
      String name=dependency.getBundleSymbolicName();
      String version=dependency.getVersion();
      if (Bundles.isInstalled(bundleContext,name,version)) {
        LOG.info("Bundle already installed: " + name + " ("+ version+ ")");
      }
 else {
        HashSet<String> p=new HashSet<String>(dependency.getPackages());
        p.retainAll(actualImports);
        Set<String> missing=Bundles.filterInstalled(bundleContext,p);
        if (missing.isEmpty()) {
          LOG.info("Bundle packages already installed: " + name);
        }
 else {
          LOG.info("Packages not yet shared: " + missing);
          URL url=dependency.getJarURL();
          String installUri=url.toExternalForm();
          try {
            Bundle bundle=null;
            if (!dependency.isBundle()) {
              FabConnection childConnection=createChild(url);
              PomDetails pomDetails=childConnection.resolvePomDetails();
              if (pomDetails != null && pomDetails.isValid()) {
                LOG.info("Installing fabric bundle: " + name + " from: "+ installUri);
                bundle=bundleContext.installBundle(installUri,childConnection.getInputStream());
              }
 else {
                LOG.warn("Could not deduce the pom.xml for the jar " + installUri + " so cannot treat as FAB");
              }
            }
 else {
              LOG.info("Installing bundle: " + name + " from: "+ installUri);
              bundle=bundleContext.installBundle(installUri);
            }
            if (bundle != null && isStartInstalledDependentBundles()) {
              toStart.add(bundle);
            }
          }
 catch (          BundleException e) {
            LOG.error("Failed to deploy " + installUri + " due to error: "+ e,e);
            throw e;
          }
catch (          IOException e) {
            LOG.error("Failed to deploy " + installUri + " due to error: "+ e,e);
            throw e;
          }
catch (          RuntimeException e) {
            LOG.error("Failed to deploy " + installUri + " due to error: "+ e,e);
            throw e;
          }
        }
      }
    }
    for (    Bundle bundle : toStart) {
      try {
        bundle.start();
      }
 catch (      BundleException e) {
        LOG.warn("Failed to start " + bundle.getSymbolicName() + ". Reason: "+ e,e);
      }
    }
  }
}
