{
  HostProfileCounter hostProfileCounter=new HostProfileCounter();
  String version=requirements.getVersion();
  if (Strings.isEmpty(version)) {
    version="1.0";
  }
  List<ProfileRequirements> profileRequirements=requirements.getProfileRequirements();
  for (  ProfileRequirements profileRequirement : profileRequirements) {
    Integer minimumInstances=profileRequirement.getMinimumInstances();
    if (minimumInstances != null) {
      for (int i=0; i < minimumInstances; i++) {
        String profileId=profileRequirement.getProfile();
        AutoScaleRequest request=new AutoScaleRequest(null,version,profileId,1,requirements,profileRequirement,status);
        CreateSshContainerOptions.Builder builder=chooseHostContainerOptions(request,hostProfileCounter);
        assertNotNull("Should have found a builder for " + profileId,builder);
        String host=builder.getHost();
        hostProfileCounter.incrementContainers(host);
        hostProfileCounter.incrementProfileCount(host,profileId);
      }
    }
  }
  Map<String,CountingMap> hostToProfileCounts=hostProfileCounter.getHostToProfileCounts();
  assertProfilesUseSeparateHost(requirements,hostToProfileCounts);
  assertMaximumContainerCountNotExceeded(requirements,hostToProfileCounts);
  return hostProfileCounter;
}
