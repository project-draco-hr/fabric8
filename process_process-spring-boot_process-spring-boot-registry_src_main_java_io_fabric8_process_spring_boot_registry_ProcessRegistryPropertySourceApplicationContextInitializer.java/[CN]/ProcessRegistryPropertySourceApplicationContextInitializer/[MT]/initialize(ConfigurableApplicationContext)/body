{
  List<ProcessRegistry> registries=newArrayList(new InMemoryProcessRegistry(),new ClassPathProcessRegistry());
  LOG.debug("Looking for ZooKeeperProcessRegistry...");
  if (ClassUtils.isPresent("org.apache.curator.framework.CuratorFramework",getClass().getClassLoader())) {
    LOG.info("Apache Curator jar found. Creating ZooKeeperProcessRegistry.");
    registries.add(autodetectZooKeeperProcessRegistry());
  }
  ProcessRegistry registry=new CompositeProcessRegistry(registries);
  ProcessRegistryHolder.processRegistry(registry);
  ProcessRegistryPropertySource propertySource=new ProcessRegistryPropertySource(registry);
  applicationContext.getEnvironment().getPropertySources().addFirst(propertySource);
}
