{
  StringBuilder builder=new StringBuilder();
  BufferedReader reader=new BufferedReader(new InputStreamReader(inputStream));
  try {
    while (true) {
      String line=reader.readLine();
      if (line == null)       break;
      if (builder.length() > 0) {
        builder.append("\n");
      }
      builder.append(line);
      LOGGER.info(line);
    }
    return builder.toString();
  }
 catch (  Exception e) {
    LOGGER.error("Failed to process stderr for " + message + ": "+ e,e);
    throw e;
  }
 finally {
    Closeables.closeQuitely(reader);
  }
}
