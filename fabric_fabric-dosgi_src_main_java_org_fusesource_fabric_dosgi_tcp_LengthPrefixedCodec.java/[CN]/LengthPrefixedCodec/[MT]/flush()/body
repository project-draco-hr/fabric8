{
  final long writeCounterBeforeFlush=write_counter;
  while (!next_write_buffers.isEmpty()) {
    final ByteBuffer nextBuffer=next_write_buffers.peek();
    if (nextBuffer.remaining() < 1) {
      next_write_buffers.remove();
      continue;
    }
    int bytesWritten=write_channel.write(nextBuffer);
    write_counter+=bytesWritten;
    next_write_size-=bytesWritten;
    if (nextBuffer.remaining() > 0) {
      break;
    }
  }
  if (empty()) {
    if (writeCounterBeforeFlush == write_counter) {
      return BufferState.WAS_EMPTY;
    }
 else {
      return BufferState.EMPTY;
    }
  }
  return BufferState.NOT_EMPTY;
}
