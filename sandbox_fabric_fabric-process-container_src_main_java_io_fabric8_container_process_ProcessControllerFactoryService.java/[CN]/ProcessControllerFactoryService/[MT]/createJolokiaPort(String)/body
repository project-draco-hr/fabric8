{
  FabricService fabricService=getFabricService();
  Container currentContainer=fabricService.getCurrentContainer();
  Set<Integer> usedPortByHost=fabricService.getPortService().findUsedPortByHost(currentContainer);
  while (true) {
    if (externalJolokiaPort <= 0) {
      externalJolokiaPort=JolokiaAgentHelper.DEFAULT_JOLOKIA_PORT;
    }
 else {
      externalJolokiaPort++;
    }
    if (!usedPortByHost.contains(externalJolokiaPort)) {
      Container container=fabricService.getCurrentContainer();
      String pid=JolokiaAgentHelper.JOLOKIA_PORTS_PID;
      String key=containerId;
      fabricService.getPortService().registerPort(container,pid,key,externalJolokiaPort);
      return externalJolokiaPort;
    }
  }
}
