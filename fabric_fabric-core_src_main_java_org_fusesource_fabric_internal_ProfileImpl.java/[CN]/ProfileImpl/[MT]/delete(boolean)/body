{
  Container[] containers=getAssociatedContainers();
  if (containers.length == 0) {
    service.getDataStore().deleteProfile(version,id);
  }
 else   if (force) {
    for (    Container container : containers) {
      container.removeProfiles(this);
    }
    service.getDataStore().deleteProfile(version,id);
  }
 else {
    StringBuilder sb=new StringBuilder();
    sb.append("Cannot delete profile:").append(id).append(".");
    sb.append("Profile has assigned ").append(containers.length).append(" container(s):");
    for (    Container c : containers) {
      sb.append(" ").append(c.getId());
    }
    sb.append(". Use force option to also remove the profile from the containers.");
    throw new FabricException(sb.toString());
  }
  FabricRequirements requirements=service.getRequirements();
  if (requirements.removeProfileRequirements(id)) {
    try {
      service.setRequirements(requirements);
    }
 catch (    IOException e) {
      throw new FabricException("Failed to update requirements after deleting profile " + id + ". "+ e,e);
    }
  }
}
