{
  String name=resource.getName();
  if (name.endsWith(".xml")) {
    boolean camel=resource.getContents().contains("<camelContext");
    if (camel) {
      try {
        Document dom=XmlLineNumberParser.parseXml(resource.getResourceInputStream());
        if (dom != null) {
          List<Node> nodes=CamelXmlHelper.findAllEndpoints(dom);
          for (          Node node : nodes) {
            String uri=getSafeAttribute(node,"uri");
            String id=getSafeAttribute(node,"id");
            String lineNumber=(String)node.getUserData(XmlLineNumberParser.LINE_NUMBER);
            String baseDir=facet.getResourceDirectory().getFullyQualifiedName();
            String fileName=resource.getFullyQualifiedName();
            if (fileName.startsWith(baseDir)) {
              fileName=fileName.substring(baseDir.length() + 1);
            }
            CamelEndpointDetails detail=new CamelEndpointDetails();
            detail.setResource(resource);
            detail.setFileName(fileName);
            detail.setLineNumber(lineNumber);
            detail.setEndpointInstance(id);
            detail.setEndpointUri(uri);
            detail.setEndpointComponentName(endpointComponentName(uri));
            endpoints.add(detail);
          }
        }
      }
 catch (      Exception e) {
      }
    }
  }
}
