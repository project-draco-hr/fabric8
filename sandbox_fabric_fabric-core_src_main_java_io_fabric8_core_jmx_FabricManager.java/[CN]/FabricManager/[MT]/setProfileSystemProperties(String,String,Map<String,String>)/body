{
  Version version=profileService.getVersion(versionId);
  Profile profile=version.getRequiredProfile(profileId);
  Map<String,String> profileProperties=getProfileProperties(versionId,profileId,Constants.AGENT_PID);
  if (profileProperties == null) {
    profileProperties=new HashMap<String,String>();
  }
  for (Iterator<Map.Entry<String,String>> iterator=profileProperties.entrySet().iterator(); iterator.hasNext(); ) {
    Map.Entry<String,String> entry=iterator.next();
    if (entry.getKey().startsWith("system.")) {
      iterator.remove();
    }
  }
  for (  String k : systemProperties.keySet()) {
    profileProperties.put("system." + k,systemProperties.get(k));
  }
  setProfileProperties(versionId,profileId,Constants.AGENT_PID,profileProperties);
}
