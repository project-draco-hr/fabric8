{
  Objects.notNull(fabricService,"fabricService");
  Map<String,Profile> profileMap=new HashMap<String,Profile>();
  if (version != null) {
    Profile[] profiles=version.getProfiles();
    for (    Profile profile : profiles) {
      Map<String,Map<String,String>> configurations=profile.getConfigurations();
      Set<Map.Entry<String,Map<String,String>>> entries=configurations.entrySet();
      for (      Map.Entry<String,Map<String,String>> entry : entries) {
        String key=entry.getKey();
        if (isBrokerConfigPid(key)) {
          String brokerName=getBrokerNameFromPID(key);
          String profileId=profile.getId();
          if (requirements.hasMinimumInstances(profileId) || profile.getAssociatedContainers().length > 0) {
            profileMap.put(brokerName,profile);
          }
        }
      }
    }
  }
  return profileMap;
}
