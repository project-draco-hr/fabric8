{
synchronized (this) {
    if (pool_enabled) {
      return_pool(this);
    }
    if (discoveryAgent != null) {
      discoveryAgent.stop();
    }
    if (started.get()) {
      stop();
    }
  }
  if (started.compareAndSet(true,false)) {
    waitForStop();
  }
  executor.shutdownNow();
}
