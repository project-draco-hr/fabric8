{
  final ServerInfo s=server;
  if (s != null) {
    try {
      s.getBroker().stop();
      s.getBroker().waitUntilStopped();
      if (!standalone || replicating) {
        discoveryAgent.setServices(new String[0]);
      }
      if (registerService) {
        osgiUnregister(s.getBroker());
      }
    }
 catch (    Throwable e) {
      LOG.debug("Exception on stop: " + e.getMessage(),e);
    }
    try {
      s.getContext().close();
    }
 catch (    Throwable e) {
      LOG.debug("Exception on close: " + e.getMessage(),e);
    }
    server=null;
  }
}
