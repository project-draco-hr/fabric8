{
  if (cachedArchetypes == null) {
    String version=VersionHelper.fabric8Version();
    Coordinate coordinate=CoordinateBuilder.create().setGroupId("io.fabric8.archetypes").setArtifactId("archetypes-catalog").setVersion(version).setClassifier("archetype-catalog").setPackaging("xml");
    Dependency dependency=resolver.get().resolveArtifact(DependencyQueryBuilder.create(coordinate));
    if (dependency != null) {
      XMLResource xml=(XMLResource)dependency.getArtifact();
      if (xml != null) {
        try (InputStream is=xml.getResourceInputStream()){
          cachedArchetypes=new ArchetypeCatalogXpp3Reader().read(is);
        }
 catch (        Exception e) {
          logger.log(Level.SEVERE,"Error while retrieving archetypes",e);
        }
      }
    }
  }
  return cachedArchetypes;
}
