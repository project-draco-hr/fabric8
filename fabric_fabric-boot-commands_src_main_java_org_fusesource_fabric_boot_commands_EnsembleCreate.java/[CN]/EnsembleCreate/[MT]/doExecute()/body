{
  if (clean) {
    service.clean();
  }
  if (nonManaged) {
    System.setProperty(ZooKeeperClusterService.AGENT_AUTOSTART,"false");
  }
 else {
    System.setProperty(ZooKeeperClusterService.AGENT_AUTOSTART,"true");
  }
  Properties userProps=new Properties(new File(System.getProperty("karaf.home") + "/etc/users.properties"));
  if (userProps.isEmpty()) {
    String[] credentials=promptForNewUser(newUser,newUserPassword);
    newUser=credentials[0];
    newUserPassword=credentials[1];
  }
  CreateEnsembleOptions options=CreateEnsembleOptions.build().zookeeperPassword(zookeeperPassword).user(newUser,newUserPassword + "," + newUserRole);
  options.getUsers().putAll(userProps);
  service.createCluster(containers,options);
  return null;
}
