{
  final Agent parent=service.getAgent(agentUri.getSchemeSpecificPart());
  service.getAgentTemplate(parent).execute(new AgentTemplate.AdminServiceCallback<Object>(){
    public Object doWithAdminService(    AdminServiceMBean adminService) throws Exception {
      String javaOpts=zooKeeperUrl != null ? "-Dzookeeper.url=\"" + zooKeeperUrl + "\" -Xmx512M -server" : "";
      String features="fabric-agent";
      String featuresUrls="mvn:org.fusesource.fabric/fabric-distro/1.1-SNAPSHOT/xml/features";
      adminService.createInstance(name,0,0,0,null,javaOpts,features,featuresUrls);
      adminService.startInstance(name,null);
      return null;
    }
  }
);
}
