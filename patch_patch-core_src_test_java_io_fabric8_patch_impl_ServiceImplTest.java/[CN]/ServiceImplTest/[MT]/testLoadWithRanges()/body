{
  BundleContext bundleContext=createMock(BundleContext.class);
  Bundle sysBundle=createMock(Bundle.class);
  BundleContext sysBundleContext=createMock(BundleContext.class);
  Bundle bundle=createMock(Bundle.class);
  expect(bundleContext.getBundle(0)).andReturn(sysBundle);
  expect(sysBundle.getBundleContext()).andReturn(sysBundleContext);
  expect(sysBundleContext.getProperty(Service.PATCH_LOCATION)).andReturn(storage.toString()).anyTimes();
  replay(sysBundleContext,sysBundle,bundleContext,bundle);
  ServiceImpl service=new ServiceImpl(bundleContext);
  Patch patch=ServiceImpl.doLoad(service,getClass().getClassLoader().getResourceAsStream("test2.patch"));
  assertEquals(2,patch.getBundles().size());
  assertEquals("[1.0.0,2.0.0)",patch.getVersionRange("mvn:io.fabric8.test/test1/1.0.0"));
  assertNull(patch.getVersionRange("mvn:io.fabric8.test/test2/1.0.0"));
}
