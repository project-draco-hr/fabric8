{
  BundleContext bundleContext=createMock(BundleContext.class);
  Bundle sysBundle=createMock(Bundle.class);
  BundleContext sysBundleContext=createMock(BundleContext.class);
  Bundle bundle=createMock(Bundle.class);
  Bundle bundle2=createMock(Bundle.class);
  FrameworkWiring wiring=createMock(FrameworkWiring.class);
  expect(bundleContext.getBundle(0)).andReturn(sysBundle);
  expect(sysBundle.getBundleContext()).andReturn(sysBundleContext);
  expect(sysBundleContext.getProperty(Service.PATCH_LOCATION)).andReturn(storage.toString()).anyTimes();
  replay(sysBundleContext,sysBundle,bundleContext,bundle);
  ServiceImpl service=new ServiceImpl(bundleContext);
  Patch patch=ServiceImpl.doLoad(service,getClass().getClassLoader().getResourceAsStream("test1.patch"));
  assertEquals(2,patch.getBundles().size());
}
