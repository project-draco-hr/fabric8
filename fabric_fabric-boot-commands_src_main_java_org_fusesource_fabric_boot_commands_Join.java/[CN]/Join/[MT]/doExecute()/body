{
  String oldName=System.getProperty("karaf.name");
  if (containerName == null) {
    containerName=oldName;
  }
  if (!containerName.equals(oldName)) {
    if (permissionToRenameContainer()) {
      if (registerContainerIfNotExists(containerName)) {
        System.err.print("A container with the name: " + containerName + " is already member of the cluster. You can use the --container-name option to specify a different name.");
        return null;
      }
      System.setProperty("karaf.name",containerName);
      System.setProperty("zookeeper.url",zookeeperUrl);
      File file=new File(System.getProperty("karaf.base") + "/etc/system.properties");
      org.apache.felix.utils.properties.Properties props=new org.apache.felix.utils.properties.Properties(file);
      props.put("karaf.name",containerName);
      props.put("zookeeper.url",zookeeperUrl);
      props.save();
      if (!nonManaged) {
        installBundles();
      }
      org.osgi.service.cm.Configuration config=configurationAdmin.getConfiguration("org.fusesource.fabric.zookeeper");
      Properties properties=new Properties();
      properties.put("zookeeper.url",zookeeperUrl);
      config.setBundleLocation(null);
      config.update(properties);
      System.setProperty("karaf.restart","true");
      System.setProperty("karaf.restart.clean","false");
      bundleContext.getBundle(0).stop();
      return null;
    }
 else {
      return null;
    }
  }
 else {
    if (registerContainerIfNotExists(containerName)) {
      System.err.println("A container with the name: " + containerName + " is already member of the cluster. You can use the --container-name option to specify a different name.");
      return null;
    }
    org.osgi.service.cm.Configuration config=configurationAdmin.getConfiguration("org.fusesource.fabric.zookeeper");
    Properties properties=new Properties();
    properties.put("zookeeper.url",zookeeperUrl);
    config.setBundleLocation(null);
    config.update(properties);
    installBundles();
    return null;
  }
}
