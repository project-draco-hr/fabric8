{
  BundleUtils bundleUtils=new BundleUtils(bundleContext);
  Bundle bundleFabricCommands=bundleUtils.findBundle("org.fusesource.fabric.fabric-commands");
  if (bundleFabricCommands == null) {
    bundleFabricCommands=bundleUtils.installBundle("mvn:org.fusesource.fabric/fabric-commands/" + FabricConstants.FABRIC_VERSION);
  }
  bundleFabricCommands.start();
  Bundle bundleFabricAgent=bundleUtils.findBundle("org.fusesource.fabric.fabric-agent");
  if (nonManaged && bundleFabricAgent == null) {
  }
 else   if (nonManaged && bundleFabricAgent != null) {
    bundleFabricAgent.stop();
  }
 else   if (bundleFabricAgent == null) {
    bundleFabricAgent=bundleUtils.installBundle("mvn:org.fusesource.fabric/fabric-agent/" + FabricConstants.FABRIC_VERSION);
    bundleFabricAgent.start();
  }
 else {
    bundleFabricAgent.start();
  }
}
