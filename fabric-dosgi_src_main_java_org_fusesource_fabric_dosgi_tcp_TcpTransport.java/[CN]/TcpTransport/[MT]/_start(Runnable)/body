{
  try {
    if (socketState.is(CONNECTING.class)) {
      trace("connecting...");
      readSource=Dispatch.createSource(channel,SelectionKey.OP_CONNECT,dispatchQueue);
      readSource.setEventHandler(new Runnable(){
        public void run(){
          if (getServiceState() != STARTED) {
            return;
          }
          try {
            trace("connected.");
            channel.finishConnect();
            readSource.setCancelHandler(null);
            readSource.cancel();
            readSource=null;
            socketState=new CONNECTED();
            onConnected();
          }
 catch (          IOException e) {
            onTransportFailure(e);
          }
        }
      }
);
      readSource.setCancelHandler(CANCEL_HANDLER);
      readSource.resume();
    }
 else     if (socketState.is(CONNECTED.class)) {
      dispatchQueue.execute(new Runnable(){
        public void run(){
          try {
            trace("was connected.");
            onConnected();
          }
 catch (          IOException e) {
            onTransportFailure(e);
          }
        }
      }
);
    }
 else {
      System.err.println("cannot be started.  socket state is: " + socketState);
    }
  }
  finally {
    if (onCompleted != null) {
      onCompleted.run();
    }
  }
}
