{
  if (!transport.isDisposed()) {
    LOGGER.info("Transport failure",error);
    TransportState state=transports.remove(transport);
    if (state != null) {
      for (      Object id : state.inflight) {
        onFailure(id,error);
      }
    }
    transport.stop();
    if (transports.isEmpty()) {
      while (!pending.isEmpty()) {
        Pair p=pending.removeFirst();
        onFailure(p.id,error);
      }
    }
  }
}
