{
  try {
    try {
      String portStr=AccessController.doPrivileged(new PrivilegedAction<String>(){
        @Override public String run(){
          String result=System.getenv("AMQ_PORT");
          result=(result == null || result.isEmpty()) ? System.getProperty("org.apache.activemq.AMQ_PORT","61616") : result;
          return result;
        }
      }
);
      if (portStr != null && portStr.length() > 0) {
        port=Integer.parseInt(portStr);
      }
      queueName=AccessController.doPrivileged(new PrivilegedAction<String>(){
        @Override public String run(){
          String result=System.getenv("AMQ_QUEUENAME");
          result=(result == null || result.isEmpty()) ? System.getProperty("org.apache.activemq.AMQ_QUEUENAME","TEST.FOO") : result;
          return result;
        }
      }
);
      String intervalStr=AccessController.doPrivileged(new PrivilegedAction<String>(){
        @Override public String run(){
          String result=System.getenv("AMQ_INTERVAL");
          result=(result == null || result.isEmpty()) ? System.getProperty("org.apache.activemq.AMQ_INTERVAL","50") : result;
          return result;
        }
      }
);
      if (intervalStr != null && intervalStr.length() > 0) {
        interval=Integer.parseInt(intervalStr);
      }
    }
 catch (    Throwable e) {
      LOG.warn("Failed to look up System properties for host and port",e);
    }
    if (port <= 0) {
      port=61616;
    }
    if (queueName == null) {
      queueName="TEST.FOO";
    }
    if (interval <= 0) {
      interval=50;
    }
    org.apache.camel.main.Main main=new org.apache.camel.main.Main();
    main.bind("activemq",ActiveMQComponent.activeMQComponent("tcp://localhost:" + port));
    main.enableHangupSupport();
    main.addRouteBuilder(new RouteBuilder(){
      public void configure(){
        from("timer://mytimer?period=" + interval).log("Sending message at ${date:now:HH:mm:SS:sss}").to("activemq:" + queueName);
      }
    }
);
    main.run(args);
  }
 catch (  Throwable e) {
    LOG.error("Failed to connect to Fabric8MQ",e);
  }
}
