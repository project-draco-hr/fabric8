{
  try {
    Properties props=new Properties();
    props.load(new StringReader(configuration));
    String strategy=getPlugin();
    BundleContext bundleContext=FrameworkUtil.getBundle(getClass()).getBundleContext();
    ServiceReference<ConfigurationAdmin> sr=bundleContext.getServiceReference(ConfigurationAdmin.class);
    ConfigurationAdmin ca=bundleContext.getService(sr);
    if (ca != null) {
      Configuration config=ca.getConfiguration(Activator.INSIGHT_ACTIVEMQ_PID);
      Dictionary<String,Object> dic=config.getProperties();
      if (dic == null) {
        dic=new Hashtable<String,Object>();
      }
      Set<String> s=new HashSet<String>();
      for (Enumeration<String> keyEnum=dic.keys(); keyEnum.hasMoreElements(); ) {
        String key=keyEnum.nextElement();
        if (key.startsWith(strategy + ".")) {
          s.add(key);
        }
      }
      for (      String key : s) {
        dic.remove(key);
      }
      for (      String key : props.stringPropertyNames()) {
        dic.put(strategy + "." + key,props.getProperty(key));
      }
      config.update(dic);
    }
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
