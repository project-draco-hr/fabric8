{
  agent=new DeploymentAgent();
  agent.setBundleContext(context);
  ObrResolver obr=new ObrResolver(new RepositoryAdminImpl(context,new Logger(context)));
  Dictionary config=getConfig(context);
  if (config != null) {
    obr.setResolveOptionalImports(getResolveOptionalImports(config));
  }
  agent.setObrResolver(obr);
  agent.setPackageAdmin(getPackageAdmin(context));
  agent.setStartLevel(getStartLevel(context));
  agent.setFabricService(getFabricService(context));
  agent.start();
  Hashtable<String,String> props=new Hashtable<String,String>();
  props.put(Constants.SERVICE_PID,AGENT_PID);
  registration=context.registerService(ManagedService.class.getName(),agent,props);
}
