{
  if (!file.isFile()) {
    File temp=new File(file.toString() + ".tmp");
    URLConnection con=location.openConnection();
    if (location.getUserInfo() != null) {
      con.setRequestProperty("Authorization","Basic " + new sun.misc.BASE64Encoder().encode(location.getUserInfo().getBytes()));
    }
    if (temp.isFile()) {
      con.setRequestProperty("Range","Bytes=" + (temp.length()) + "-");
    }
    InputStream is=new BufferedInputStream(con.getInputStream());
    try {
      boolean resume="bytes".equals(con.getHeaderField("Accept-Ranges"));
      OutputStream os=new BufferedOutputStream(new FileOutputStream(temp,resume));
      try {
        copy(is,os);
      }
  finally {
        os.close();
      }
      temp.renameTo(file);
    }
  finally {
      is.close();
    }
  }
}
