{
  UserDetails userDetails=gitUserHelper.createUserDetails(request);
  String origin=projectFileSystem.getRemote();
  String branch=request.getParameter("branch");
  if (Strings.isNullOrBlank(branch)) {
    branch="master";
  }
  String objectId=request.getParameter("ref");
  File projectFolder=projectFileSystem.getUserProjectFolder(userId,repositoryName);
  String cloneUrl=projectFileSystem.getCloneUrl(userId,repositoryName,userDetails);
  File gitFolder=new File(projectFolder,".git");
  String remoteRepository=userId + "/" + repositoryName;
  RepositoryResource resource=new RepositoryResource(projectFolder,gitFolder,userDetails,origin,branch,remoteRepository,lockManager,projectFileSystem,cloneUrl,objectId);
  try {
    String message=request.getParameter("message");
    if (Strings.isNotBlank(message)) {
      resource.setMessage(message);
    }
  }
 catch (  Exception e) {
    LOG.warn("failed to load message parameter: " + e,e);
  }
  return resource;
}
