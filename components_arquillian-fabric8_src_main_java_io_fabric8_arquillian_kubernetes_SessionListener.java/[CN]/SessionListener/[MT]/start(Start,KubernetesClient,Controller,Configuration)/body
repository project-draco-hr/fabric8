{
  final Logger log=event.getSession().getLogger();
  try {
    URL configUrl=configuration.getConfigUrl();
    List<String> dependencies=!configuration.getDependencies().isEmpty() ? configuration.getDependencies() : Util.getMavenDependencies(event.getSession());
    List<Config> kubeConfigs=new LinkedList<>();
    for (    String dependency : dependencies) {
      log.info("Found dependency: " + dependency);
      Object kubeCfg=loadJson(readAsString(new URL(dependency)));
      if (kubeCfg instanceof Config) {
        kubeConfigs.add((Config)kubeCfg);
      }
    }
    if (configUrl != null) {
      log.status("Applying kubernetes configuration from: " + configuration.getConfigUrl());
      kubeConfigs.add((Config)loadJson(readAsString(configuration.getConfigUrl())));
    }
    applyConfiguration(client,controller,configuration,event.getSession(),kubeConfigs);
    displaySessionStatus(client,event.getSession());
  }
 catch (  Exception e) {
    try {
      cleanupSession(client,event.getSession());
    }
 catch (    MultiException me) {
      throw e;
    }
    throw new RuntimeException(e);
  }
  shutdownHook=new Thread("Cleanup session"){
    @Override public void run(){
      log.warn("shutdown hook cleaning up the integration test!");
      try {
        cleanupSession(client,event.getSession());
      }
 catch (      MultiException e) {
        log.warn(e.getMessage());
      }
    }
  }
;
  Runtime.getRuntime().addShutdownHook(shutdownHook);
}
