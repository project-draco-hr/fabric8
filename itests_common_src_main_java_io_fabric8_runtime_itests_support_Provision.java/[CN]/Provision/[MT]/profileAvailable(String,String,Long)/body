{
  ModuleContext moduleContext=RuntimeLocator.getRequiredRuntime().getModuleContext();
  FabricService fabricService=ServiceLocator.awaitService(moduleContext,FabricService.class);
  ProfileRegistry profileRegistry=fabricService.adapt(ProfileRegistry.class);
  for (long t=0; (!profileRegistry.hasProfile(version,profile) && t < timeout); t+=2000L) {
    Thread.sleep(2000L);
  }
  return profileRegistry.hasProfile(version,profile);
}
