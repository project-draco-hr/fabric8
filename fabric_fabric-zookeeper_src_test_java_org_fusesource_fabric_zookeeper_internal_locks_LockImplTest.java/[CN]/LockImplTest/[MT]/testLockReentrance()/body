{
  String id="00000001";
  IZKClient zooKeeper=createMock(IZKClient.class);
  String path="/my/lock";
  LockImpl lock=new LockImpl(zooKeeper,path);
  expect(zooKeeper.exists(path)).andReturn(new Stat()).times(2);
  expect(zooKeeper.create(ZkPath.LOCK.getPath(path),CreateMode.EPHEMERAL_SEQUENTIAL)).andReturn("/my/lock/" + id).once();
  expect(zooKeeper.getChildren(path)).andReturn(Arrays.asList(id)).times(2);
  replay(zooKeeper);
  assertTrue(lock.tryLock(30,TimeUnit.SECONDS));
  assertTrue(lock.tryLock(30,TimeUnit.SECONDS));
  verify(zooKeeper);
}
