{
  String id="00000002";
  String competitor="00000001";
  IZKClient zooKeeper=createMock(IZKClient.class);
  String path="/my/lock";
  LockImpl lock=new LockImpl(zooKeeper,path);
  expect(zooKeeper.exists(path)).andReturn(new Stat()).once();
  expect(zooKeeper.create(ZkPath.LOCK.getPath(path),CreateMode.EPHEMERAL_SEQUENTIAL)).andReturn("/my/lock/" + id).once();
  expect(zooKeeper.getChildren(path)).andReturn(Arrays.asList(id,competitor)).anyTimes();
  expect(zooKeeper.exists(eq(path),EasyMock.<Watcher>anyObject())).andReturn(new Stat()).once();
  replay(zooKeeper);
  assertFalse(lock.tryLock(5,TimeUnit.SECONDS));
  verify(zooKeeper);
}
