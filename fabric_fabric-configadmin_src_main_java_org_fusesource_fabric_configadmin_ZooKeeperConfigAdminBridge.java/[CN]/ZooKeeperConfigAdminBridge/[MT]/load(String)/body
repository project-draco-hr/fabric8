{
  try {
    Hashtable props=new Hashtable();
    load(pid,node,props);
    InterpolationHelper.performSubstitution(props,new InterpolationHelper.SubstitutionCallback(){
      public String getValue(      String key){
        if (key.startsWith("zk:")) {
          try {
            return new String(ZkPath.loadURL(zooKeeper,key),"UTF-8");
          }
 catch (          KeeperException.ConnectionLossException e) {
            throw new RuntimeException(e);
          }
catch (          Exception e) {
            LOGGER.warn("Could not load zk value: {}. This exception will be ignored.",key,e);
          }
        }
 else {
          String value=key;
          BundleContext context=getBundleContext();
          if (context != null) {
            value=context.getProperty(key);
          }
          if (value == null) {
            value=System.getProperty(value,"");
          }
          return value;
        }
        return key;
      }
    }
);
    return props;
  }
 catch (  InterruptedException e) {
    throw (IOException)new InterruptedIOException("Error loading pid " + pid).initCause(e);
  }
catch (  KeeperException e) {
    throw (IOException)new IOException("Error loading pid " + pid).initCause(e);
  }
}
