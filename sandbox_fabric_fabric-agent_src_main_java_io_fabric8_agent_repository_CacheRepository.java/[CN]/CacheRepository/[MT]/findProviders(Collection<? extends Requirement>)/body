{
  List<Requirement> missing=new ArrayList<Requirement>();
  Map<Requirement,Collection<Capability>> result=new HashMap<Requirement,Collection<Capability>>();
  for (  Requirement requirement : requirements) {
    Collection<Capability> caps=cache.get(requirement);
    if (caps == null) {
      missing.add(requirement);
    }
 else {
      result.put(requirement,caps);
    }
  }
  Map<Requirement,Collection<Capability>> newCache=repository.findProviders(missing);
  for (  Requirement requirement : newCache.keySet()) {
    cache.put(requirement,newCache.get(requirement));
    result.put(requirement,newCache.get(requirement));
  }
  return result;
}
