{
  assertValid();
  try {
    String path=ZkProfiles.getPath(version,profile);
    String configPath=path + "/" + fileName;
    if (exists(getCurator(),configPath) != null && getChildren(getCurator(),configPath).size() > 0) {
      List<String> kids=getChildren(getCurator(),configPath);
      ArrayList<String> saved=new ArrayList<String>();
      for (      String line : new String(configuration).split("\n")) {
        if (line.startsWith("#") || line.length() == 0) {
          continue;
        }
        String nameValue[]=line.split("=",2);
        if (nameValue.length < 2) {
          continue;
        }
        String newPath=configPath + "/" + nameValue[0].trim();
        setData(getCurator(),newPath,nameValue[1].trim());
        saved.add(nameValue[0].trim());
      }
      for (      String kid : kids) {
        if (!saved.contains(kid)) {
          deleteSafe(getCurator(),configPath + "/" + kid);
        }
      }
    }
 else {
      setData(getCurator(),configPath,configuration);
    }
  }
 catch (  Exception e) {
    throw FabricException.launderThrowable(e);
  }
}
