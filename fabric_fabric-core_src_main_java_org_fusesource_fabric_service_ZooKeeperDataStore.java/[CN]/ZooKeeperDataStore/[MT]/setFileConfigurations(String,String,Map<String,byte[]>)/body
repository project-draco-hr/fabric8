{
  assertValid();
  try {
    Map<String,byte[]> oldCfgs=getFileConfigurations(version,profile);
    String path=ZkProfiles.getPath(version,profile);
    for (    Map.Entry<String,byte[]> entry : configurations.entrySet()) {
      String pid=entry.getKey();
      oldCfgs.remove(pid);
      byte[] newCfg=entry.getValue();
      setFileConfiguration(version,profile,pid,newCfg);
    }
    for (    String pid : oldCfgs.keySet()) {
      deleteSafe(getCurator(),path + "/" + pid);
    }
  }
 catch (  Exception e) {
    throw new FabricException(e);
  }
}
