{
  URL url=createUploadURL(message);
  HttpURLConnection connection=(HttpURLConnection)url.openConnection();
  connection.setRequestMethod("PUT");
  connection.setDoOutput(true);
  connection.setChunkedStreamingMode(transferPolicy.getBufferSize());
  OutputStream os=connection.getOutputStream();
  byte[] buf=new byte[transferPolicy.getBufferSize()];
  for (int c=fis.read(buf); c != -1; c=fis.read(buf)) {
    os.write(buf,0,c);
    os.flush();
  }
  os.close();
  fis.close();
  if (!isSuccessfulCode(connection.getResponseCode())) {
    throw new IOException("PUT was not successful: " + connection.getResponseCode() + " "+ connection.getResponseMessage());
  }
  return url;
}
