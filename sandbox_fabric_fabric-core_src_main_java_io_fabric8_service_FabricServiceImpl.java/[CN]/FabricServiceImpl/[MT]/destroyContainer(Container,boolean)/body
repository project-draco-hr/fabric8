{
  assertValid();
  String containerId=container.getId();
  Exception providerException=null;
  LOGGER.info("Destroying container {}",containerId);
  boolean destroyed=false;
  boolean invalidContainer=false;
  try {
    ContainerProvider provider=getProvider(container,true);
    if (provider != null) {
      try {
        provider.stop(container);
      }
 catch (      Exception ex) {
        boolean stopped="Instance already stopped".equals(ex.getMessage());
        if (!stopped) {
          providerException=ex;
        }
      }
      provider.destroy(container);
      destroyed=true;
    }
 else {
      invalidContainer=true;
      throw new FabricException("Container's lifecycle not managed by Fabric8 (the container was not created by Fabric8).");
    }
  }
  finally {
    try {
      if (destroyed || force || invalidContainer) {
        try {
          portService.get().unregisterPort(container);
        }
 catch (        Exception e) {
          LOGGER.warn("Failed to cleanup container {} entries due to: {}. This will be ignored.",containerId,e.getMessage());
        }
        dataStore.get().deleteContainer(this,container.getId());
      }
    }
 catch (    Exception e) {
      LOGGER.warn("Failed to cleanup container {} entries due to: {}. This will be ignored.",containerId,e.getMessage());
    }
    if (providerException != null) {
      throw FabricException.launderThrowable(providerException);
    }
  }
}
