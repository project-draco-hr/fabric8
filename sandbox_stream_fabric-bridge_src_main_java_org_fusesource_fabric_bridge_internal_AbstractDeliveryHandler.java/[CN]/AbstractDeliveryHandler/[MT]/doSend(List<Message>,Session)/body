{
  MessageProducer messageProducer=null;
  try {
    ProducerCallback<Message> producerCallback=createProducerCallback(messages);
    if (isReuseSession()) {
      messageProducer=createMessageProducer(localSession);
      producerCallback.doInJms(localSession,messageProducer);
    }
 else {
      if (jmsTemplate == null) {
        jmsTemplate=createJmsTemplate();
      }
      jmsTemplate.execute(producerCallback);
    }
  }
  finally {
    if (messageProducer != null) {
      try {
        messageProducer.close();
      }
 catch (      JMSException e) {
      }
    }
  }
}
