{
  Preconditions.checkNotNull(policy,"policy cannot be null");
  RetryPolicy newPolicy=new RetryPolicy(){
    @Override public boolean allowRetry(    int retryCount,    long elapsedTimeMs,    RetrySleeper sleeper){
      if (!started.get()) {
        return false;
      }
      Thread thread=Thread.currentThread();
      try {
        retryingThreads.add(thread);
        return policy.allowRetry(retryCount,elapsedTimeMs,sleeper);
      }
  finally {
        retryingThreads.remove(thread);
      }
    }
  }
;
  retryPolicy.set(policy);
}
