{
  if (newState == ConnectionState.CONNECTED || newState == ConnectionState.READ_ONLY || newState == ConnectionState.RECONNECTED) {
    if (registration == null) {
      registration=bundleContext.registerService(CuratorFramework.class,curator,null);
    }
  }
  for (  ConnectionStateListener listener : connectionStateListeners) {
    listener.stateChanged(client,newState);
  }
  if (newState == ConnectionState.LOST) {
    run();
  }
}
