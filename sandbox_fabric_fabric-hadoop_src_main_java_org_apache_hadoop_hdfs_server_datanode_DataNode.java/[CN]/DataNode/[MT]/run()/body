{
  LOG.info(dnRegistration + "In DataNode.run, data = " + data);
  dataXceiverServer.start();
  ipcServer.start();
  while (shouldRun) {
    try {
      startDistributedUpgradeIfNeeded();
      offerService();
    }
 catch (    Exception ex) {
      LOG.error("Exception: " + StringUtils.stringifyException(ex));
      if (shouldRun) {
        try {
          Thread.sleep(5000);
        }
 catch (        InterruptedException ie) {
        }
      }
    }
  }
  LOG.info(dnRegistration + ":Finishing DataNode in: " + data);
  shutdown();
}
