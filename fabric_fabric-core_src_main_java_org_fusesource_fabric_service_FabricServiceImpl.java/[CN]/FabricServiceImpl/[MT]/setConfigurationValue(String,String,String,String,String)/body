{
  assertValid();
  Version v=getVersion(versionId);
  if (v == null)   throw new FabricException("No version found: " + versionId);
  Profile pr=v.getProfile(profileId);
  if (pr == null)   throw new FabricException("No profile found: " + profileId);
  Map<String,byte[]> configs=pr.getFileConfigurations();
  byte[] b=configs.get(pid);
  Properties p=null;
  try {
    if (b != null) {
      p=DataStoreHelpers.toProperties(b);
    }
 else {
      p=new Properties();
    }
    p.setProperty(key,value);
    b=DataStoreHelpers.toBytes(p);
    configs.put(pid,b);
    pr.setFileConfigurations(configs);
  }
 catch (  Throwable t) {
    throw new FabricException(t);
  }
}
