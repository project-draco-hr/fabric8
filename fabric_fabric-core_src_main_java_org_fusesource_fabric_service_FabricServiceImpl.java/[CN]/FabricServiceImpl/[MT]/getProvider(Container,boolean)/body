{
  CreateContainerMetadata metadata=container.getMetadata();
  String type=metadata != null ? metadata.getCreateOptions().getProviderType() : null;
  if (type == null) {
    if (returnNull) {
      return null;
    }
    throw new UnsupportedOperationException("Container " + container.getId() + " has not been created using Fabric");
  }
  ContainerProvider provider=getProvider(type);
  if (provider == null) {
    if (returnNull) {
      return null;
    }
    throw new UnsupportedOperationException("Container provider " + type + " not supported");
  }
  return provider;
}
