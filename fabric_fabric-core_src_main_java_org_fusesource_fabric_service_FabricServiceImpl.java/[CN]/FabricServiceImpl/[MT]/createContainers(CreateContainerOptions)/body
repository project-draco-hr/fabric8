{
  try {
    ContainerProvider provider=getProvider(options.getProviderType());
    if (provider == null) {
      throw new FabricException("Unable to find a container provider supporting '" + options.getProviderType() + "'");
    }
    Set<? extends CreateContainerMetadata> metadatas=provider.create(options);
    for (    CreateContainerMetadata metadata : metadatas) {
      if (metadata.isSuccess()) {
        Container parent=options.getParent() != null ? getContainer(options.getParent()) : null;
        if (!options.isEnsembleServer()) {
          getDataStore().createContainerConfig(metadata);
        }
        ContainerImpl container=new ContainerImpl(parent,metadata.getContainerName(),FabricServiceImpl.this);
        metadata.setContainer(container);
        container.setMetadata(metadata);
        LOGGER.info("The container " + metadata.getContainerName() + " has been successfully created");
      }
 else {
        LOGGER.info("The creation of the container " + metadata.getContainerName() + " has failed",metadata.getFailure());
      }
    }
    return metadatas.toArray(new CreateContainerMetadata[metadatas.size()]);
  }
 catch (  FabricException e) {
    LOGGER.error("Failed to create container " + e,e);
    throw e;
  }
catch (  Exception e) {
    LOGGER.error("Failed to create container " + e,e);
    throw new FabricException(e);
  }
}
