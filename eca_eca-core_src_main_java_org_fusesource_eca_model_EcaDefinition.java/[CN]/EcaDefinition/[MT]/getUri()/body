{
  String result=super.getUri();
  if (createdUri == null || createdUri.equals(result) == false) {
    URI u;
    try {
      u=new URI(UnsafeUriCharactersEncoder.encode(result));
      String path=u.getSchemeSpecificPart();
      String scheme=u.getScheme();
      if (scheme == null || path == null) {
        return result;
      }
      if (path.startsWith("//")) {
        path=path.substring(2);
      }
      int idx=path.indexOf('?');
      if (idx > 0) {
        path=path.substring(0,idx);
      }
      Map parameters=URISupport.parseParameters(u);
      parameters.put(EcaEndpoint.PATTERN_NAME,getEvaluation());
      parameters.put(EcaEndpoint.WINDOW_NAME,getEventWindow());
      Map<Object,Object> sorted=new LinkedHashMap<Object,Object>(parameters.size());
      List<String> keys=new ArrayList<String>(parameters.keySet());
      Collections.sort(keys);
      for (      String key : keys) {
        sorted.put(key,parameters.get(key));
      }
      String query=URISupport.createQueryString(sorted);
      result=scheme + "://" + path+ "?"+ query;
      this.createdUri=result;
      setUri(result);
    }
 catch (    URISyntaxException e) {
      throw new RuntimeCamelException("Failed to parse uri: " + result,e);
    }
  }
  return result;
}
