{
  FabricService fabricService=getFabricService();
  System.err.println(executeCommand("fabric:create -n"));
  CuratorFramework curator=getCurator();
  String version=System.getProperty("fabric.version");
  System.err.println(executeCommand("admin:create --java-opts \"-Dzookeeper.url=localhost:2181 -Dzookeeper.password=admin\" --featureURL mvn:org.fusesource.fabric/fuse-fabric/" + version + "/xml/features --feature fabric-agent child1"));
  System.err.println(executeCommand("admin:create --java-opts \"-Dzookeeper.url=localhost:2181 -Dzookeeper.password=admin\" --featureURL mvn:org.fusesource.fabric/fuse-fabric/" + version + "/xml/features --feature fabric-agent child2"));
  try {
    System.err.println(executeCommand("admin:start child1"));
    System.err.println(executeCommand("admin:start child2"));
    Container child1=fabricService.getContainer("child1");
    Container child2=fabricService.getContainer("child2");
    waitForProvisionSuccess(child1,PROVISION_TIMEOUT,TimeUnit.MILLISECONDS);
    waitForProvisionSuccess(child2,PROVISION_TIMEOUT,TimeUnit.MILLISECONDS);
    System.err.println(executeCommand("fabric:ensemble-add --force child1 child2"));
    Thread.sleep(5000);
    curator.getZookeeperClient().blockUntilConnectedOrTimedOut();
    System.err.println(executeCommand("fabric:container-list"));
    System.err.println(executeCommand("fabric:ensemble-remove --force child1 child2"));
    Thread.sleep(5000);
    curator.getZookeeperClient().blockUntilConnectedOrTimedOut();
    System.err.println(executeCommand("fabric:container-list"));
  }
  finally {
    System.err.println(executeCommand("admin:stop child1"));
    System.err.println(executeCommand("admin:stop child2"));
  }
}
