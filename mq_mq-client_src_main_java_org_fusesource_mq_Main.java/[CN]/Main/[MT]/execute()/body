{
  ActiveMQService fabricActiveMQService=new ActiveMQService(brokerUrl);
  System.out.println("Using destination: " + destination + ", on broker: "+ brokerUrl);
  if ("producer".equals(action)) {
    ProducerThread producerThread=new ProducerThread(fabricActiveMQService,destination);
    producerThread.setMessageCount(count);
    producerThread.run();
    System.out.println("Produced: " + producerThread.getSentCount());
  }
 else   if ("consumer".equals(action)) {
    ConsumerThread consumerThread=new ConsumerThread(fabricActiveMQService,destination);
    consumerThread.setMessageCount(count);
    System.out.println("Waiting for: " + count + " messages");
    consumerThread.run();
    System.out.println("Consumed: " + consumerThread.getReceived() + " messages");
  }
 else {
    displayHelpAndExit(1);
  }
}
