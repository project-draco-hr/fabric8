{
  String resolvedBrokerUrl;
  if (!brokerUrl.isEmpty()) {
    resolvedBrokerUrl=brokerUrl;
  }
 else {
    resolvedBrokerUrl=brokerUrlResolver.brokerUrl();
  }
  ActiveMQConnectionFactory amqConnectionFactory=new ActiveMQConnectionFactory(resolvedBrokerUrl);
  if (!brokerUsername.isEmpty()) {
    amqConnectionFactory.setUserName(brokerUsername);
  }
  if (!brokerPassword.isEmpty()) {
    amqConnectionFactory.setPassword(brokerPassword);
  }
  PooledConnectionFactory pooledConnectionFactory=new PooledConnectionFactory();
  pooledConnectionFactory.setConnectionFactory(amqConnectionFactory);
  return pooledConnectionFactory;
}
