{
  ClassLoader cl=Thread.currentThread().getContextClassLoader();
  try {
    Thread.currentThread().setContextClassLoader(Auditor.class.getClassLoader());
    CompiledTemplate template=getTemplate(eventType,messageReference);
    Map<String,Object> vars=new HashMap<String,Object>();
    vars.put("event",eventType);
    vars.put("host",System.getProperty("karaf.name"));
    vars.put("timestamp",new Date());
    vars.put("message",messageReference.getMessage());
    vars.put("messageReference",messageReference);
    return TemplateRuntime.execute(template,context,vars).toString();
  }
  finally {
    Thread.currentThread().setContextClassLoader(cl);
  }
}
