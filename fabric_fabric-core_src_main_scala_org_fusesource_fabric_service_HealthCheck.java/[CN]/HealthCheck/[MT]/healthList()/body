{
  List<HealthStatus> answer=new ArrayList<HealthStatus>();
  FabricStatus status=fabricService.getFabricStatus();
  Collection<ProfileStatus> statuses=status.getProfileStatusMap().values();
  for (  ProfileStatus profile : statuses) {
    String id=profile.getProfile();
    int instances=profile.getCount();
    Integer minimum=profile.getMinimumInstances();
    Integer maximum=profile.getMaximumInstances();
    double healthPercent=profile.getHealth(instances);
    String level="INFO";
    String message="" + id + " has healthPercent "+ percentInstance.format(healthPercent);
    if (minimum != null) {
      if (instances <= 0) {
        level="ERROR";
        message="" + id + " has no instances running! Should have at least "+ minimum;
      }
 else       if (instances < minimum) {
        level="WARNING";
        message="" + id + " needs more instances runing. Should have at least "+ minimum+ " but currently has only "+ instances;
      }
    }
    if (maximum != null && level.equals("INFO") && instances > maximum) {
      level="WARNING";
      message="" + id + " has too many instances running. Should have at most "+ maximum+ " but currently has only "+ instances;
    }
    answer.add(new HealthStatus("org.fusesource.fabric.profileHealth",id,level,message,instances,minimum,maximum,healthPercent));
  }
  return answer;
}
