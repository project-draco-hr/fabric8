{
  reset(bundleContext,serverStatsRegistration,managedServiceRegistration,zkClientRegistration);
  expect(bundleContext.registerService(aryEq(new String[]{ServerStats.Provider.class.getName()}),anyObject(),(Dictionary)anyObject())).andReturn(serverStatsRegistration);
  expect(bundleContext.getServiceReferences(LifecycleListener.class.getName(),null)).andReturn(null).anyTimes();
  replay(bundleContext,serverStatsRegistration,managedServiceRegistration,zkClientRegistration);
  Hashtable properties=new Hashtable();
  properties.put("tickTime","2000");
  properties.put("initLimit","10");
  properties.put("syncLimit","5");
  properties.put("dataDir","target/data/zookeeper/" + System.currentTimeMillis());
  properties.put("clientPort",Integer.toString(port));
  serverFactory.updated("pid",properties);
  Thread.sleep(1000);
  verify(bundleContext,serverStatsRegistration,managedServiceRegistration,zkClientRegistration);
}
