{
  if (m_capSet.remove(cap)) {
    for (    Entry<String,Map<Object,Set<Capability>>> entry : m_indices.entrySet()) {
      Object value=cap.getAttributes().get(entry.getKey());
      if (value != null) {
        if (value.getClass().isArray()) {
          value=convertArrayToList(value);
        }
        Map<Object,Set<Capability>> index=entry.getValue();
        if (value instanceof Collection) {
          Collection c=(Collection)value;
          for (          Object o : c) {
            deindexCapability(index,cap,o);
          }
        }
 else {
          deindexCapability(index,cap,value);
        }
      }
    }
  }
}
