{
  try {
    String path=req.getPathInfo();
    if (path == null) {
      resp.setStatus(HttpServletResponse.SC_BAD_REQUEST);
      return;
    }
    if (path.startsWith("/")) {
      path=path.substring(1);
    }
    UploadContext result;
    String location=req.getHeader(LOCATION_HEADER);
    if (location != null) {
      result=move(location,path);
    }
 else {
      result=doUpload(req.getInputStream(),path);
    }
    if (result.status()) {
      handleDeploy(req,result);
      addHeaders(resp,result.headers());
      resp.setStatus(HttpServletResponse.SC_ACCEPTED);
    }
 else {
      resp.setStatus(HttpServletResponse.SC_NOT_ACCEPTABLE);
    }
  }
 catch (  InvalidMavenArtifactRequest ex) {
    resp.setStatus(HttpServletResponse.SC_BAD_REQUEST);
    resp.setContentLength(0);
    resp.flushBuffer();
  }
catch (  Exception ex) {
    resp.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);
    resp.setContentLength(0);
    resp.flushBuffer();
  }
}
