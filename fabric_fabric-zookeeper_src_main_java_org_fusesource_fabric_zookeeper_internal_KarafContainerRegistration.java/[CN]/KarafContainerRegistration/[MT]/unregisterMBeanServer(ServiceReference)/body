{
  if (mbeanServer != null) {
    try {
      semaphore.acquire();
      mbeanServer.removeNotificationListener(new ObjectName("JMImplementation:type=MBeanServerDelegate"),this);
      unregisterDomains();
    }
 catch (    Exception e) {
      logger.warn("An error occurred during mbean server unregistration. This exception will be ignored.",e);
    }
 finally {
      semaphore.release();
    }
  }
  mbeanServer=null;
  bundleContext.ungetService(ref);
}
