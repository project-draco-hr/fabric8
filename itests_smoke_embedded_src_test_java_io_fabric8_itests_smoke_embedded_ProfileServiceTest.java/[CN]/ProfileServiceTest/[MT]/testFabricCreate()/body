{
  Builder<?> builder=CreateEnsembleOptions.builder().agentEnabled(false).clean(true).zookeeperPassword(SYSTEM_PASSWORD).waitForProvision(false);
  CreateEnsembleOptions options=builder.build();
  ZooKeeperClusterBootstrap bootstrap=ServiceLocator.getRequiredService(ZooKeeperClusterBootstrap.class);
  bootstrap.create(options);
  ProfileService profileService=ServiceLocator.getRequiredService(ProfileService.class);
  Profile prfA10=ProfileBuilder.Factory.create("1.0","prfA").addConfiguration("pidA",Collections.singletonMap("keyA","valA")).getProfile();
  prfA10=profileService.createProfile(prfA10);
  Assert.assertEquals("1.0",prfA10.getVersion());
  Assert.assertEquals("prfA",prfA10.getId());
  Assert.assertEquals("valA",prfA10.getConfiguration("pidA").get("keyA"));
  profileService.getRequiredVersion("1.0").getRequiredProfile("prfA");
  Version v11=profileService.createVersion("1.0","1.1",null);
  Profile prfA11=v11.getRequiredProfile("prfA");
  Assert.assertEquals("1.1",prfA11.getVersion());
  Assert.assertEquals("prfA",prfA11.getId());
  Assert.assertEquals("valA",prfA11.getConfiguration("pidA").get("keyA"));
  profileService.getRequiredVersion("1.0").getRequiredProfile("prfA");
  profileService.getRequiredVersion("1.1").getRequiredProfile("prfA");
  prfA11=ProfileBuilder.Factory.createFrom(prfA11).addConfiguration("pidA",Collections.singletonMap("keyB","valB")).getProfile();
  prfA11=profileService.updateProfile(prfA11);
  Assert.assertEquals("1.1",prfA11.getVersion());
  Assert.assertEquals("prfA",prfA11.getId());
  Assert.assertEquals("valB",prfA11.getConfiguration("pidA").get("keyB"));
  profileService.getRequiredVersion("1.0").getRequiredProfile("prfA");
  profileService.getRequiredVersion("1.1").getRequiredProfile("prfA");
}
