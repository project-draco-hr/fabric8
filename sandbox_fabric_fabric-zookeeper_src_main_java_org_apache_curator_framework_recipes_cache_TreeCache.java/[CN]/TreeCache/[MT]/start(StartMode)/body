{
  Preconditions.checkState(!executorService.isShutdown(),"already started");
  mode=Preconditions.checkNotNull(mode,"mode cannot be null");
  client.getConnectionStateListenable().addListener(connectionStateListener);
  executorService.execute(new Runnable(){
    @Override public void run(){
      mainLoop();
    }
  }
);
switch (mode) {
case NORMAL:
{
      offerOperation(new TreeRefreshOperation(this,path,RefreshMode.STANDARD));
      break;
    }
case BUILD_INITIAL_CACHE:
{
    rebuild();
    break;
  }
case POST_INITIALIZED_EVENT:
{
  initialSet.set(Maps.<String,ChildData>newConcurrentMap());
  offerOperation(new TreeRefreshOperation(this,path,RefreshMode.POST_INITIALIZED));
  break;
}
}
}
