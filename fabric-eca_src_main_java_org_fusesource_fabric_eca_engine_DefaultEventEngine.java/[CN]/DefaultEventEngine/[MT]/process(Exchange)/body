{
  if (exchange == null) {
    return;
  }
  String fromId=exchange.getFromRouteId();
  if (fromId == null) {
    fromId=exchange.getFromEndpoint().getEndpointUri();
  }
  if (fromId == null) {
    LOG.warn("Cannot process an exchange with no route or endpoint information: {}",exchange);
    return;
  }
  EventCache<Exchange> eventCache=eventCacheManager.lookupCache(Exchange.class,fromId);
  if (eventCache == null) {
    fromId=exchange.getFromEndpoint().getEndpointKey();
    eventCache=eventCacheManager.lookupCache(Exchange.class,fromId);
  }
  if (eventCache != null) {
    if (eventCache.add(exchange)) {
      List<ExpressionHolder> expressionHolders=fromToExpressionMap.get(fromId);
      for (      ExpressionHolder expressionHolder : expressionHolders) {
        if (expressionHolder.expression.isMatch()) {
          if (expressionHolder.listener != null) {
            expressionHolder.listener.expressionFired(expressionHolder.expression,exchange);
          }
        }
      }
    }
 else {
      LOG.debug("Ignoring - already fired for exchange: {}",exchange);
    }
  }
 else {
    LOG.warn("Cannot find cache for a route or endpoint named: {} for exchange: {}",fromId,exchange);
  }
}
