{
  gitReadOperation(new GitOperation<Object>(){
    public Object call(    Git git,    GitContext context) throws Exception {
      List<String> profiles=new ArrayList<String>();
      checkoutVersion(git,version);
      File profilesDir=getProfilesDirectory(git);
      if (profilesDir.exists()) {
        File[] files=profilesDir.listFiles();
        if (files != null) {
          for (          File file : files) {
            if (file.isDirectory()) {
              String profile=file.getName();
              profiles.add(profile);
              Map<String,byte[]> configs=doGetFileConfigurations(git,profile);
              configurationsCache.put(version + "/" + profile,configs);
              File profileDirectory=file;
              File metadataFile=new File(profileDirectory,AGENT_METADATA_FILE);
              Long answer=null;
              if (profileDirectory.exists()) {
                answer=profileDirectory.lastModified();
                if (metadataFile.exists()) {
                  long modified=metadataFile.lastModified();
                  if (modified > answer) {
                    answer=modified;
                  }
                }
              }
              profileLastModified.put(version + "/" + profile,answer);
            }
          }
        }
      }
      profilesCache.put(version,profiles);
      return null;
    }
  }
);
}
