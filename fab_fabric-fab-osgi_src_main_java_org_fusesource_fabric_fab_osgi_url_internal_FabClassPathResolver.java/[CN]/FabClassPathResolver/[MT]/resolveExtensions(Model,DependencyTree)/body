{
  ModuleRegistry.VersionedModule module=moduleRegistry.getVersionedModule(moduleId);
  if (module != null) {
    Map<String,ModuleRegistry.VersionedModule> availableExtensions=module.getAvailableExtensions();
    String extensionsString="";
    for (    String enabledExtension : module.getEnabledExtensions()) {
      ModuleRegistry.VersionedModule extensionModule=availableExtensions.get(enabledExtension);
      if (extensionModule != null) {
        VersionedDependencyId id=extensionModule.getId();
        DependencyTreeResult result=resolver.collectDependencies(id.getGroupId(),id.getArtifactId(),id.getVersion(),id.getExtension(),id.getClassifier());
        if (result != null) {
          DependencyTree tree=result.getTree();
          sharedFilterText+=" " + emptyIfNull(tree.getManfiestEntry(ServiceConstants.INSTR_FAB_PROVIDED_DEPENDENCY));
          requireBundleFilterText+=" " + emptyIfNull(tree.getManfiestEntry(ServiceConstants.INSTR_FAB_DEPENDENCY_REQUIRE_BUNDLE));
          excludeFilterText+=" " + emptyIfNull(tree.getManfiestEntry(ServiceConstants.INSTR_FAB_EXCLUDE_DEPENDENCY));
          optionalDependencyText+=" " + emptyIfNull(tree.getManfiestEntry(ServiceConstants.INSTR_FAB_OPTIONAL_DEPENDENCY));
          sharedFilter=DependencyTreeFilters.parseShareFilter(sharedFilterText.trim());
          requireBundleFilter=DependencyTreeFilters.parseRequireBundleFilter(requireBundleFilterText.trim());
          excludePackageFilter=DependencyTreeFilters.parseExcludeFilter(excludeFilterText.trim());
          excludeOptionalFilter=DependencyTreeFilters.parseExcludeOptionalFilter(optionalDependencyText.trim());
          LOG.debug("Adding extension: " + tree.getDependencyId());
          if (extensionsString.length() != 0) {
            extensionsString+=" ";
          }
          extensionsString+=id;
          addChildDependency(tree);
        }
 else {
          LOG.debug("Could not resolve extension: " + id);
        }
      }
    }
    if (extensionsString.length() != 0) {
      instructions.put(ServiceConstants.INSTR_FAB_MODULE_ENABLED_EXTENSIONS,extensionsString);
    }
  }
}
