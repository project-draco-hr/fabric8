{
  fabricControllerManager=createFabricControllerManager();
  Fabric8ContainerConfiguration config=configuration.get();
  String profilesText=config.getProfiles();
  if (Strings.isNotBlank(profilesText)) {
    List<String> profiles=Arrays.asList(profilesText.split(","));
    System.out.println("Populating initial fabric node with the profiles: " + profiles);
    fabricControllerManager.setProfiles(profiles);
  }
  File baseDir=getBaseDir();
  String outputFolder=Strings.defaultIfEmpty(config.getWorkFolder(),"fabric8");
  File workDir=new File(baseDir,"target/" + outputFolder);
  System.out.println("Using " + workDir.getPath() + " to store the fabric8 installation");
  fabricControllerManager.setWorkDirectory(workDir);
  try {
    FabricController fabricController=FabricAssertions.assertFabricCreate(fabricControllerManager);
    controller.set(fabricController);
  }
 catch (  Exception e) {
    throw new LifecycleException("Failed to create fabric: " + e,e);
  }
  System.out.println("Created a controller " + controller.get());
}
