{
  long endTime=timeout == null ? 0 : timeout.futureTimeMillis(_clock);
  if (_state != state) {
synchronized (_lock) {
      while (_state != state) {
        ConcurrentUtils.awaitUntil(_clock,_lock,endTime);
      }
    }
  }
}
