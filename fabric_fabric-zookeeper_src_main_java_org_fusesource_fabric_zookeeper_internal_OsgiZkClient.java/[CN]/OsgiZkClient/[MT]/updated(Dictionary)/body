{
synchronized (_lock) {
    String url=System.getProperty("zookeeper.url");
    Timespan timeout=new Timespan(30,Timespan.TimeUnit.SECOND);
    if (properties != null) {
      if (properties.get("zookeeper.url") != null) {
        url=(String)properties.get("zookeeper.url");
      }
      if (properties.get("zookeeper.timeout") != null) {
        timeout=Timespan.parse((String)properties.get("zookeeper.timeout"));
      }
    }
    if (_factory == null && url == null || _factory != null && url != null && _factory.getConnectString().equals(url)) {
      return;
    }
    if (_state != State.NONE) {
      changeState(url != null ? State.RECONNECTING : State.NONE);
      try {
        _zk.close();
      }
 catch (      Throwable t) {
      }
      _zk=null;
      _factory=null;
    }
    if (url != null) {
      _factory=new ZooKeeperFactory(url,timeout,this);
      tryStart();
    }
    zkClientRegistration.setProperties(properties);
  }
}
