{
synchronized (_lock) {
    String url=System.getProperty("zookeeper.url");
    String password=System.getProperty("zookeeper.password");
    Map<String,String> acls=new HashMap<String,String>();
    if (properties != null) {
      if (properties.get("zookeeper.url") != null) {
        url=(String)properties.get("zookeeper.url");
      }
      if (properties.get("zookeeper.timeout") != null) {
        sessionTimeout=Timespan.parse((String)properties.get("zookeeper.timeout"));
      }
      if (properties.get("zookeeper.password") != null) {
        password=(String)properties.get("zookeeper.password");
      }
      for (Enumeration e=properties.keys(); e.hasMoreElements(); ) {
        String key=e.nextElement().toString();
        if (key.startsWith("acls.")) {
          String val=properties.get(key).toString();
          acls.put(key.substring("acls.".length()),val);
        }
      }
    }
    if (!acls.containsKey("/")) {
      acls.put("/","world:anyone:acdrw");
      acls.put("/fabric","auth::acdrw,world:anyone:");
    }
    setACLs(acls);
    setPassword(password);
    if (_factory == null && url == null || _factory != null && url != null && getConnectString().equals(url)) {
      return;
    }
    if (isConfigured()) {
      changeState(url != null ? State.RECONNECTING : State.NONE);
      try {
        _zk.close();
      }
 catch (      Throwable t) {
      }
      _zk=null;
      _factory=null;
    }
    if (url != null) {
      _factory=new ZooKeeperFactory(url,sessionTimeout,this);
      tryConnect();
    }
    zkClientRegistration.setProperties(properties);
  }
}
