{
  State state=_state;
  if (state == State.NONE) {
    throw new IllegalStateException("ZooKeeper client has not been configured yet. You need to either create an ensemble or join one.");
  }
 else   if (state != State.CONNECTED) {
    try {
      waitForConnected();
    }
 catch (    Exception e) {
      throw new IllegalStateException("Error waiting for ZooKeeper connection",e);
    }
  }
  IZooKeeper zk=_zk;
  if (zk == null) {
    throw new IllegalStateException("No ZooKeeper connection available");
  }
  return zk;
}
