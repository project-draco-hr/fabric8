{
  if (!tmpFolder.exists()) {
    tmpFolder.mkdirs();
  }
  if (localRepository.equals("")) {
    localRepository=System.getProperty("karaf.data") + File.separator + "maven"+ File.separator+ "proxy"+ File.separator+ "downloads";
  }
  if (system == null) {
    system=newRepositorySystem();
  }
  if (session == null) {
    session=newSession(system,localRepository);
  }
  repositories=new HashMap<String,RemoteRepository>();
  for (  String rep : remoteRepositories.split(",")) {
    String id="";
    RemoteRepository remoteRepository=null;
    rep=rep.trim();
    Matcher idMatcher=REPOSITORY_ID_REGEX.matcher(rep);
    if (idMatcher.matches()) {
      id=idMatcher.group(2);
      rep=cleanUpRepositorySpec(rep);
      remoteRepository=new RemoteRepository(id + Math.abs(rep.hashCode()),"default",rep);
    }
 else {
      id="rep-" + rep.hashCode();
      rep=cleanUpRepositorySpec(rep);
      remoteRepository=new RemoteRepository("repo-" + Math.abs(rep.hashCode()),"default",rep);
    }
    remoteRepository.setPolicy(true,new RepositoryPolicy(true,updatePolicy,checksumPolicy));
    repositories.put(id,remoteRepository);
  }
  repositories.put("local",new RemoteRepository("local","default","file://" + localRepository));
  repositories.put("karaf",new RemoteRepository("karaf","default","file://" + System.getProperty("karaf.home") + File.separator+ System.getProperty("karaf.default.repository")));
}
