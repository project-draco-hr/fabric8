{
  try {
    LOG.info("Starting Fabric Bundles Test");
    LOG.debug("Configure logging");
    configurePid("org.ops4j.pax.logging");
    LOG.debug("Configure PAX Maven URL");
    configurePid("org.ops4j.pax.url.mvn");
    Thread.sleep(15000);
    LOG.debug("Test to ensure the Blueprint OBR is available");
    assertNotNull(getOsgiService(BlueprintContainer.class,"osgi.blueprint.container.symbolicname=org.apache.karaf.shell.obr",20000));
    LOG.debug("Test to ensure the Blueprint Wrapper is available");
    assertNotNull(getOsgiService(BlueprintContainer.class,"osgi.blueprint.container.symbolicname=org.apache.karaf.shell.wrapper",20000));
    commandProcessor=getOsgiService(CommandProcessor.class,20000);
    commandSession=commandProcessor.createSession(System.in,System.out,System.err);
    commandSession.execute("osgi:list -t 0");
    assertStartBundle("org.apache.karaf.shell.log");
    assertStartBundle("org.fusesource.fabric.fab.fab-osgi");
    Thread.sleep(5000);
    doInstallFabricBundles();
    Thread.sleep(5000);
    commandSession.execute("osgi:list -t 0");
    Thread.sleep(5000);
    stopBundles();
    commandSession.close();
  }
 catch (  Exception e) {
    LOG.error("Error executing the test probe: " + e.getLocalizedMessage(),e);
  }
}
