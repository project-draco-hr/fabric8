{
  String zookeeperUrl=curatorConfig.getZookeeperUrl();
  if (Strings.isNullOrBlank(zookeeperUrl)) {
    LOG.info("No ZooKeeper URL has been configured so creating a local ensemble server");
    serverFactory=new ZooKeeperServerFactory(peerConfig,"rootEnsembleNode");
    zookeeperUrl=serverFactory.getZooKeeperUrl();
    Objects.notNull(zookeeperUrl,"zookeeperUrl");
    curatorConfig.setZookeeperUrl(zookeeperUrl);
  }
  LOG.info("Connecting to ZooKeeper URL: {}",zookeeperUrl);
  List<ConnectionStateListener> connectionListenerList=new ArrayList<>();
  CuratorFramework curatorFramework=ManagedCuratorFramework.createCuratorFramework(curatorConfig,aclProvider,connectionListenerList);
  curatorFramework.start();
  return curatorFramework;
}
