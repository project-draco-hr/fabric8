{
  ModuleContext syscontext=EmbeddedUtils.getEmbeddedRuntime().getModuleContext();
  final CountDownLatch latch=new CountDownLatch(1);
  ServiceListener listener=new ServiceListener(){
    @Override public void serviceChanged(    ServiceEvent event){
      if (event.getType() == ServiceEvent.REGISTERED)       latch.countDown();
    }
  }
;
  syscontext.addServiceListener(listener,"(objectClass=" + BootstrapComplete.class.getName() + ")");
  for (  String name : moduleNames) {
    ClassLoader classLoader=AbstractEmbeddedTest.class.getClassLoader();
    try {
      EmbeddedUtils.installAndStartModule(classLoader,name);
    }
 catch (    Exception e) {
      System.out.println("Failed to load module " + name + " on classloader "+ classLoader+ ". "+ e);
      throw e;
    }
  }
  Assert.assertTrue("BootstrapComplete registered",latch.await(20,TimeUnit.SECONDS));
}
