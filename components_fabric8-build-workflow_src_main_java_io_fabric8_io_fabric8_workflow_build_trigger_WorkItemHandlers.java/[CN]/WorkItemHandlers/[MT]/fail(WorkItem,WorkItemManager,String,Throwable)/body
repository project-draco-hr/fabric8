{
  if (exception instanceof UndeclaredThrowableException) {
    UndeclaredThrowableException undeclaredThrowableException=(UndeclaredThrowableException)exception;
    Throwable undeclaredThrowable=undeclaredThrowableException.getUndeclaredThrowable();
    if (undeclaredThrowable != null && !undeclaredThrowable.equals(exception)) {
      exception=undeclaredThrowable;
    }
  }
  String reason=message + ". Exception: " + exception;
  LOG.error("Failed work item " + workItem.getId() + ":"+ workItem.getName()+ ":  "+ reason,exception);
  completeWithFailureReason(workItem,manager,reason);
}
