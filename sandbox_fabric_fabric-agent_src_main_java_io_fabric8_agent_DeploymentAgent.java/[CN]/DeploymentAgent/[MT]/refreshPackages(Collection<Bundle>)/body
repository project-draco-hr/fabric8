{
  final CountDownLatch latch=new CountDownLatch(1);
  FrameworkWiring fw=systemBundleContext.getBundle().adapt(FrameworkWiring.class);
  fw.refreshBundles(bundles,new FrameworkListener(){
    @Override public void frameworkEvent(    FrameworkEvent event){
      if (event.getType() == FrameworkEvent.ERROR) {
        LOGGER.error("Framework error",event.getThrowable());
      }
      latch.countDown();
    }
  }
);
  latch.await();
}
