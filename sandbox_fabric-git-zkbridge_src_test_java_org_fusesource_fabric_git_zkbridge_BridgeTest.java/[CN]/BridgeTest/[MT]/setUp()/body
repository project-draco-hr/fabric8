{
  sfb=new ZKServerFactoryBean();
  delete(sfb.getDataDir());
  delete(sfb.getDataLogDir());
  sfb.afterPropertiesSet();
  CuratorFrameworkFactory.Builder builder=CuratorFrameworkFactory.builder().connectString("localhost:" + sfb.getClientPortAddress().getPort()).retryPolicy(new RetryOneTime(1000)).connectionTimeoutMs(360000);
  curator=builder.build();
  curator.start();
  curator.getZookeeperClient().blockUntilConnectedOrTimedOut();
  File root=new File(System.getProperty("basedir",".") + "/target/git").getCanonicalFile();
  delete(root);
  new File(root,"remote").mkdirs();
  remote=Git.init().setDirectory(new File(root,"remote")).call();
  remote.commit().setMessage("First Commit").setCommitter("fabric","user@fabric").call();
  new File(root,"local").mkdirs();
  git=Git.init().setDirectory(new File(root,"local")).call();
  git.commit().setMessage("First Commit").setCommitter("fabric","user@fabric").call();
  StoredConfig config=git.getRepository().getConfig();
  config.setString("remote","origin","url","file://" + new File(root,"remote").getCanonicalPath());
  config.setString("remote","origin","fetch","+refs/heads/*:refs/remotes/origin/*");
  config.save();
}
