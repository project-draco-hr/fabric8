{
  MessageProducer producer=null;
  String threadName=Thread.currentThread().getName();
  try {
    service.start();
    producer=service.createProducer(dest);
    producer.setDeliveryMode(persistent ? DeliveryMode.PERSISTENT : DeliveryMode.NON_PERSISTENT);
    producer.setTimeToLive(msgTTL);
    initPayLoad();
    running=true;
    LOG.info(threadName + " Started to calculate elapsed time ...\n");
    long tStart=System.currentTimeMillis();
    for (sentCount=0; sentCount < messageCount; sentCount++) {
      if (!running)       break;
      Message message=createMessage(sentCount);
      if ((msgGroupID != null) && (!msgGroupID.isEmpty()))       message.setStringProperty("JMSXGroupID",msgGroupID);
      producer.send(message);
      LOG.info(threadName + " Sent: " + (message instanceof TextMessage ? ((TextMessage)message).getText() : message.getJMSMessageID()));
      if (transactionBatchSize > 0 && sentCount > 0 && sentCount % transactionBatchSize == 0) {
        LOG.info(threadName + " Committing transaction: " + transactions++);
        service.getDefaultSession().commit();
      }
      if (sleep > 0) {
        Thread.sleep(sleep);
      }
    }
    LOG.info(threadName + " Produced: " + this.getSentCount()+ " messages");
    long tEnd=System.currentTimeMillis();
    long elapsed=(tEnd - tStart) / 1000;
    LOG.info(threadName + " Elapsed time in second : " + elapsed+ " s");
    LOG.info(threadName + " Elapsed time in milli second : " + (tEnd - tStart)+ " milli seconds");
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
 finally {
    if (producer != null) {
      try {
        producer.close();
        service.stop();
      }
 catch (      JMSException e) {
        e.printStackTrace();
      }
    }
  }
  LOG.info(threadName + " Producer thread finished");
}
