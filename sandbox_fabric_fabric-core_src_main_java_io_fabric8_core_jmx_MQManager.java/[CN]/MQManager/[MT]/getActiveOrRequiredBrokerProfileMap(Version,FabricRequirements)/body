{
  IllegalArgumentAssertion.assertNotNull(fabricService,"fabricService");
  List<Profile> answer=new ArrayList<Profile>();
  if (version != null) {
    ProfileService profileService=fabricService.adapt(ProfileService.class);
    List<Profile> profiles=version.getProfiles();
    for (    Profile profile : profiles) {
      String versionId=profile.getVersion();
      String profileId=profile.getId();
      if (requirements.hasMinimumInstances(profileId) || fabricService.getAssociatedContainers(versionId,profileId).length > 0) {
        Profile overlay=profileService.getOverlayProfile(profile);
        Map<String,Map<String,String>> configurations=overlay.getConfigurations();
        Set<Map.Entry<String,Map<String,String>>> entries=configurations.entrySet();
        for (        Map.Entry<String,Map<String,String>> entry : entries) {
          String key=entry.getKey();
          if (isBrokerConfigPid(key)) {
            answer.add(overlay);
          }
        }
      }
    }
  }
  return answer;
}
