{
  Runtime runtime=RuntimeLocator.getRuntime();
  Module module=runtime.getModule(identity);
  ModuleContext ctxA=module.getModuleContext();
  ServiceReference<ServiceD> srefD=ctxA.getServiceReference(ServiceD.class);
  Assert.assertNotNull("ServiceReference not null",srefD);
  ServiceD srvD=ctxA.getService(srefD);
  Assert.assertEquals("ServiceD#1:ServiceD1#1:null:Hello",srvD.doStuff("Hello"));
  ConfigurationAdmin configAdmin=getConfigurationAdmin(module);
  Configuration config=configAdmin.getConfiguration(ServiceD1.class.getName());
  Assert.assertNotNull("Config not null",config);
  Assert.assertNull("Config is empty, but was: " + config.getProperties(),config.getProperties());
  Dictionary<String,String> configProps=new Hashtable<String,String>();
  configProps.put("foo","bar");
  config.update(configProps);
  ServiceD1 srvD1=srvD.getServiceD1();
  Assert.assertTrue(srvD1.awaitModified(4000,TimeUnit.MILLISECONDS));
  Assert.assertEquals("ServiceD#1:ServiceD1#1:bar:Hello",srvD.doStuff("Hello"));
}
