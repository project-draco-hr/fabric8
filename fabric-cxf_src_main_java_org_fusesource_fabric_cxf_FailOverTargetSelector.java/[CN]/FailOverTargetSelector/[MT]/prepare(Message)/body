{
  Exchange exchange=message.getExchange();
  InvocationKey key=new InvocationKey(exchange);
  if (!inProgress.containsKey(key)) {
    Endpoint endpoint=exchange.get(Endpoint.class);
    BindingOperationInfo bindingOperationInfo=exchange.getBindingOperationInfo();
    Object[] params=message.getContent(List.class).toArray();
    Map<String,Object> context=CastUtils.cast((Map)message.get(Message.INVOCATION_CONTEXT));
    InvocationContext invocation=new InvocationContext(endpoint,bindingOperationInfo,params,context);
    inProgress.put(key,invocation);
  }
}
