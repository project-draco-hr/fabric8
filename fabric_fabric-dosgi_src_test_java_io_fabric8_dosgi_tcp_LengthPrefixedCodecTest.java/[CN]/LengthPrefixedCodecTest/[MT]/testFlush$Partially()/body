{
  final Buffer value=Buffer.ascii("TESTDATA");
  codec.write(value);
  final int bytesThatWillBeWritten=value.length() / 2;
  expect(writableByteChannel.write((ByteBuffer)anyObject())).andAnswer(createWriteAnswer(bytesThatWillBeWritten));
  replay(writableByteChannel);
  final BufferState state=codec.flush();
  assertEquals(BufferState.NOT_EMPTY,state);
  assertEquals(false,codec.full());
  assertEquals(false,codec.empty());
  assertEquals(bytesThatWillBeWritten,codec.getWriteCounter());
}
