{
  final Connection connection=AmqpConnectionFactory.create();
  connection.setOnClose(new Runnable(){
    public void run(){
      exit_latch.countDown();
    }
  }
);
  connection.connect(getConnectionURI(),new Runnable(){
    public void run(){
      onConnect(connection);
    }
  }
);
  try {
    System.out.println("Sending messages");
    exit_latch.await();
  }
 catch (  InterruptedException e) {
    e.printStackTrace();
  }
}
