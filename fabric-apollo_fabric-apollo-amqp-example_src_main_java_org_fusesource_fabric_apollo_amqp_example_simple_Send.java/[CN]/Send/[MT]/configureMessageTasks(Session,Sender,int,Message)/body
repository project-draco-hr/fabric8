{
  if (current_count >= count) {
    message.onAck(new Runnable(){
      public void run(){
        sender.detach();
      }
    }
);
  }
 else {
    message.onAck(new Runnable(){
      public void run(){
        sendMessage(session,sender,current_count + 1);
      }
    }
);
  }
}
