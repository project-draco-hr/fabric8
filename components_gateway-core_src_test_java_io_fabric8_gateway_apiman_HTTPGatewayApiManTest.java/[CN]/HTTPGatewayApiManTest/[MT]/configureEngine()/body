{
  int restPort=httpGatewayServer.getPort() - 1;
  HttpClient httpClient=new HttpClient();
  ObjectMapper mapper=new ObjectMapper();
  Service service=new Service();
  service.setServiceId("HelloWorld");
  service.setEndpoint("http://localhost:18181/root/");
  service.setVersion("1.0");
  service.setOrganizationId("Kurt");
  String serviceJson=mapper.writeValueAsString(service);
  LOG.info("Publishing HelloWorld Service");
  PutMethod method=new PutMethod("http://127.0.0.1:" + restPort + "/rest/apimanager/api/services/?apikey=apiman-config-key");
  RequestEntity requestEntity=new StringRequestEntity(serviceJson,"application/json","UTF-8");
  method.setRequestEntity(requestEntity);
  httpClient.executeMethod(method);
  Application clientApp=new Application();
  clientApp.setApplicationId("clientApp");
  clientApp.setOrganizationId("ClientOrg");
  clientApp.setVersion("1.0");
  Policy blackListPolicy=new Policy();
  blackListPolicy.setPolicyJsonConfig("{ \"ipList\" : [ \"127.0.0.1\" ] }");
  blackListPolicy.setPolicyImpl("class:" + IPBlacklistPolicy.class.getName());
  Contract silverContract=new Contract();
  silverContract.setApiKey(silverHelloServiceApiKey);
  silverContract.setServiceId(service.getServiceId());
  silverContract.setServiceOrgId(service.getOrganizationId());
  silverContract.setServiceVersion(service.getVersion());
  silverContract.getPolicies().add(blackListPolicy);
  clientApp.addContract(silverContract);
  Contract goldContract=new Contract();
  goldContract.setApiKey(goldHelloServiceApiKey);
  goldContract.setServiceId(service.getServiceId());
  goldContract.setServiceOrgId(service.getOrganizationId());
  goldContract.setServiceVersion(service.getVersion());
  clientApp.addContract(goldContract);
  String clientAppJson=mapper.writeValueAsString(clientApp);
  LOG.info("Register clientApp Application");
  method=new PutMethod("http://127.0.0.1:" + restPort + "/rest/apimanager/api/applications/?apikey=apiman-config-key");
  requestEntity=new StringRequestEntity(clientAppJson,"application/json","UTF-8");
  method.setRequestEntity(requestEntity);
  httpClient.executeMethod(method);
}
