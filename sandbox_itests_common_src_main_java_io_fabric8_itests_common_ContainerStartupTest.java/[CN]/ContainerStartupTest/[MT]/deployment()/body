{
  final ArchiveBuilder archive=new ArchiveBuilder("container-startup-test");
  archive.addClasses(RuntimeType.TOMCAT,AnnotatedContextListener.class);
  archive.addClasses(PasswordEncoder.class,Base64Encoder.class);
  archive.addPackage(CommandSupport.class.getPackage());
  archive.setContainerManifest(new Asset(){
    @Override public InputStream openStream(){
      if (ArchiveBuilder.getTargetContainer() == RuntimeType.KARAF) {
        OSGiContainerManifestBuilder builder=OSGiContainerManifestBuilder.newInstance();
        builder.addBundleContainerManifestVersion(2);
        builder.addBundleSymbolicName(archive.getName());
        builder.addBundleVersion("1.0.0");
        builder.addImportPackages(RuntimeLocator.class,FabricService.class);
        builder.addImportPackages(ConfigurationAdmin.class,Logger.class);
        return builder.openStream();
      }
 else {
        ContainerManifestBuilder builder=new ContainerManifestBuilder();
        builder.addIdentityCapability(archive.getName(),"1.0.0");
        builder.addContainerManifestHeader("Dependencies","org.jboss.gravia,io.fabric8.api");
        return builder.openStream();
      }
    }
  }
);
  return archive.getArchive();
}
