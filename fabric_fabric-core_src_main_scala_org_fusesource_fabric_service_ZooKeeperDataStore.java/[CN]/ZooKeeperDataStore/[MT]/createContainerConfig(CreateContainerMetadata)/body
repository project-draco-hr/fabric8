{
  try {
    CreateContainerOptions options=metadata.getCreateOptions();
    String containerId=metadata.getContainerName();
    String parent=options.getParent();
    String versionId=options.getVersion() != null ? options.getVersion() : getDefaultVersion();
    List<String> profileIds=options.getProfiles();
    if (profileIds == null || profileIds.isEmpty()) {
      profileIds=Collections.singletonList(ZkDefs.DEFAULT_PROFILE);
    }
    StringBuilder sb=new StringBuilder();
    for (    String profileId : profileIds) {
      if (sb.length() > 0) {
        sb.append(" ");
      }
      sb.append(profileId);
    }
    setData(zk,ZkPath.CONFIG_CONTAINER.getPath(containerId),versionId);
    setData(zk,ZkPath.CONFIG_VERSIONS_CONTAINER.getPath(versionId,containerId),sb.toString());
    setData(zk,ZkPath.CONTAINER_PARENT.getPath(containerId),parent);
    setData(zk,ZkPath.CONTAINER_METADATA.getPath(containerId),Base64Encoder.encode(ObjectUtils.toBytes(metadata)));
    Map<String,String> configuration=metadata.getContainerConfiguration();
    for (    Map.Entry<String,String> entry : configuration.entrySet()) {
      String key=entry.getKey();
      String value=entry.getValue();
      setData(zk,ZkPath.CONTAINER_ENTRY.getPath(metadata.getContainerName(),key),value);
    }
    if (options.getResolver() == null && exists(zk,ZkPath.CONTAINER_RESOLVER.getPath(containerId)) != null) {
      options.setResolver(getStringData(zk,ZkPath.CONTAINER_RESOLVER.getPath(containerId)));
    }
 else     if (options.getResolver() != null) {
    }
 else     if (exists(zk,ZkPath.POLICIES.getPath(ZkDefs.RESOLVER)) != null) {
      options.setResolver(getStringData(zk,ZkPath.POLICIES.getPath(ZkDefs.RESOLVER)));
    }
 else {
      options.setResolver(ZkDefs.DEFAULT_RESOLVER);
    }
    setData(zk,ZkPath.CONTAINER_RESOLVER.getPath(containerId),options.getResolver());
  }
 catch (  FabricException e) {
    throw e;
  }
catch (  Exception e) {
    throw new FabricException(e);
  }
}
