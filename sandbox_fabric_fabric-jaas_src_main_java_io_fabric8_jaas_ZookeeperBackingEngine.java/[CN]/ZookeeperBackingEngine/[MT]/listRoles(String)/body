{
  List<RolePrincipal> result=new ArrayList<RolePrincipal>();
  String userInfo=users.get(name);
  String[] infos=userInfo.split(",");
  for (int i=1; i < infos.length; i++) {
    String roleName=infos[i];
    if (roleName.startsWith(GROUP_PREFIX)) {
      for (      RolePrincipal rp : listRoles(roleName)) {
        if (!result.contains(rp)) {
          result.add(rp);
        }
      }
    }
 else {
      RolePrincipal rp=new RolePrincipal(roleName);
      if (!result.contains(rp)) {
        result.add(rp);
      }
    }
  }
  return result;
}
