{
  super.beforeMarshall(wireFormat);
  Buffer content=getContent();
  if (content == null && text != null) {
    ByteArrayOutputStream bytesOut=new ByteArrayOutputStream();
    OutputStream os=bytesOut;
    if (Settings.enable_compression()) {
      compressed=true;
      os=new DeflaterOutputStream(os);
    }
    DataOutputStream dataOut=new DataOutputStream(os);
    MarshallingSupport.writeUTF8(dataOut,this.text);
    dataOut.close();
    setContent(bytesOut.toBuffer());
  }
}
