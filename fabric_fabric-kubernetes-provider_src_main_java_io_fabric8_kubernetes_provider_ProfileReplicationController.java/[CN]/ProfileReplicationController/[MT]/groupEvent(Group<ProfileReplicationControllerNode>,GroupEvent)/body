{
  DataStore dataStore=fabricService.get().adapt(DataStore.class);
switch (event) {
case CONNECTED:
case CHANGED:
    if (isValid()) {
      ProfileReplicationControllerNode state=createState();
      try {
        if (group.isMaster()) {
          enableMasterZkCache(curator.get());
          LOGGER.info("ProfileReplicationController is the master");
          group.update(state);
          dataStore.trackConfiguration(runnable);
          enableTimer();
          onConfigurationChanged();
        }
 else {
          LOGGER.info("ProfileReplicationController is not the master");
          group.update(state);
          disableTimer();
          dataStore.untrackConfiguration(runnable);
          disableMasterZkCache();
        }
      }
 catch (      IllegalStateException e) {
      }
    }
 else {
      LOGGER.info("Not valid with master: " + group.isMaster() + " fabric: "+ fabricService.get()+ " curator: "+ curator.get());
    }
  break;
case DISCONNECTED:
dataStore.untrackConfiguration(runnable);
}
}
