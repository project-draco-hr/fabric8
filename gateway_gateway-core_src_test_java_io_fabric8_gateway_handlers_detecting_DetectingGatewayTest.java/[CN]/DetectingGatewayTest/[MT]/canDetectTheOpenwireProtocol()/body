{
  DetectingGateway gateway=createGateway();
  gateway.init();
  String url="tcp://localhost:" + gateway.getBoundPort() + "?wireFormat.host=broker0";
  final ActiveMQConnectionFactory factory=new ActiveMQConnectionFactory(url);
  Connection connection=factory.createConnection();
  connection.start();
  assertConnectedToBroker(0);
  assertEquals(1,gateway.getSuccessfulConnectionAttempts());
  assertEquals(1,gateway.getConnectedClients().length);
  connection.close();
}
