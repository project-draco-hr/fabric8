{
  DetectingGateway gateway=createGateway();
  final ConnectionFactoryImpl factory=new ConnectionFactoryImpl("localhost",gateway.getBoundPort(),"admin","password");
  Connection connection=factory.createConnection();
  connection.start();
  assertEquals(1,gateway.getSuccessfulConnectionAttempts());
  assertEquals(1,gateway.getConnectedClients().length);
  assertConnectedToBroker(1);
  connection.close();
}
