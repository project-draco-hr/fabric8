{
  T value=ref.get();
  long startAt=System.currentTimeMillis();
  long remaining=timeout;
  while (value == null && remaining > 0) {
    try {
      semaphore.tryAcquire(remaining,timeUnit);
      value=ref.get();
    }
 catch (    InterruptedException ex) {
      throw new DynamicReferenceException(String.format(INTERRUPTED_MESSAGE_FORMAT,name),ex);
    }
    remaining=timeout + startAt - System.currentTimeMillis();
  }
  if (value == null) {
    throw new DynamicReferenceException(String.format(TIMEOUT_MESSAGE_FORMAT,name));
  }
  return value;
}
