{
  T value=ref.get();
  long startAt=System.currentTimeMillis();
  long remaining=timeout;
  while (value == null && remaining > 0) {
    try {
      semaphore.tryAcquire(remaining,timeUnit);
      value=ref.get();
    }
 catch (    InterruptedException ex) {
      throw new DynamicReferenceException("Interrupted while waiting for dynamic reference.",ex);
    }
    remaining=timeout + startAt - System.currentTimeMillis();
  }
  if (value == null) {
    throw new DynamicReferenceException("Gave up waiting for dynamic reference.");
  }
  return value;
}
