{
  Set<String> bundles=new LinkedHashSet<String>();
  Set<Feature> features=new LinkedHashSet<Feature>();
  Profile profile=container.getOverlayProfile();
  bundles.addAll(profile.getBundles());
  AgentUtils.addFeatures(features,downloadManager,profile);
  if (copyFilesIntoGit) {
    copyDeploymentsIntoGit(git,baseDir,bundles,features);
  }
 else {
    addDeploymentsIntoPom(git,baseDir,bundles,features);
  }
  String message="updating deployment";
  git.commit().setMessage(message).call();
  enableDeployDirectory(git,baseDir);
  String branch=GitHelpers.currentBranch(git);
  LOG.info("Pushing deployment changes to branch " + branch + " credentials "+ credentials+ " for container "+ container.getId());
  try {
    Iterable<PushResult> results=git.push().setCredentialsProvider(credentials).setRefSpecs(new RefSpec(branch)).setOutputStream(new LoggingOutputStream(LOG)).call();
    LOG.info("Pushed deployment changes to branch " + branch + " for container "+ container.getId());
  }
 catch (  GitAPIException e) {
    LOG.error("Failed to push deployment changes to branch " + branch + " for container "+ container.getId()+ ". Reason: "+ e,e);
  }
}
