{
  String pid=AGENT_PID;
  boolean editInLine=false;
  Map<String,Map<String,String>> config=profile.getConfigurations();
  Map<String,String> pidConfig=config.get(pid);
  if (pidConfig == null) {
    pidConfig=new HashMap<String,String>();
  }
  if (delete || remove) {
    editInLine=true;
  }
  if (features != null && features.length > 0) {
    editInLine=true;
    handleFeatures(features,profile);
  }
  if (repositories != null && repositories.length > 0) {
    editInLine=true;
    handleFeatureRepositories(repositories,profile);
  }
  if (bundles != null && bundles.length > 0) {
    editInLine=true;
    handleBundles(bundles,profile);
  }
  if (fabs != null && fabs.length > 0) {
    editInLine=true;
    handleFabs(fabs,profile);
  }
  if (overrides != null && overrides.length > 0) {
    editInLine=true;
    handleOverrides(overrides,profile);
  }
  if (pidProperties != null && pidProperties.length > 0) {
    handlePid(pidProperties,profile);
  }
  if (systemProperties != null && systemProperties.length > 0) {
    editInLine=true;
    handleSystemProperties(systemProperties,profile);
  }
  if (configProperties != null && configProperties.length > 0) {
    editInLine=true;
    handleConfigProperties(configProperties,profile);
  }
  if (editInLine) {
    config.put(pid,pidConfig);
    profile.setConfigurations(config);
  }
 else {
    resource=resource != null ? resource : "org.fusesource.fabric.agent.properties";
    if (pidProperties != null && pidProperties.length == 1) {
      resource=pidProperties[0] + ".properties";
    }
    openInEditor(profile,resource);
  }
}
