{
  Subject.doAs(null,new PrivilegedExceptionAction<Object>(){
    @Override public Object run() throws Exception {
      ServiceReference ref=getBundleContext().getServiceReference(ConfigurationAdmin.class.getName());
      ConfigurationAdmin admin=ref != null ? getService(ConfigurationAdmin.class,ref) : null;
      org.osgi.service.cm.Configuration config=admin != null ? admin.getConfiguration(HadoopFactory.CONFIG_PID) : null;
      Dictionary dictionary=config != null ? config.getProperties() : null;
      if (dictionary == null) {
        throw new IllegalStateException("No configuration found for pid " + HadoopFactory.CONFIG_PID);
      }
      org.apache.hadoop.conf.Configuration conf=new org.apache.hadoop.conf.Configuration();
      for (Enumeration e=dictionary.keys(); e.hasMoreElements(); ) {
        Object key=e.nextElement();
        Object val=dictionary.get(key);
        conf.set(key.toString(),val.toString());
      }
      doExecute(conf);
      return null;
    }
  }
);
  return null;
}
