{
  String method=req.getMethod();
  String uri=req.getPathInfo();
  String content=loadFully(req.getInputStream(),req.getCharacterEncoding());
  try {
    ElasticRest rest=tracker.getService();
    if (rest != null) {
      String result;
      if ("GET".equals(method)) {
        result=rest.get(uri);
      }
 else       if ("POST".equals(method)) {
        result=rest.post(uri,content);
      }
 else       if ("PUT".equals(method)) {
        result=rest.put(uri,content);
      }
 else       if ("DELETE".equals(method)) {
        result=rest.delete(uri);
      }
 else       if ("HEAD".equals(method)) {
        result=rest.head(uri);
      }
 else {
        resp.sendError(HttpServletResponse.SC_NOT_IMPLEMENTED,"Unknown method " + method);
        return;
      }
      resp.getWriter().write(result);
    }
 else {
      resp.sendError(HttpServletResponse.SC_INTERNAL_SERVER_ERROR,"ElasticSearch service not available");
    }
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
