{
  ServiceReference reference=event.getServiceReference();
  if (bundleContext != null && reference != null) {
    int type=event.getType();
    Object service=bundleContext.getService(reference);
    if (service instanceof CamelContext) {
      CamelContext camelContext=(CamelContext)service;
      String camelContextSymbolicName=getCamelSymbolicName(reference);
      String id=getCamelContextUUID(camelContext,reference,camelContextSymbolicName);
      CamelContextService camelContextService=new CamelContextService(camelContext,reference);
      if (!getAuditPolicy().isAuditEnabled(camelContextService)) {
        LOG.debug("Ignoring camel context " + id + " as it matches exclude filters in the policy configuration");
        return;
      }
      if (type == ServiceEvent.UNREGISTERING) {
        LOG.info("Removing audit notifiers from camel context " + id);
        removeNotifier(id);
      }
 else       if (type == ServiceEvent.REGISTERED) {
        LOG.info("Instrumenting camel context " + id + " with audit notifiers");
        Map<String,Object> properties=new HashMap<String,Object>();
        String[] keys=reference.getPropertyKeys();
        if (keys != null) {
          for (          String key : keys) {
            Object value=reference.getProperty(key);
            properties.put(key,value);
          }
        }
        ManagementStrategy managementStrategy=camelContext.getManagementStrategy();
        if (managementStrategy != null) {
          AuditEventNotifier notifier=createEventNotifier(camelContextService);
          if (notifier == null) {
            LOG.warn("Could not create an EventNotifier for CamelContext " + camelContextSymbolicName);
          }
 else {
            try {
              addNotifier(id,camelContextService,notifier,managementStrategy);
            }
 catch (            Exception e) {
              LOG.error("Failed to start " + notifier + " for CamelContext "+ id+ ". Reason: "+ e,e);
            }
          }
        }
      }
    }
  }
}
