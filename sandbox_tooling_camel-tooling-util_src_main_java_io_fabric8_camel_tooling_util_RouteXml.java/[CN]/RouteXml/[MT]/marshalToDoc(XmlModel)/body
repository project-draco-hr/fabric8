{
  Marshaller marshaller=jaxbContext().createMarshaller();
  marshaller.setProperty(Marshaller.JAXB_FORMATTED_OUTPUT,java.lang.Boolean.TRUE);
  try {
    marshaller.setProperty("com.sun.xml.bind.indentString","  ");
  }
 catch (  Exception e) {
    LOG.debug("Property not supported: {}",e);
  }
  Object value=model.marshalRootElement();
  Document doc=model.getDoc();
  Element docElem=doc.getRootElement();
  StringWriter buffer=new StringWriter();
  marshaller.marshal(value,buffer);
  String xml=buffer.toString();
  if (!model.getNs().equals(springNS)) {
    xml=xml.replaceAll(springNS,model.getNs());
  }
  Document camelDoc=parse(new XMLStringSource(xml));
  Node camelElem=camelDoc.getRootElement();
  if (model.isRoutesContext() && camelDoc.getRootElement().getName().equals("camelContext")) {
    camelDoc.getRootElement().setName("routeContext");
  }
  if (model.isJustRoutes()) {
    replaceChild(doc,camelElem,docElem);
  }
 else {
    if (model.getNode() != null) {
      replaceCamelElement(docElem,camelElem,model.getNode());
    }
 else {
      docElem.addNode(camelElem);
    }
  }
}
