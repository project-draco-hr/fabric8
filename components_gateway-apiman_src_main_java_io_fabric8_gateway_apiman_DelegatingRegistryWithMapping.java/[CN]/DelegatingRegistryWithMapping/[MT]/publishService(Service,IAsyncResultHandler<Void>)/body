{
  delegate.publishService(service,new IAsyncResultHandler<Void>(){
    @Override public void handle(    final IAsyncResult<Void> result){
      if (result.isSuccess()) {
        String path=getServiceBindPath(service);
        ServiceMapping mapping=new ServiceMapping(path,service.getOrganizationId(),service.getServiceId(),service.getVersion());
        mappingStorage.put(path,mapping,new IAsyncResultHandler<Void>(){
          @Override public void handle(          IAsyncResult<Void> storageResult){
            if (storageResult.isError()) {
              delegate.retireService(service,new IAsyncResultHandler<Void>(){
                @Override public void handle(                IAsyncResult<Void> result){
                }
              }
);
            }
            handler.handle(result);
          }
        }
);
      }
 else {
        handler.handle(result);
      }
    }
  }
);
}
