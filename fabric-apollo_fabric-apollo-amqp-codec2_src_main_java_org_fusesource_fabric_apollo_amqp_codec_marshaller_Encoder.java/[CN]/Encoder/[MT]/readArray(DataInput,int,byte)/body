{
  Object[] rc;
  if (formatCode == TypeRegistry.DESCRIBED_FORMAT_CODE) {
    BigInteger descriptor=AMQPULong.read(in);
    Class clazz=TypeRegistry.instance().getFormatCodeMap().get(descriptor);
    rc=(Object[])Array.newInstance(clazz,count);
    for (int i=0; i < rc.length; i++) {
      rc[i]=clazz.newInstance();
      ((AmqpType)rc[i]).read((byte)0x0,in);
    }
  }
 else {
    Class clazz=TypeRegistry.instance().getPrimitiveFormatCodeMap().get(formatCode);
    rc=(Object[])Array.newInstance(clazz,count);
    for (int i=0; i < rc.length; i++) {
      rc[i]=clazz.newInstance();
      ((AmqpType)rc[i]).read(formatCode,in);
    }
  }
  return rc;
}
