{
  Map<String,String> answer=new HashMap<>();
  Map<String,String> current=System.getenv();
  for (  String variable : allowInheritedEnvironmentVariables) {
    String value=current.get(variable);
    if (Strings.isNotBlank(value)) {
      answer.put(variable,value);
    }
  }
  if (environmentVariables != null) {
    answer.putAll(environmentVariables);
  }
  answer.put(EnvironmentVariables.FABRIC8_PROFILES,join(getProfiles(),","));
  if (answer.get(JAVA_OPTS) == null) {
    answer.put(JAVA_OPTS,DEFAULT_JAVA_OPTS);
  }
  return answer;
}
