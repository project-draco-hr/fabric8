{
  RequirementImpl br;
  if (requirement instanceof RequirementImpl) {
    br=(RequirementImpl)requirement;
  }
 else {
    FilterImpl sf;
    try {
      String filter=requirement.getDirectives().get(Constants.FILTER_DIRECTIVE);
      if (filter == null) {
        sf=FilterImpl.newInstance("(*)");
      }
 else {
        sf=FilterImpl.newInstance(filter);
      }
    }
 catch (    InvalidSyntaxException e) {
      throw new IllegalStateException(e);
    }
    br=new RequirementImpl(null,requirement.getNamespace(),requirement.getDirectives(),requirement.getAttributes(),sf);
  }
  return br.matches(capability);
}
