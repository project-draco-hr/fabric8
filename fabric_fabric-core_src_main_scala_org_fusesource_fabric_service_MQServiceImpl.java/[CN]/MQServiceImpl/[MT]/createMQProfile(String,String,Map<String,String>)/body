{
  Profile parentProfile=fabricService.getProfile(version,DEFAULT_MQ_PROFILE);
  Profile result=parentProfile;
  if (brokerName != null) {
    result=fabricService.getProfile(version,brokerName);
    if (result == null) {
      result=fabricService.createProfile(version,brokerName);
      result.setParents(new Profile[]{parentProfile});
    }
    Map config=parentProfile.getConfigurations().get(DEFAULT_MQ_PID + "template");
    config.put("broker-name",brokerName);
    if (configs != null) {
      config.putAll(configs);
    }
    Map<String,Map<String,String>> newConfigs=result.getConfigurations();
    newConfigs.put(DEFAULT_MQ_PID + "server-" + brokerName,config);
    result.setConfigurations(newConfigs);
  }
  return result;
}
