{
  try {
    if (getContent() == null && !map.isEmpty()) {
      ByteArrayOutputStream bytesOut=new ByteArrayOutputStream();
      OutputStream os=bytesOut;
      if (Settings.enable_compression()) {
        compressed=true;
        os=new DeflaterOutputStream(os);
      }
      DataOutputStream dataOut=new DataOutputStream(os);
      MarshallingSupport.marshalPrimitiveMap(map,dataOut);
      dataOut.close();
      setContent(bytesOut.toBuffer());
    }
  }
 catch (  IOException e) {
    throw new RuntimeException(e);
  }
}
