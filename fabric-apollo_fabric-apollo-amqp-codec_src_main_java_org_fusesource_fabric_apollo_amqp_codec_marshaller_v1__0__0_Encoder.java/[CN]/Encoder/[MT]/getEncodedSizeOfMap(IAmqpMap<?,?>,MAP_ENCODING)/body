{
  int size=0;
switch (encoding) {
case MAP32:
    size=4;
  break;
case MAP8:
size=1;
break;
default :
throw new IllegalArgumentException(encoding.name());
}
for (Map.Entry<? extends AmqpType<?,?>,? extends AmqpType<?,?>> me : map) {
if (me.getKey() != null) {
size+=me.getKey().getBuffer(MARSHALLER).getEncoded().getEncodedSize();
}
if (me.getValue() != null) {
size+=me.getValue().getBuffer(MARSHALLER).getEncoded().getEncodedSize();
}
 else {
size+=createAmqpNull(null).getBuffer(MARSHALLER).getEncoded().getEncodedSize();
}
}
return size;
}
