{
  if (!url.startsWith("mvn:")) {
    throw new IllegalArgumentException("Framework url must use the mvn: protocol");
  }
  File file=manager.download(url).await().getFile();
  String path=file.getPath();
  if (path.startsWith(KARAF_HOME)) {
    path=path.substring(KARAF_HOME.length() + 1);
  }
  if (!path.equals(properties.get("karaf.framework.felix"))) {
    properties.put("karaf.framework","felix");
    properties.put("karaf.framework.felix",path);
    return true;
  }
  return false;
}
