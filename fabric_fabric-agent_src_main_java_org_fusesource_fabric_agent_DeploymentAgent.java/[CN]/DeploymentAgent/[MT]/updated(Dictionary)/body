{
  executor.submit(new Runnable(){
    public void run(){
      Exception result=null;
      try {
        doUpdate(props);
      }
 catch (      Exception e) {
        result=e;
        LOGGER.error("Unable to update agent",e);
      }
      try {
        IZKClient zk=zkClient.call();
        if (zk != null) {
          String name=System.getProperty("karaf.name");
          String r, e;
          if (result == null) {
            r=ZkDefs.SUCCESS;
            e=null;
          }
 else {
            StringWriter sw=new StringWriter();
            result.printStackTrace(new PrintWriter(sw));
            r=ZkDefs.ERROR;
            e=sw.toString();
          }
          zk.createOrSetWithParents(ZkPath.AGENT_PROVISION_RESULT.getPath(name),r,ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
          zk.createOrSetWithParents(ZkPath.AGENT_PROVISION_EXCEPTION.getPath(name),e,ZooDefs.Ids.OPEN_ACL_UNSAFE,CreateMode.PERSISTENT);
        }
 else {
          LOGGER.info("ZooKeeper not available");
        }
      }
 catch (      Exception e) {
        LOGGER.error("Unable to set provisioning result");
      }
    }
  }
);
}
