{
  System.out.println("Create test profile:" + profile + " in datastore.");
  ProfileService profileService=fabricService.adapt(ProfileService.class);
  List<String> versions=profileService.getVersions();
  if (!versions.contains(versionId)) {
    Version version=VersionBuilder.Factory.create(versionId).getVersion();
    profileService.createVersion(version);
  }
  fabricService.getDataStore().createProfile(versionId,profile);
  GitUtils.waitForBranchUpdate(curator,versionId);
  GitUtils.checkoutBranch(git,"origin",versionId);
  PullResult pullResult=git.pull().setCredentialsProvider(getCredentialsProvider()).setRebase(true).call();
  assertTrue(pullResult.isSuccessful());
  String relativeProfileDir="fabric/profiles/" + profile + ".profile";
  File testProfileDir=new File(git.getRepository().getWorkTree(),relativeProfileDir);
  assertTrue(testProfileDir.exists());
  File testProfileConfig=new File(testProfileDir,"io.fabric8.agent.properties");
  assertTrue(testProfileConfig.exists());
}
