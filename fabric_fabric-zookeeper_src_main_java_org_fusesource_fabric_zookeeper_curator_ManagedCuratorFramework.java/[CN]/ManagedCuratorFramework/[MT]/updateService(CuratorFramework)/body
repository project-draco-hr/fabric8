{
  if (registration != null) {
    closeQuietly(connectionStateListenerTracker);
    registration.unregister();
    try {
      Closeables.close(curatorFramework,true);
    }
 catch (    IOException ex) {
    }
  }
  this.registration=bundleContext.registerService(CuratorFramework.class.getName(),framework,new Hashtable<String,Object>());
  this.curatorFramework=framework;
  registerConnectionStateListenerTracker();
}
