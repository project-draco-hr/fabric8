{
  DefaultCamelContext answer=new DefaultCamelContext(){
    protected ManagementStrategy createManagementStrategy(){
      ManagementStrategy answer=null;
      try {
        log.info("JMX enabled. Using ManagedManagementStrategy.");
        DefaultManagementAgent agent=new DefaultManagementAgent(this);
        agent.setCreateConnector(true);
        answer=new ManagedManagementStrategy(agent);
        startServices(answer);
        getLifecycleStrategies().add(0,new DefaultManagementLifecycleStrategy(this));
      }
 catch (      NoClassDefFoundError e) {
        answer=null;
        log.warn("Cannot find needed classes for JMX lifecycle strategy." + " Needed class is in spring-context.jar using Spring 2.5 or newer" + " (spring-jmx.jar using Spring 2.0.x)."+ " NoClassDefFoundError: "+ e.getMessage());
      }
catch (      Exception e) {
        answer=null;
        log.warn("Cannot create JMX lifecycle strategy. Fallback to using DefaultManagementStrategy (non JMX).",e);
      }
      if (answer instanceof CamelContextAware) {
        CamelContextAware aware=(CamelContextAware)answer;
        aware.setCamelContext(this);
      }
      return answer;
    }
  }
;
  answer.setName(name);
  return answer;
}
