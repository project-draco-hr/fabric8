{
  List<DependencyClassLoader> childClassLoaders=new ArrayList<DependencyClassLoader>();
  List<DependencyTree> children=tree.getChildren();
  List<DependencyTree> nonSharedDependencies=new ArrayList<DependencyTree>();
  for (  DependencyTree child : children) {
    if (sharedFilter != null && sharedFilter.matches(child)) {
      DependencyClassLoader childClassLoader=getClassLoader(child,sharedFilter);
      if (childClassLoader != null) {
        childClassLoaders.add(childClassLoader);
      }
    }
 else {
      nonSharedDependencies.add(child);
    }
  }
  return DependencyClassLoader.newInstance(tree,nonSharedDependencies,childClassLoaders,null);
}
