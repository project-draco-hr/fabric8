{
  System.err.println(executeCommand("fabric:create --clean -n --profile feature-camel"));
  ServiceProxy<FabricService> fabricProxy=ServiceProxy.createServiceProxy(bundleContext,FabricService.class);
  try {
    FabricService fabricService=fabricProxy.getService();
    Profile karafProfile=fabricService.getDefaultVersion().getProfile("karaf");
    Assert.assertNotNull(karafProfile);
    Profile camelProfile=fabricService.getDefaultVersion().getProfile("feature-camel");
    Assert.assertNotNull(camelProfile);
    Profile activeMq=fabricService.getDefaultVersion().getProfile("mq-default");
    Assert.assertNotNull(activeMq);
    Profile[] profiles=fabricService.getCurrentContainer().getProfiles();
    List<String> profileNames=new LinkedList<String>();
    for (    Profile profile : profiles) {
      profileNames.add(profile.getId());
    }
    Assert.assertTrue(profileNames.contains("fabric"));
    Assert.assertTrue(profileNames.contains("feature-camel"));
  }
  finally {
    fabricProxy.close();
  }
}
