{
  Producer producer=new Producer();
  LinkedList<String> argl=new LinkedList<String>(Arrays.asList(args));
  while (!argl.isEmpty()) {
    try {
      String arg=argl.removeFirst();
      if ("--help".equals(arg)) {
        displayHelpAndExit(0);
      }
 else       if ("--broker".equals(arg)) {
        producer.broker=shift(argl);
      }
 else       if ("--destination".equals(arg)) {
        producer.destination=shift(argl);
      }
 else       if ("--batch-size".equals(arg)) {
        producer.batchSize=Integer.parseInt(shift(argl));
      }
 else       if ("--batch-timeout".equals(arg)) {
        producer.batchTimeout=Long.parseLong(shift(argl));
      }
 else       if ("--compress".equals(arg)) {
        producer.compress=Boolean.parseBoolean(shift(argl));
      }
 else       if ("--log-file".equals(arg)) {
        producer.logFilePattern=shift(argl);
      }
 else       if ("--position-file".equals(arg)) {
        producer.positionFile=new File(shift(argl));
      }
 else {
        System.err.println("Invalid usage: unknown option: " + arg);
        displayHelpAndExit(1);
      }
    }
 catch (    NumberFormatException e) {
      System.err.println("Invalid usage: argument not a number");
      displayHelpAndExit(1);
    }
  }
  if (producer.logFilePattern != null ^ producer.positionFile != null) {
    System.err.println("Invalid usage: --log-file and --position-file but both be set.");
    displayHelpAndExit(1);
  }
  if (producer.broker == null) {
    System.err.println("Invalid usage: --broker option not specified.");
    displayHelpAndExit(1);
  }
  if (producer.destination == null) {
    System.err.println("Invalid usage: --destination option not specified.");
    displayHelpAndExit(1);
  }
  producer.execute();
  System.exit(0);
}
