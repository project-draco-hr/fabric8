{
  String user=gitUser;
  String password=gitPassword;
  String authorization=null;
  String emailHeader=null;
  if (request != null) {
    authorization=request.getHeader("GogsAuthorization");
    if (Strings.isNullOrEmpty(authorization)) {
      authorization=request.getParameter("_gogsAuth");
    }
    emailHeader=request.getHeader("GogsEmail");
    if (Strings.isNullOrEmpty(emailHeader)) {
      emailHeader=request.getParameter("_gogsEmail");
    }
  }
  if (!Strings.isNullOrEmpty(authorization)) {
    String basicPrefix="basic";
    String lower=authorization.toLowerCase();
    if (lower.startsWith(basicPrefix)) {
      String base64Credentials=authorization.substring(basicPrefix.length()).trim();
      String credentials=new String(Base64.decode(base64Credentials),Charset.forName("UTF-8"));
      String[] values=credentials.split(":",2);
      if (values != null && values.length > 1) {
        user=values[0];
        password=values[1];
      }
    }
  }
  String email="dummy@gmail.com";
  if (!Strings.isNullOrEmpty(emailHeader)) {
    email=emailHeader;
  }
  return new UserDetails(address,internalAddress,user,password,email);
}
