{
  Map<ProfileVersionKey,Map<String,Parser>> profileArtifacts=new HashMap<ProfileVersionKey,Map<String,Parser>>();
  FabricService fabric=fabricService.get();
  DownloadManager downloadManager=DownloadManagers.createDownloadManager(fabric,executorService);
  Container[] containers=fabric.getContainers();
  for (  Container container : containers) {
    Profile[] profiles=container.getProfiles();
    boolean javaOrProcessContainer=ChildContainers.isJavaOrProcessContainer(fabric,container);
    for (    Profile profile : profiles) {
      Profile overlay=profile.getOverlay();
      ProfileVersionKey key=new ProfileVersionKey(profile);
      Map<String,Parser> artifacts=null;
      if (javaOrProcessContainer) {
        List<Profile> singletonList=Collections.singletonList(profile);
        artifacts=JavaContainers.getJavaContainerArtifacts(fabric,singletonList,executorService);
      }
 else {
        artifacts=AgentUtils.getProfileArtifacts(fabric,downloadManager,overlay);
      }
      if (artifacts != null) {
        if (LOG.isDebugEnabled()) {
          LOG.debug("Profile " + profile.getId() + " maps to artefacts: "+ artifacts.keySet());
        }
        profileArtifacts.put(key,artifacts);
      }
    }
  }
  return profileArtifacts;
}
