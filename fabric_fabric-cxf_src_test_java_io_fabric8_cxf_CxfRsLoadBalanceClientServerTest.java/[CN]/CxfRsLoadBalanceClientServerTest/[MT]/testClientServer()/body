{
  assertNotNull(bus);
  assertNotNull(feature);
  JAXRSServerFactoryBean factory=new JAXRSServerFactoryBean();
  factory.setResourceClasses(CustomerService.class);
  factory.setAddress("http://localhost:9000/simple/server");
  factory.setBus(bus);
  factory.create();
  for (int i=0; i < 100; i++) {
    if (!feature.getLoadBalanceStrategy().getAlternateAddressList().isEmpty()) {
      break;
    }
    Thread.sleep(100);
  }
  JAXRSClientFactoryBean clientFactory=new JAXRSClientFactoryBean();
  clientFactory.setServiceClass(CustomerServiceResources.class);
  clientFactory.setAddress("http://someotherplace");
  List<AbstractFeature> features=new ArrayList<AbstractFeature>();
  features.add(feature);
  clientFactory.setFeatures(features);
  CustomerServiceResources proxy=clientFactory.create(CustomerServiceResources.class);
  Customer response=proxy.getCustomer("123");
  assertEquals("Get a wrong customer name","John",response.getName());
}
