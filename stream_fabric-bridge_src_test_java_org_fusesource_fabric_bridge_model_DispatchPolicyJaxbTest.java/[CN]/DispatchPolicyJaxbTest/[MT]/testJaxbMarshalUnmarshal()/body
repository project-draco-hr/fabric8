{
  DispatchPolicy dispatchPolicy=new DispatchPolicy();
  dispatchPolicy.setMessageConverter(new TestMessageConverter());
  dispatchPolicy.setMessageSelector(TEST_MESSAGE_SELECTOR);
  JAXBContext context=JAXBContext.newInstance(DispatchPolicy.class);
  Marshaller marshaller=context.createMarshaller();
  ByteArrayOutputStream stream=new ByteArrayOutputStream();
  marshaller.marshal(dispatchPolicy,stream);
  String str=stream.toString("UTF-8");
  LOG.info("Marshaled dispatch policy is " + System.getProperty("line.separator") + str);
  Unmarshaller unmarshaller=context.createUnmarshaller();
  ByteArrayInputStream stream2=new ByteArrayInputStream(str.getBytes());
  DispatchPolicy dispatchPolicy2=(DispatchPolicy)unmarshaller.unmarshal(stream2);
  assertEquals(dispatchPolicy,dispatchPolicy2);
}
