{
  Settings settings=null;
  DefaultSettingsBuildingRequest request=new DefaultSettingsBuildingRequest();
  File userSettingsFile=safeGetFile(USER_SETTINGS_FILE);
  File globalMavenSettingsFile=safeGetFile(GLOBAL_MAVEN_SETTINGS_FILE);
  if (globalMavenSettingsFile == null) {
    globalMavenSettingsFile=safeGetFile(GLOBAL_M2_SETTINGS_FILE);
  }
  if (userSettingsFile != null) {
    request.setUserSettingsFile(userSettingsFile);
  }
  if (globalMavenSettingsFile != null) {
    request.setGlobalSettingsFile(globalMavenSettingsFile);
  }
  request.setSystemProperties(System.getProperties());
  try {
    settings=settingsBuilder.build(request).getEffectiveSettings();
  }
 catch (  SettingsBuildingException e) {
    LOGGER.warn("Could not process settings.xml: ",e);
  }
  try {
    SettingsDecrypter settingsDecrypter=createSettingsDecrypter();
    SettingsDecryptionResult result=settingsDecrypter.decrypt(new DefaultSettingsDecryptionRequest(settings));
    settings.setServers(result.getServers());
    settings.setProxies(result.getProxies());
  }
 catch (  Exception ex) {
    LOGGER.warn("Failed to decrypt maven settings.",ex);
  }
  return settings;
}
