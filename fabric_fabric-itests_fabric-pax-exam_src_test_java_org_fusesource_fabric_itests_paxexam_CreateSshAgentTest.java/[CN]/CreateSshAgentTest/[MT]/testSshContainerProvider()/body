{
  if (isReady()) {
    FabricService fabricService=getOsgiService(FabricService.class);
    assertNotNull(fabricService);
    System.err.println(executeCommand("fabric:create"));
    executeCommand("fabric:profile-edit -p org.fusesource.fabric.agent/org.ops4j.pax.url.mvn.repositories=" + "http://repo1.maven.org/maven2 default");
    CreateContainerOptions options=CreateContainerOptionsBuilder.ssh().name("ssh1").host(host).port(Integer.parseInt(port)).username(username).password(password).providerUri("ssh://" + username + ":"+ password+ "@"+ host+ ":"+ port);
    CreateContainerMetadata[] metadata=fabricService.createContainers(options);
    assertNotNull(metadata);
    assertEquals(1,metadata.length);
    if (metadata[0].getFailure() != null) {
      throw metadata[0].getFailure();
    }
    assertTrue("Expected succesful creation of remote ssh container",metadata[0].isSuccess());
    assertNotNull("Expected succesful creation of remote ssh container",metadata[0].getContainer());
    waitForProvisionSuccess(metadata[0].getContainer(),3 * PROVISION_TIMEOUT);
    System.out.println(executeCommand("fabric:container-list -v"));
    Container ssh1=fabricService.getContainer("ssh1");
    assertTrue(ssh1.isAlive());
    createAndAssetChildContainer("ssh2","ssh1","default");
    Container ssh2=fabricService.getContainer("ssh2");
    ssh2.stop();
    assertFalse(ssh2.isAlive());
    ssh2.start();
    waitForProvisionSuccess(ssh2,PROVISION_TIMEOUT);
    assertTrue(ssh2.isAlive());
    ssh2.stop();
    ssh1.stop();
    assertFalse(ssh1.isAlive());
    System.out.println(executeCommand("fabric:container-list -v"));
    ssh1.start();
    waitForProvisionSuccess(ssh1,PROVISION_TIMEOUT);
    System.out.println(executeCommand("fabric:container-list -v"));
    assertTrue(ssh1.isAlive());
  }
}
