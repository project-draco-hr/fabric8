{
  HashMap<ObjectName,HashMap<String,Object>> queues=new HashMap<ObjectName,HashMap<String,Object>>();
{
    Set<ObjectName> mbeans=connection.queryNames(new ObjectName("org.apache.activemq:Type=Queue,*"),null);
    for (    ObjectName mbean : mbeans) {
      HashMap<String,Object> attributes=new HashMap<String,Object>();
      for (      String attr : fetchedQueueAttributes) {
        try {
          Object value=connection.getAttribute(mbean,attr);
          attributes.put(attr,value);
        }
 catch (        Exception e) {
        }
      }
      if (!attributes.isEmpty()) {
        queues.put(mbean,attributes);
      }
    }
  }
  HashMap<ObjectName,HashMap<String,Object>> subscriptions=new HashMap<ObjectName,HashMap<String,Object>>();
{
    Set<ObjectName> mbeans=connection.queryNames(new ObjectName("org.apache.activemq:Type=Subscription,destinationType=Queue,*"),null);
    for (    ObjectName mbean : mbeans) {
      HashMap<String,Object> attributes=new HashMap<String,Object>();
      for (      String attr : fetchedSubscriptionAttributes) {
        try {
          Object value=connection.getAttribute(mbean,attr);
          attributes.put(attr,value);
        }
 catch (        Exception e) {
        }
      }
      if (!attributes.isEmpty()) {
        subscriptions.put(mbean,attributes);
      }
    }
  }
  return new Stats(queues,subscriptions);
}
