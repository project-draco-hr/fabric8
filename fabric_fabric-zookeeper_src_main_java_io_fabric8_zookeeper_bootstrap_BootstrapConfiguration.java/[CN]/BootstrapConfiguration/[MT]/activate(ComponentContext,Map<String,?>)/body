{
  this.componentContext=componentContext;
  configurer.configure(configuration,this);
  String decodedZookeeperPassword=null;
  Properties userProps=new Properties();
  try {
    userProps.load(new File(home + "/etc/users.properties"));
  }
 catch (  IOException e) {
    LOGGER.warn("Failed to load users from etc/users.properties. No users will be imported.",e);
  }
  if (Strings.isNotBlank(zookeeperPassword)) {
    decodedZookeeperPassword=PasswordEncoder.decode(zookeeperPassword);
  }
 else   if (userProps.containsKey(DEFAULT_ADMIN_USER)) {
    String passwordAndRole=userProps.getProperty(DEFAULT_ADMIN_USER).trim();
    decodedZookeeperPassword=passwordAndRole.substring(0,passwordAndRole.indexOf(ROLE_DELIMITER));
  }
 else {
    decodedZookeeperPassword=PasswordEncoder.encode(CreateEnsembleOptions.generatePassword());
  }
  if (userProps.isEmpty()) {
    userProps.put(DEFAULT_ADMIN_USER,decodedZookeeperPassword + ROLE_DELIMITER + DEFAULT_ADMIN_ROLE);
  }
  options=CreateEnsembleOptions.builder().bindAddress(bindAddress).agentEnabled(agentAutoStart).ensembleStart(ensembleAutoStart).zookeeperPassword(decodedZookeeperPassword).zooKeeperServerPort(zookeeperServerPort).zooKeeperServerConnectionPort(zookeeperServerConnectionPort).autoImportEnabled(profilesAutoImport).importPath(profilesAutoImportPath).users(userProps).profiles(profiles).version(version).build();
  BundleContext bundleContext=componentContext.getBundleContext();
  boolean isCreated=checkCreated(bundleContext);
  if (!Strings.isNotBlank(zookeeperUrl) && !isCreated && options.isEnsembleStart()) {
    String connectionUrl=getConnectionUrl(options);
    registrationHandler.get().setRegistrationCallback(new DataStoreBootstrapTemplate(name,home,connectionUrl,options));
    createOrUpdateDataStoreConfig(options);
    createZooKeeeperServerConfig(options);
    createZooKeeeperClientConfig(connectionUrl,options);
    markCreated(bundleContext);
  }
  activateComponent();
}
