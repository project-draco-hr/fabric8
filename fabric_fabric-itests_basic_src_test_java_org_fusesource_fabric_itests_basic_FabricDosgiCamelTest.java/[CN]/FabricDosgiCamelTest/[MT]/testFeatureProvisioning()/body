{
  System.err.println(executeCommand("fabric:create -n root"));
  waitForFabricCommands();
  Set<Container> containers=ContainerBuilder.create(2).withName("dosgi").withProfiles("example-dosgi-camel").assertProvisioningResult().build();
  List<Container> containerList=new ArrayList<Container>(containers);
  List<Container> dosgiProviderContainers=containerList.subList(0,containerList.size() / 2);
  List<Container> dosgiCamelContainers=containerList.subList(containerList.size() / 2,containerList.size());
  for (  Container c : dosgiProviderContainers) {
    setData(getCurator(),ZkPath.CONTAINER_PROVISION_RESULT.getPath(c.getId()),"changing profile");
    Profile p=c.getVersion().getProfile("example-dosgi-camel.provider");
    c.setProfiles(new Profile[]{p});
  }
  for (  Container c : dosgiCamelContainers) {
    setData(getCurator(),ZkPath.CONTAINER_PROVISION_RESULT.getPath(c.getId()),"changing profile");
    Profile p=c.getVersion().getProfile("example-dosgi-camel.consumer");
    c.setProfiles(new Profile[]{p});
  }
  Provision.provisioningSuccess(dosgiProviderContainers,PROVISION_TIMEOUT);
  Provision.provisioningSuccess(dosgiCamelContainers,PROVISION_TIMEOUT);
  Thread.sleep(20000L);
  for (  Container c : dosgiCamelContainers) {
    String response=executeCommand("fabric:container-connect -u admin -p admin " + c.getId() + " log:display | grep \"Message from distributed service to\"");
    System.err.println(executeCommand("fabric:container-connect -u admin -p admin " + c.getId() + " camel:route-info fabric-client"));
    assertNotNull(response);
    System.err.println(response);
    String[] lines=response.split("\n");
    assertTrue("At least one message is expected",lines.length >= 1);
  }
}
