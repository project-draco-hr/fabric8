{
  applicationContextZkServer=new ClassPathXmlApplicationContext("test-zkserver.xml");
  fabricService=applicationContextZkServer.getBean(FabricService.class);
  bundleContext=new MockBundleContext(){
    PooledConnectionFactory localConnectionFactory=new PooledConnectionFactory(TEST_LOCAL_BROKER_URL);
    PooledConnectionFactory remoteConnectionFactory=new PooledConnectionFactory(TEST_REMOTE_BROKER_URL);
    @Override public ServiceReference[] getServiceReferences(    String clazz,    String filter) throws InvalidSyntaxException {
      Hashtable<String,Object> properties=new Hashtable<String,Object>();
      if (CONNECTION_FACTORY_CLASS_NAME.equals(clazz)) {
        if (LOCAL_FACTORY_FILTER.equals(filter)) {
          properties.put(SERVICE_PROPERTY,localConnectionFactory);
        }
 else {
          return null;
        }
      }
 else       if (DESTINATION_RESOLVER_CLASS_NAME.equals(clazz)) {
        properties.put(SERVICE_PROPERTY,new DynamicDestinationResolver());
      }
 else       if (MESSAGE_CONVERTER_CLASS_NAME.equals(clazz)) {
        properties.put(SERVICE_PROPERTY,new TestMessageConverter());
      }
 else {
        return null;
      }
      return new ServiceReference[]{new MockServiceReference(null,properties,null)};
    }
    @Override public Object getService(    ServiceReference reference){
      return reference.getProperty(SERVICE_PROPERTY);
    }
  }
;
  gatewayContext=new ClassPathXmlApplicationContext("test-zkgateway-context.xml");
}
