{
  String basedir=System.getProperty("basedir",".");
  File jsonFile=new File(basedir + "/target/templateGenerator/sample.json").getCanonicalFile();
  recursiveDelete(jsonFile);
  String name="MyApp";
  int replicaCount=3;
  CreateAppDTO dto=new CreateAppDTO();
  dto.setName(name);
  dto.setDockerImage("fabric8/hawtio");
  dto.setReplicaCount(replicaCount);
  List<Port> ports=new ArrayList<>();
  Port jolokiaPort=new Port();
  jolokiaPort.setHostPort(10001);
  jolokiaPort.setContainerPort(8778);
  Port brokerPort=new Port();
  brokerPort.setHostPort(6161);
  brokerPort.setContainerPort(6162);
  ports.add(jolokiaPort);
  ports.add(brokerPort);
  dto.setPorts(ports);
  Map<String,String> labels=new HashMap<>();
  labels.put("foo","bar");
  labels.put("drink","beer");
  dto.setLabels(labels);
  List<Env> envs=new ArrayList<>();
  Env env1=new Env();
  env1.setName("CHEESE");
  env1.setValue("EDAM");
  Env env2=new Env();
  env2.setName("CHEESE");
  env2.setValue("EDAM");
  envs.add(env1);
  envs.add(env2);
  dto.setEnvironmentVariables(envs);
  TemplateGenerator generator=new TemplateGenerator(dto);
  generator.generate(jsonFile);
  labels.put("name",name);
  String json=IOHelpers.readFully(jsonFile);
  System.out.println("Generated: " + json);
  Object loadedDTO=KubernetesHelper.loadJson(json);
  System.out.println("Loaded json DTO: " + loadedDTO);
  assertTrue("Loaded DTO should be a ReplicationControllerSchema but was " + loadedDTO,loadedDTO instanceof ReplicationControllerSchema);
  ReplicationControllerSchema rc=(ReplicationControllerSchema)loadedDTO;
  assertThat(rc.getLabels()).isEqualTo(labels);
  ControllerDesiredState desiredState=rc.getDesiredState();
  assertThat(desiredState.getReplicas()).isEqualTo(replicaCount);
  assertThat(desiredState.getReplicaSelector()).isEqualTo(labels);
}
