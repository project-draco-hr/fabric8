{
  readSource=Dispatch.createSource(channel,SelectionKey.OP_READ,dispatchQueue);
  writeSource=Dispatch.createSource(channel,SelectionKey.OP_WRITE,dispatchQueue);
  readSource.setCancelHandler(CANCEL_HANDLER);
  writeSource.setCancelHandler(CANCEL_HANDLER);
  readSource.setEventHandler(new Runnable(){
    public void run(){
      drainInbound();
    }
  }
);
  writeSource.setEventHandler(new Runnable(){
    public void run(){
      drainOutbound();
    }
  }
);
  if (max_read_rate != 0 || max_write_rate != 0) {
    rateLimitingChannel=new RateLimitingChannel();
    schedualRateAllowanceReset();
  }
  remoteAddress=channel.socket().getRemoteSocketAddress().toString();
  listener.onTransportConnected(this);
}
