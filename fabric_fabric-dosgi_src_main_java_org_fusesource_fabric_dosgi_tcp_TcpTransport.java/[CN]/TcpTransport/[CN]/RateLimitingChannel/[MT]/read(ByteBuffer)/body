{
  if (max_read_rate == 0) {
    return channel.read(dst);
  }
 else {
    int remaining=dst.remaining();
    if (read_allowance == 0 || remaining == 0) {
      return 0;
    }
    int reduction=0;
    if (remaining > read_allowance) {
      reduction=remaining - read_allowance;
      dst.limit(dst.limit() - reduction);
    }
    int rc=0;
    try {
      rc=channel.read(dst);
      read_allowance-=rc;
    }
  finally {
      if (reduction != 0) {
        if (dst.remaining() == 0) {
          readSource.suspend();
          read_suspended=true;
        }
        dst.limit(dst.limit() + reduction);
      }
    }
    return rc;
  }
}
