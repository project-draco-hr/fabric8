{
  final ClusteredSingleton<TextNodeState> cluster=getCluster();
  TextNodeState state=new TextNodeState();
  String singletonId=endpoint.getSingletonId();
  LOG.debug("Attempting to become master for endpoint: " + endpoint + " in "+ endpoint.getCamelContext()+ " with singletonID: "+ singletonId);
  state.setId(singletonId);
  cluster.join(state);
  cluster.add(new ChangeListener(){
    @Override public void connected(){
    }
    @Override public void changed(){
      if (cluster.connected()) {
        if (cluster.isMaster()) {
          if (LOG.isDebugEnabled()) {
            LOG.debug("Master/Standby endpoint is Master for:  " + endpoint + " in "+ endpoint.getCamelContext());
          }
          onLockOwned();
        }
 else {
          if (LOG.isDebugEnabled()) {
            LOG.debug("Master/Standby endpoint is Standby for: " + endpoint + " in "+ endpoint.getCamelContext());
          }
        }
      }
    }
    @Override public void disconnected(){
      try {
        stopConsumer();
      }
 catch (      Exception e) {
        LOG.error("Failed to stop master consumer for: " + endpoint + ". Reason: "+ e,e);
      }
    }
  }
);
}
