{
  try {
    if (isIgnoreProject())     return;
    generateZip();
    if (reactorProjects != null) {
      List<MavenProject> pomZipProjects=new ArrayList<>();
      List<MavenProject> fabricZipGoalProjects=new ArrayList<>();
      List<MavenProject> fabricHasParentZipGoalProject=new ArrayList<MavenProject>();
      for (      MavenProject reactorProject : reactorProjects) {
        if ("pom".equals(reactorProject.getPackaging())) {
          pomZipProjects.add(reactorProject);
        }
        List<Plugin> buildPlugins=reactorProject.getBuildPlugins();
        for (        Plugin buildPlugin : buildPlugins) {
          String artifactId=buildPlugin.getArtifactId();
          if ("fabric8-maven-plugin".equals(artifactId)) {
            Object goals=buildPlugin.getGoals();
            boolean hasZipGoal=goals != null && goals.toString().contains("zip");
            List<PluginExecution> executions=buildPlugin.getExecutions();
            for (            PluginExecution execution : executions) {
              List<String> execGoals=execution.getGoals();
              if (execGoals.contains("zip")) {
                hasZipGoal=true;
              }
            }
            getLog().debug("project " + reactorProject.getArtifactId() + " has zip goal: "+ hasZipGoal);
            fabricZipGoalProjects.add(reactorProject);
          }
        }
      }
      for (      MavenProject project : fabricZipGoalProjects) {
        if (fabricZipGoalProjects.contains(project.getParent())) {
          fabricHasParentZipGoalProject.add(project);
        }
      }
      MavenProject project=getProject();
      boolean last=reactorProjects.size() > 1 && project == reactorProjects.get(reactorProjects.size() - 1);
      if (!last) {
        last=fabricHasParentZipGoalProject.size() > 1 && project == fabricHasParentZipGoalProject.get(fabricHasParentZipGoalProject.size() - 1);
      }
      if (!last) {
        last=fabricZipGoalProjects.size() > 1 && project == fabricZipGoalProjects.get(fabricZipGoalProjects.size() - 1);
      }
      if (last) {
        getLog().info("");
        getLog().info("Creating aggregated app zip");
        getLog().info("built the last fabric8:zip project so generating a combined zip for all " + fabricZipGoalProjects.size() + " projects with a fabric8:zip goal");
        MavenProject rootProject=fabricZipGoalProjects.size() > 0 ? fabricZipGoalProjects.get(0) : reactorProjects.get(0);
        List<MavenProject> ourPomZipProjects=new ArrayList<MavenProject>();
        if (pomZipProjects.contains(rootProject)) {
          ourPomZipProjects.add(rootProject);
        }
        ourPomZipProjects.add(rootProject);
        for (        MavenProject zip : pomZipProjects) {
          if (hasParent(zip,rootProject,true)) {
            ourPomZipProjects.add(zip);
          }
        }
        getLog().info("Choosing root project " + rootProject.getArtifactId() + " for generation of aggregated zip");
        generateAggregatedZip(rootProject,fabricZipGoalProjects,ourPomZipProjects);
      }
    }
  }
 catch (  MojoFailureException e) {
    throw e;
  }
catch (  MojoExecutionException e) {
    throw e;
  }
catch (  Exception e) {
    throw new MojoExecutionException("Error executing",e);
  }
}
