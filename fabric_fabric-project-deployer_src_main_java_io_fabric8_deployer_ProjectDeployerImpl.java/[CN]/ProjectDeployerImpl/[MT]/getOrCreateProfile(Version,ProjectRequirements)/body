{
  String profileId=getProfileId(requirements);
  if (Strings.isEmpty(profileId)) {
    throw new IllegalArgumentException("No profile ID could be deduced for requirements: " + requirements);
  }
  FabricValidations.validateProfileName(profileId);
  Profile profile;
  if (!version.hasProfile(profileId)) {
    LOG.info("Creating new profile " + profileId + " version "+ version+ " for requirements: "+ requirements);
    String versionId=version.getId();
    ProfileService profileService=fabricService.get().adapt(ProfileService.class);
    ProfileBuilder builder=ProfileBuilder.Factory.create(versionId,profileId);
    profile=profileService.createProfile(builder.getProfile());
  }
 else {
    profile=version.getRequiredProfile(profileId);
  }
  return profile;
}
