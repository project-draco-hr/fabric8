{
  ProfileService profileService=fabricService.get().adapt(ProfileService.class);
  String versionId=getVersionId(requirements);
  Version version=findVersion(fabricService.get(),versionId);
  if (version == null) {
    String baseId=requirements.getBaseVersion();
    baseId=getVersionOrDefaultVersion(fabricService.get(),baseId);
    Version baseVersion=findVersion(fabricService.get(),baseId);
    if (baseVersion != null) {
      version=profileService.createVersion(baseVersion.getId(),versionId,null);
    }
 else {
      version=VersionBuilder.Factory.create(versionId).getVersion();
      version=profileService.createVersion(version);
    }
  }
  return version;
}
