{
  ProfileService profileService=fabricService.get().adapt(ProfileService.class);
  String versionId=getVersionId(requirements);
  Version version=findVersion(fabricService.get(),versionId);
  if (version == null) {
    String baseVersionId=requirements.getBaseVersion();
    baseVersionId=getVersionOrDefaultVersion(fabricService.get(),baseVersionId);
    Version baseVersion=findVersion(fabricService.get(),baseVersionId);
    if (baseVersion != null) {
      version=VersionBuilder.Factory.create(versionId).parent(baseVersion.getId()).getVersion();
      version=profileService.createVersion(version);
    }
 else {
      version=VersionBuilder.Factory.create(versionId).getVersion();
      version=profileService.createVersion(version);
    }
  }
  return version;
}
