{
  if (profile instanceof ProfileOverlayImpl) {
    if (((ProfileOverlayImpl)profile).self.equals(self)) {
      return;
    }
  }
  Map<String,byte[]> configs=profile.getFileConfigurations();
  for (  String key : configs.keySet()) {
    if (key.contains("#")) {
      continue;
    }
    byte[] value=configs.get(key);
    if (environment != null && configs.containsKey(key + "#" + environment)) {
      value=configs.get(key + "#" + environment);
    }
    String fileName=key;
    if (fileName.endsWith(".properties")) {
      SupplementControl ctrl=aggregate.get(fileName);
      if (ctrl != null) {
        Properties childMap=DataStoreUtils.toProperties(value);
        if (childMap.remove(DELETED) != null) {
          ctrl.props.clear();
        }
        for (        Map.Entry<Object,Object> p : childMap.entrySet()) {
          if (DELETED.equals(p.getValue())) {
            ctrl.props.remove(p.getKey());
          }
 else {
            ctrl.props.put(p.getKey(),p.getValue());
          }
        }
      }
 else {
        ctrl=new SupplementControl();
        ctrl.props=DataStoreUtils.toProperties(value);
        aggregate.put(fileName,ctrl);
      }
    }
 else {
      SupplementControl ctrl=new SupplementControl();
      ctrl.data=value;
      aggregate.put(fileName,ctrl);
    }
  }
}
