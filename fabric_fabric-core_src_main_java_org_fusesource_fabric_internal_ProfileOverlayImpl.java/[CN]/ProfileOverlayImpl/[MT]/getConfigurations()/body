{
  try {
    Map<String,SupplementControl> aggregate=new HashMap<String,SupplementControl>();
    for (    Profile profile : getInheritedProfiles()) {
      supplement(profile,aggregate);
    }
    Map<String,Map<String,String>> rc=new HashMap<String,Map<String,String>>();
    for (    Map.Entry<String,SupplementControl> entry : aggregate.entrySet()) {
      SupplementControl ctrl=entry.getValue();
      if (ctrl.props != null) {
        rc.put(DataStoreHelpers.stripSuffix(entry.getKey(),".properties"),DataStoreHelpers.toMap(ctrl.props));
      }
    }
    if (substitute && dataStore != null) {
      dataStore.substituteConfigurations(rc);
    }
    return rc;
  }
 catch (  Exception e) {
    throw FabricException.launderThrowable(e);
  }
}
