{
  DetectingGateway gateway=createGateway();
  MQTT mqtt=new MQTT();
  mqtt.setHost("localhost",gateway.getBoundPort());
  mqtt.setClientId("myclientid");
  mqtt.setUserName("broker0/chirino");
  mqtt.setConnectAttemptsMax(1);
  org.fusesource.mqtt.client.BlockingConnection connection=mqtt.blockingConnection();
  connection.connect();
  assertEquals(1,gateway.getSuccessfulConnectionAttempts());
  assertEquals(1,gateway.getConnectedClients().length);
  assertConnectedToBroker(0);
  connection.kill();
}
