{
  long remaining=unit.toMillis(timeout);
  Throwable lastError=null;
  long step=remaining / 10;
  do {
    long start=System.currentTimeMillis();
    try {
      return action.call();
    }
 catch (    Throwable e) {
      lastError=e;
    }
    long duration=System.currentTimeMillis() - start;
    remaining-=duration;
    if (duration < step) {
      long nap=step - duration;
      remaining-=duration;
      if (remaining > 0) {
        Thread.sleep(nap);
      }
    }
  }
 while (remaining > 0);
  if (lastError instanceof Exception) {
    throw (Exception)lastError;
  }
  if (lastError instanceof Error) {
    throw (Error)lastError;
  }
  throw new RuntimeException(lastError);
}
