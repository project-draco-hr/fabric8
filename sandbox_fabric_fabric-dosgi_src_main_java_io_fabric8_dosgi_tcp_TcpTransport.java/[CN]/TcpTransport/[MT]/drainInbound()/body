{
  if (!getServiceState().isStarted() || readSource.isSuspended()) {
    return;
  }
  try {
    long initial=codec.getReadCounter();
    while (codec.getReadCounter() - initial < 1024 * 64) {
      Object command=codec.read();
      if (command != null) {
        try {
          listener.onTransportCommand(this,command);
        }
 catch (        Throwable e) {
          onTransportFailure(new IOException("Transport listener failure."));
        }
        if (getServiceState() == STOPPED || readSource.isSuspended()) {
          return;
        }
      }
 else {
        return;
      }
    }
  }
 catch (  IOException e) {
    onTransportFailure(e);
  }
}
