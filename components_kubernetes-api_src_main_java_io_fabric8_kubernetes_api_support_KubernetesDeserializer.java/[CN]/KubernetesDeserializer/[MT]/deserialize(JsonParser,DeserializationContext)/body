{
  ObjectMapper mapper=(ObjectMapper)jp.getCodec();
  TreeNode treeNode=mapper.readTree(jp);
  if (treeNode.isObject()) {
    ObjectNode root=(ObjectNode)treeNode;
    Class<?> realClass=null;
    JsonNode kind=root.get("kind");
    if (kind != null) {
      String kindText=kind.textValue();
      Class<?> classForKind=kindToClasses.get(kindText);
      if (classForKind != null) {
        return mapper.treeToValue(root,classForKind);
      }
    }
  }
 else {
    ValueNode valueNode=(ValueNode)treeNode;
    if (valueNode.isTextual()) {
      return valueNode.textValue();
    }
 else     if (valueNode.isNumber()) {
      return valueNode.numberValue();
    }
  }
  return null;
}
