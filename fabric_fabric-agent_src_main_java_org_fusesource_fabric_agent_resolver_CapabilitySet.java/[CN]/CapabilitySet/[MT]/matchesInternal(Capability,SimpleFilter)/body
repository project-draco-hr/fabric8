{
  boolean matched=true;
  if (sf.getOperation() == SimpleFilter.MATCH_ALL) {
    matched=true;
  }
 else   if (sf.getOperation() == SimpleFilter.AND) {
    List<SimpleFilter> sfs=(List<SimpleFilter>)sf.getValue();
    for (int i=0; matched && (i < sfs.size()); i++) {
      matched=matchesInternal(cap,sfs.get(i));
    }
  }
 else   if (sf.getOperation() == SimpleFilter.OR) {
    matched=false;
    List<SimpleFilter> sfs=(List<SimpleFilter>)sf.getValue();
    for (int i=0; !matched && (i < sfs.size()); i++) {
      matched=matchesInternal(cap,sfs.get(i));
    }
  }
 else   if (sf.getOperation() == SimpleFilter.NOT) {
    List<SimpleFilter> sfs=(List<SimpleFilter>)sf.getValue();
    for (int i=0; i < sfs.size(); i++) {
      matched=!(matchesInternal(cap,sfs.get(i)));
    }
  }
 else {
    matched=false;
    Object lhs=cap.getAttributes().get(sf.getName());
    if (lhs != null) {
      matched=compare(lhs,sf.getValue(),sf.getOperation());
    }
  }
  return matched;
}
