{
  m_capSet.add(cap);
  for (  Entry<String,Map<Object,Set<Capability>>> entry : m_indices.entrySet()) {
    Object value=cap.getAttributes().get(entry.getKey());
    if (value != null) {
      if (value.getClass().isArray()) {
        value=convertArrayToList(value);
      }
      Map<Object,Set<Capability>> index=entry.getValue();
      if (value instanceof Collection) {
        Collection c=(Collection)value;
        for (        Object o : c) {
          indexCapability(index,cap,o);
        }
      }
 else {
        indexCapability(index,cap,value);
      }
    }
  }
}
