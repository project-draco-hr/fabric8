{
  List<DependencyClassLoader> childClassLoaders=new ArrayList<DependencyClassLoader>();
  List<DependencyTree> children=tree.getChildren();
  List<DependencyTree> nonSharedDependencies=new ArrayList<DependencyTree>();
  for (  DependencyTree child : children) {
    if (excludeFilter != null && excludeFilter.matches(tree)) {
      continue;
    }
 else     if (sharedFilter != null && sharedFilter.matches(child)) {
      DependencyClassLoader childClassLoader=getClassLoader(child,sharedFilter,excludeFilter);
      if (childClassLoader != null) {
        childClassLoaders.add(childClassLoader);
      }
    }
 else {
      nonSharedDependencies.add(child);
      child.addDescendants(nonSharedDependencies);
    }
  }
  return DependencyClassLoader.newInstance(tree,nonSharedDependencies,childClassLoaders,null);
}
