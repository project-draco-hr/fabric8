{
  FabricValidations.validateContainerNames(containerIds);
  Version version=fabricService.getVersion(this.version);
  if (containerIds == null || containerIds.isEmpty()) {
    if (all) {
      containerIds=new ArrayList<String>();
      for (      Container container : fabricService.getContainers()) {
        containerIds.add(container.getId());
      }
    }
 else {
      containerIds=Arrays.asList(fabricService.getCurrentContainer().getId());
    }
  }
 else {
    if (all) {
      throw new IllegalArgumentException("Can not use --all with a list of containers simultaneously");
    }
  }
  List<Container> toRollback=new ArrayList<Container>();
  List<Container> same=new ArrayList<Container>();
  for (  String containerName : containerIds) {
    Container container=FabricCommand.getContainer(fabricService,containerName);
    int num=ContainerUpgradeSupport.canRollback(version,container);
    if (num < 0) {
      throw new IllegalArgumentException("Container " + container.getId() + " has already lower version "+ container.getVersion()+ " than the requested version "+ version+ " to rollback.");
    }
 else     if (num == 0) {
      same.add(container);
    }
 else {
      toRollback.add(container);
    }
  }
  for (  Container container : same) {
    System.out.println("Container " + container.getId() + " is already version "+ version);
  }
  for (  Container container : toRollback) {
    Version oldVersion=container.getVersion();
    container.setVersion(version);
    log.debug("Rolled back container {} from {} to {}",new Object[]{container,oldVersion,version});
    System.out.println("Rolled back container " + container.getId() + " from version "+ oldVersion+ " to "+ version);
  }
  if (all) {
    fabricService.setDefaultVersion(version);
    System.out.println("Changed default version to " + version);
  }
  return null;
}
