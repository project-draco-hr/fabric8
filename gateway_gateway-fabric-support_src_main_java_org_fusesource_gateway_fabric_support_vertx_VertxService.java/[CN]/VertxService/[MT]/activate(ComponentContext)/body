{
  Bundle bundle=context.getBundleContext().getBundle();
  final ClassLoader classLoader=AriesFrameworkUtil.getClassLoader(bundle);
  ClassLoaders.withContextClassLoader(classLoader,new Callable<Object>(){
    @Override public Object call() throws Exception {
      if (vertx == null) {
        try {
          vertx=VertxFactory.newVertx();
        }
 catch (        Exception e) {
          LOG.warn("Failed to use META-INF/services to discover vertx: " + e,e);
        }
        if (vertx == null) {
          DefaultVertxFactory factory=new DefaultVertxFactory();
          vertx=factory.createVertx();
        }
      }
      return null;
    }
  }
);
}
