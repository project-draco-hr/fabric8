{
  CuratorConfig config=new CuratorConfig();
  configurer.configure(configuration,this);
  configurer.configure(configuration,config);
  if (!Strings.isNullOrEmpty(config.getZookeeperUrl())) {
    State prev=state.get();
    CuratorConfig oldConfiguration=prev != null ? prev.configuration : null;
    if (!config.equals(oldConfiguration)) {
      State next=new State(config);
      if (state.compareAndSet(prev,next)) {
        executor.submit(next);
        if (prev != null) {
          prev.close();
        }
      }
 else {
        next.close();
      }
    }
  }
}
