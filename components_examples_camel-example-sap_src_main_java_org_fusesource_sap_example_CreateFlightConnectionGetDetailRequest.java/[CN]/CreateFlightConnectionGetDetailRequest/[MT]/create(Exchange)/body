{
  Structure flightConnectionGetListResponse=exchange.getIn().getBody(Structure.class);
  if (flightConnectionGetListResponse == null) {
    throw new Exception("No Flight Connection Get List Response.");
  }
  @SuppressWarnings("unchecked") Table<? extends Structure> connectionList=flightConnectionGetListResponse.get("FLIGHT_CONNECTION_LIST",Table.class);
  if (connectionList == null || connectionList.size() == 0) {
    throw new Exception("No Flight Connections");
  }
  Structure connection=connectionList.get(0);
  SAPEndpoint endpoint=exchange.getContext().getEndpoint("sap:destination:nplDest:BAPI_FLCONN_GETDETAIL",SAPEndpoint.class);
  Structure request=endpoint.getRequest();
  String connectionNumber=connection.get("FLIGHTCONN",String.class);
  if (connectionNumber != null) {
    request.put("CONNECTIONNUMBER",connectionNumber);
    if (LOG.isDebugEnabled()) {
      LOG.debug("Added CONNECTIONNUMBER = '{}' to request",connectionNumber);
    }
  }
 else {
    throw new Exception("No Flight Connection Number");
  }
  String travelAgencyNumber=connection.get("AGENCYNUM",String.class);
  if (travelAgencyNumber != null) {
    request.put("TRAVELAGENCYNUMBER",travelAgencyNumber);
    if (LOG.isDebugEnabled()) {
      LOG.debug("Added TRAVELAGENCYNUMBER = '{}' to request",travelAgencyNumber);
    }
  }
 else {
    throw new Exception("No Agency Number");
  }
  Date flightDate=connection.get("FLIGHTDATE",Date.class);
  if (flightDate != null) {
    request.put("FLIGHTDATE",flightDate);
    if (LOG.isDebugEnabled()) {
      LOG.debug("Added FLIGHTDATE = '{}' to request",flightDate);
    }
  }
 else {
    throw new Exception("No Flight Date");
  }
  request.put("NO_AVAILIBILITY","");
  exchange.getIn().setBody(request);
}
