{
  Set<CreateSshContainerMetadata> result=new LinkedHashSet<CreateSshContainerMetadata>();
  try {
    String path=options.getPath();
    String host=options.getHost();
    String ip=InetAddress.getByName(host).getHostAddress();
    options.setPreferredAddress(ip);
    if (host == null) {
      throw new IllegalArgumentException("Host name not specified.");
    }
    int port=options.getPort();
    if (port == -1) {
      port=22;
    }
    String originalName=new String(options.getName());
    for (int i=1; i <= options.getNumber(); i++) {
      String containerName;
      if (options.getNumber() > 1) {
        containerName=originalName + i;
      }
 else {
        containerName=originalName;
      }
      CreateSshContainerMetadata metadata=new CreateSshContainerMetadata();
      metadata.setCreateOptions(options);
      metadata.setContainerName(containerName);
      String script=buildInstallAndStartScript(options.name(containerName));
      logger.debug("Running script on host {}:\n{}",host,script);
      try {
        runScriptOnHost(options,script);
      }
 catch (      Throwable ex) {
        metadata.setFailure(ex);
      }
      result.add(metadata);
    }
  }
 catch (  FabricException e) {
    throw e;
  }
catch (  Exception e) {
    throw new FabricException(e);
  }
  return result;
}
