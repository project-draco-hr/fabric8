{
  try {
    Map<String,Agent> agents=new HashMap<String,Agent>();
    List<String> configs=zooKeeper.getChildren(ZkPath.AGENTS.getPath());
    for (    String name : configs) {
      String root=zooKeeper.getStringData(ZkPath.AGENT_ROOT.getPath(name)).trim();
      if (root.isEmpty()) {
        if (!agents.containsKey(name)) {
          Agent agent=new AgentImpl(null,name,zooKeeper);
          agents.put(name,agent);
        }
      }
 else {
        Agent parent=agents.get(root);
        if (parent == null) {
          parent=new AgentImpl(null,root,zooKeeper);
          agents.put(root,parent);
        }
        Agent agent=new AgentImpl(parent,name,zooKeeper);
        agents.put(name,agent);
      }
    }
    return agents;
  }
 catch (  Exception e) {
    throw new FabricException(e);
  }
}
