{
  List<EndpointDescription> endpoints=new ArrayList<EndpointDescription>();
  Map<String,Object> properties=null;
  String key=null;
  String type=null;
  String value=null;
  Object val=null;
  String txt=null;
  XMLStreamReader reader=XMLInputFactory.newInstance().createXMLStreamReader(new StringReader(data));
  for (; ; ) {
    int code=reader.next();
switch (code) {
case XMLStreamConstants.START_DOCUMENT:
      break;
case XMLStreamConstants.START_ELEMENT:
    if (ENDPOINT_DESCRIPTION.equals(reader.getLocalName())) {
      properties=new HashMap<String,Object>();
    }
 else     if (PROPERTY.equals(reader.getLocalName())) {
      key=reader.getAttributeValue(null,NAME);
      type=reader.getAttributeValue(null,VALUE_TYPE);
      value=reader.getAttributeValue(null,VALUE);
      val=null;
    }
 else     if (ARRAY.equals(reader.getLocalName())) {
      val=Array.newInstance(TYPES.get(type == null ? "String" : type),0);
    }
 else     if (SET.equals(reader.getLocalName())) {
      val=new HashSet<Object>();
    }
 else     if (LIST.equals(reader.getLocalName())) {
      val=new ArrayList<Object>();
    }
 else     if (VALUE.equals(reader.getLocalName())) {
      txt=null;
    }
  break;
case XMLStreamConstants.CHARACTERS:
if (txt == null) {
  txt=reader.getText();
}
 else {
  txt+=reader.getText();
}
break;
case XMLStreamConstants.END_ELEMENT:
if (ENDPOINT_DESCRIPTION.equals(reader.getLocalName())) {
endpoints.add(new EndpointDescription(properties));
properties=null;
}
 else if (PROPERTY.equals(reader.getLocalName())) {
if (key == null || (val == null && value == null) || (val != null && value != null)) {
throw new IllegalArgumentException();
}
if (value != null) {
val=instantiate(type == null ? "String" : type,value);
}
properties.put(key,val);
}
 else if (VALUE.equals(reader.getLocalName())) {
if (val.getClass().isArray()) {
int len=Array.getLength(val);
Object a=Array.newInstance(TYPES.get(type == null ? "String" : type),len + 1);
System.arraycopy(val,0,a,0,len);
Array.set(a,len,instantiate(type == null ? "String" : type,txt));
val=a;
}
 else {
((Collection)val).add(instantiate(type == null ? "String" : type,txt));
}
}
break;
case XMLStreamConstants.END_DOCUMENT:
return endpoints;
}
}
}
