{
  Container currentContainer=fabricService.get().getCurrentContainer();
  Profile overlayProfile=currentContainer.getOverlayProfile();
  Profile effectiveProfile=Profiles.getEffectiveProfile(fabricService.get(),overlayProfile);
  Map<String,Map<String,String>> configurations=effectiveProfile.getConfigurations();
  List<Configuration> zkConfigs=asList(configAdmin.get().listConfigurations("(" + FABRIC_ZOOKEEPER_PID + "=*)"));
  for (  String pid : configurations.keySet()) {
    if (!pid.equals(Constants.AGENT_PID)) {
      Hashtable<String,Object> c=new Hashtable<String,Object>();
      c.putAll(configurations.get(pid));
      updateConfig(zkConfigs,pid,c);
    }
  }
  for (  String pid : configurations.keySet()) {
    if (pid.equals(Constants.AGENT_PID)) {
      Hashtable<String,Object> c=new Hashtable<String,Object>();
      c.putAll(configurations.get(pid));
      c.put(Profile.HASH,String.valueOf(effectiveProfile.getProfileHash()));
      updateConfig(zkConfigs,pid,c);
    }
  }
  for (  Configuration config : zkConfigs) {
    LOGGER.info("Deleting configuration {}",config.getPid());
    fabricService.get().getPortService().unregisterPort(fabricService.get().getCurrentContainer(),config.getPid());
    config.delete();
  }
}
