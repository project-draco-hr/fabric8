{
  if (!file.isFile()) {
    File temp=new File(file.toString() + ".tmp");
    URLConnection con=location.openConnection();
    if (location.getUserInfo() != null) {
      con.setRequestProperty("Authorization","Basic " + Base64Encoder.encode(location.getUserInfo()));
    }
    if (temp.isFile()) {
      con.setRequestProperty("Range","Bytes=" + (temp.length()) + "-");
    }
    InputStream is=new BufferedInputStream(con.getInputStream());
    try {
      boolean resume="bytes".equals(con.getHeaderField("Accept-Ranges"));
      temp.getParentFile().mkdirs();
      OutputStream os=new BufferedOutputStream(new FileOutputStream(temp,resume));
      try {
        copy(is,os);
      }
  finally {
        close(os);
      }
      temp.renameTo(file);
    }
  finally {
      close(is);
    }
  }
}
