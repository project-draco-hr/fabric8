{
  Bundle bundle=FrameworkUtil.getBundle(getClass());
  BundleContext bundleContext=bundle != null ? bundle.getBundleContext() : null;
  String dir=bundleContext != null ? bundleContext.getProperty("fuse.patch.location") : System.getProperty("fuse.patch.location");
  this.patchDir=dir != null ? new File(dir) : bundleContext.getDataFile("patches");
  if (!this.patchDir.isDirectory()) {
    this.patchDir.mkdirs();
    if (!this.patchDir.isDirectory()) {
      throw new IllegalStateException("Unable to create patch folder: " + this.patchDir);
    }
  }
  this.fabric=fabric;
  this.configAdmin=configAdmin;
}
