{
  MessageProducer producer=null;
  try {
    producer=service.createProducer(dest);
    producer.setDeliveryMode(persistent ? DeliveryMode.PERSISTENT : DeliveryMode.NON_PERSISTENT);
    for (sentCount=0; sentCount < messageCount; sentCount++) {
      producer.send(createMessage(sentCount));
      LOG.info("Sent 'test message: " + sentCount + "'");
      if (sleep > 0) {
        Thread.sleep(sleep);
      }
    }
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
 finally {
    if (producer != null) {
      try {
        producer.close();
      }
 catch (      JMSException e) {
        e.printStackTrace();
      }
    }
  }
  LOG.info("Producer thread finished");
}
