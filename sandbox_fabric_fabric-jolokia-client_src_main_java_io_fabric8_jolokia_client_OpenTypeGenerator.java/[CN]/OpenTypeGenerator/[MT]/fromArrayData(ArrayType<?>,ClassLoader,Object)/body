{
  OpenType<?> elementType=atype.getElementOpenType();
  Object array;
  if (value == null) {
    array=getJavaTypeArray(atype,classLoader,0);
  }
 else   if (value.getClass().isArray()) {
    int length=Array.getLength(value);
    array=getJavaTypeArray(atype,classLoader,length);
    for (int i=0; i < length; i++) {
      Object val=Array.get(value,i);
      val=fromOpenData(elementType,classLoader,val);
      Array.set(array,i,val);
    }
  }
 else   if (value instanceof Collection<?>) {
    List<?> list=new ArrayList<Object>((Collection<?>)value);
    array=getJavaTypeArray(atype,classLoader,list.size());
    for (int i=0; i < list.size(); i++) {
      Object val=list.get(i);
      val=fromOpenData(elementType,classLoader,val);
      Array.set(array,i,val);
    }
  }
 else {
    throw new IllegalArgumentException("Unsupported value type: " + value);
  }
  return array;
}
