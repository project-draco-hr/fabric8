{
  if (value == null || targetType.isPrimitive() || targetType.isAssignableFrom(value.getClass())) {
    return value;
  }
  Object result=value;
  if (value.getClass().isArray()) {
    if (targetType == List.class) {
      result=new ArrayList<Object>(Arrays.asList((Object[])value));
    }
 else     if (targetType == Set.class) {
      result=new HashSet<Object>(Arrays.asList((Object[])value));
    }
  }
  boolean isAssignable=targetType.isAssignableFrom(result.getClass());
  IllegalStateAssertion.assertTrue(isAssignable,"Value '" + value + "' not assignable to: "+ targetType.getName());
  return result;
}
