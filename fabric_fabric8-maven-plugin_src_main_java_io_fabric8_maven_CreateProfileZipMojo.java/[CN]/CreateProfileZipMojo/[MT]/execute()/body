{
  try {
    if (isIgnore())     return;
    generateZip();
    if (reactorProjects != null) {
      List<MavenProject> pomZipProjects=new ArrayList<>();
      List<MavenProject> projectsWithZip=new ArrayList<>();
      for (      MavenProject reactorProject : reactorProjects) {
        if ("pom".equals(reactorProject.getPackaging())) {
          pomZipProjects.add(reactorProject);
        }
        List<Plugin> buildPlugins=reactorProject.getBuildPlugins();
        for (        Plugin buildPlugin : buildPlugins) {
          String artifactId=buildPlugin.getArtifactId();
          if ("fabric8-maven-plugin".equals(artifactId)) {
            Object goals=buildPlugin.getGoals();
            boolean hasZipGoal=goals != null && goals.toString().contains("zip");
            List<PluginExecution> executions=buildPlugin.getExecutions();
            for (            PluginExecution execution : executions) {
              List<String> execGoals=execution.getGoals();
              if (execGoals.contains("zip")) {
                hasZipGoal=true;
              }
            }
            getLog().debug("project " + reactorProject.getArtifactId() + " has zip goal: "+ hasZipGoal);
            projectsWithZip.add(reactorProject);
          }
        }
      }
      int projectsWithZipSize=projectsWithZip.size();
      if (projectsWithZipSize > 0) {
        MavenProject lastProject=projectsWithZip.get(projectsWithZipSize - 1);
        if (lastProject == project && projectsWithZipSize > 0) {
          getLog().info("");
          getLog().info("Creating aggregated profile zip");
          getLog().info("built the last fabric8:zip project so generating a combined zip for all " + projectsWithZipSize + " projects with a fabric8:zip goal");
          MavenProject rootProject;
          int pomZipProjectsSize=pomZipProjects.size();
          if (pomZipProjectsSize > 0) {
            rootProject=pomZipProjects.get(0);
            if (pomZipProjects.size() > 1) {
              getLog().debug("pom packaged projects with fabric8:zip goals: " + pomZipProjects);
            }
          }
 else {
            rootProject=reactorProjects.get(0);
          }
          getLog().info("Choosing root project " + rootProject.getArtifactId() + " for generation of aggregated zip");
          generateAggregatedZip(rootProject,projectsWithZip,pomZipProjects);
        }
      }
    }
  }
 catch (  MojoExecutionException e) {
    throw e;
  }
catch (  Exception e) {
    throw new MojoExecutionException("Error executing",e);
  }
}
