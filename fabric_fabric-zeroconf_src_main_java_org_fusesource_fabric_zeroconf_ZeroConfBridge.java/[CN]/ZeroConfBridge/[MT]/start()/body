{
  getJmdns();
  ServiceListener listener=new ServiceListener(){
    public void serviceAdded(    ServiceEvent event){
      log("Added",event);
      JmDNS dns=event.getDNS();
      String type=event.getType();
      String name=event.getName();
      dns.requestServiceInfo(type,name);
      ServiceInfo info=dns.getServiceInfo(type,name);
      if (info != null) {
        addToZooKeeper(info);
      }
    }
    public void serviceRemoved(    ServiceEvent event){
      log("Removed",event);
      removeFromZooKeper(event);
    }
    public void serviceResolved(    ServiceEvent event){
      log("Resolved",event);
      ServiceInfo info=event.getInfo();
      if (info != null) {
        addToZooKeeper(info);
      }
    }
  }
;
  for (  String type : getTypes()) {
    LOG.info("Listening for ZeroConf services of type: " + type);
    jmdns.addServiceListener(type,listener);
  }
  if (doList) {
    for (    String type : getTypes()) {
      ServiceInfo[] list=jmdns.list(type);
      if (list != null) {
        for (        ServiceInfo info : list) {
          addToZooKeeper(info);
        }
      }
    }
  }
}
