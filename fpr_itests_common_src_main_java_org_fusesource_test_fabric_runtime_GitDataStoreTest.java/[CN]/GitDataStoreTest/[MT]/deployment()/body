{
  final ArchiveBuilder archive=new ArchiveBuilder("git-data-store");
  archive.addClasses(RuntimeType.TOMCAT,AnnotatedContextListener.class);
  archive.setManifest(new Asset(){
    @Override public InputStream openStream(){
      if (ArchiveBuilder.getTargetContainer() == RuntimeType.KARAF) {
        OSGiManifestBuilder builder=OSGiManifestBuilder.newInstance();
        builder.addBundleManifestVersion(2);
        builder.addBundleSymbolicName(archive.getName());
        builder.addBundleVersion("1.0.0");
        builder.addManifestHeader(Constants.GRAVIA_ENABLED,Boolean.TRUE.toString());
        builder.addImportPackages(RuntimeLocator.class,FabricService.class,GitDataStore.class,GroupListener.class,CuratorFramework.class);
        builder.addImportPackages(ZooKeeperGroup.class,ZkPath.class,GitNode.class,ZooKeeperUtils.class,Git.class,UsernamePasswordCredentialsProvider.class);
        return builder.openStream();
      }
 else {
        ManifestBuilder builder=new ManifestBuilder();
        builder.addIdentityCapability(archive.getName(),"1.0.0");
        builder.addManifestHeader("Dependencies","org.jboss.gravia,org.fusesource.fabric.api,org.fusesource.fabric.git,org.fusesource.fabric.groups,org.fusesource.fabric.zookeeper");
        return builder.openStream();
      }
    }
  }
);
  return archive.getArchive();
}
