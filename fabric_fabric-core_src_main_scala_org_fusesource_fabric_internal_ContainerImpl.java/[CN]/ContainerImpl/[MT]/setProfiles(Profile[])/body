{
  try {
    String version=service.getZooKeeper().getStringData(ZkPath.CONFIG_CONTAINER.getPath(id));
    String node=ZkPath.CONFIG_VERSIONS_CONTAINER.getPath(version,id);
    List<String> existingProfiles=Arrays.asList(service.getZooKeeper().getStringData(node).split(" "));
    StringBuilder sb=new StringBuilder();
    if (profiles != null) {
      for (      Profile profile : profiles) {
        if (!version.equals(profile.getVersion())) {
          throw new IllegalArgumentException("Version mismatch setting profile " + profile.getId() + " with version "+ profile.getVersion()+ " expected version "+ version);
        }
 else         if (profile.isAbstract()) {
          throw new IllegalArgumentException("The profile " + profile.getId() + " is abstract and can not "+ "be associated to containers");
        }
 else         if (profile.getId().matches(ENSEMBLE_PROFILE_PATTERN) && !existingProfiles.contains(profile.getId())) {
          throw new IllegalArgumentException("The profile " + profile.getId() + " is not assignable.");
        }
        if (sb.length() > 0) {
          sb.append(" ");
        }
        sb.append(profile.getId());
      }
    }
    String str=sb.toString();
    if (str.trim().isEmpty()) {
      str="default";
    }
    service.getZooKeeper().setData(node,str);
  }
 catch (  Exception e) {
    throw new FabricException(e);
  }
}
