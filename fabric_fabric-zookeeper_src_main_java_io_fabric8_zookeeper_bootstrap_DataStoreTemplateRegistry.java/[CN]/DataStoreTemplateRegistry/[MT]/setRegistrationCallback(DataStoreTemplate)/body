{
  assertValid();
  if (!registrationCallbacks.compareAndSet(null,template))   throw new IllegalStateException("Template already set");
}
