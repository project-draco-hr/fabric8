{
  assertValid();
  DataStoreTemplate template=registrationCallbacks.getAndSet(null);
  if (template == null)   throw new IllegalStateException("Template not available");
  return template;
}
