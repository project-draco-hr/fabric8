{
  ServiceRegistration<DataStore> reg;
  DataStore ds;
synchronized (this) {
    reg=registration;
    registration=null;
    ds=dataStore;
    dataStore=null;
  }
  if (reg != null) {
    reg.unregister();
  }
  if (ds != null) {
    ds.stop();
  }
}
