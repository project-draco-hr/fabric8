{
  Map<ProfileVersionKey,Map<String,Parser>> profileArtifacts=new HashMap<ProfileVersionKey,Map<String,Parser>>();
  ProfileService profileService=fabricService.get().adapt(ProfileService.class);
  DownloadManager downloadManager=DownloadManagers.createDownloadManager(fabricService.get(),executorService);
  Container[] containers=fabricService.get().getContainers();
  for (  Container container : containers) {
    Profile[] profiles=container.getProfiles();
    boolean javaOrProcessContainer=ChildContainers.isJavaOrProcessContainer(fabricService.get(),container);
    for (    Profile profile : profiles) {
      Profile overlay=profileService.getOverlayProfile(profile);
      ProfileVersionKey key=new ProfileVersionKey(profile);
      Map<String,Parser> artifacts=null;
      if (javaOrProcessContainer) {
        List<Profile> singletonList=Collections.singletonList(profile);
        artifacts=JavaContainers.getJavaContainerArtifacts(fabricService.get(),singletonList,executorService);
      }
 else {
        artifacts=AgentUtils.getProfileArtifacts(fabricService.get(),downloadManager,overlay);
      }
      if (artifacts != null) {
        if (LOG.isDebugEnabled()) {
          LOG.debug("Profile " + profile.getId() + " maps to artefacts: "+ artifacts.keySet());
        }
        profileArtifacts.put(key,artifacts);
      }
    }
  }
  return profileArtifacts;
}
