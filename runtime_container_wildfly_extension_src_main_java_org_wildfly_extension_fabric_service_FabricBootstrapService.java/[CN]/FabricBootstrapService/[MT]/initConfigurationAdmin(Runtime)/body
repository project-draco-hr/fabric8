{
  ModuleContext syscontext=runtime.getModuleContext();
  ConfigurationAdmin configAdmin=syscontext.getService(syscontext.getServiceReference(ConfigurationAdmin.class));
  File karafEtc=new File((String)runtime.getProperty(SystemProperties.KARAF_ETC));
  FilenameFilter filter=new FilenameFilter(){
    @Override public boolean accept(    File dir,    String name){
      return name.endsWith(".cfg");
    }
  }
;
  for (  String name : karafEtc.list(filter)) {
    String pid=name.substring(0,name.length() - 4);
    try {
      FileInputStream fis=new FileInputStream(new File(karafEtc,name));
      Properties props=new Properties();
      props.load(fis);
      fis.close();
      Configuration config=configAdmin.getConfiguration(pid,null);
      config.update((Hashtable)props);
    }
 catch (    IOException ex) {
      throw new IllegalStateException(ex);
    }
  }
}
