{
  if (saslClient == null) {
    LOG.error("saslClient is unexpectedly null. Cannot respond to server's SASL message; ignoring.");
    return;
  }
  if (!(saslClient.isComplete())) {
    try {
      saslToken=createSaslToken(serverToken);
      if (saslToken != null) {
        sendSaslPacket(saslToken,cnxn);
      }
    }
 catch (    SaslException e) {
      LOG.error("SASL authentication failed using login context '" + this.getLoginContext() + "'.");
      saslState=SaslState.FAILED;
      gotLastPacket=true;
    }
  }
  if (saslClient.isComplete()) {
    if ((serverToken == null) && (saslClient.getMechanismName() == "GSSAPI"))     gotLastPacket=true;
    if (saslClient.getMechanismName() != "GSSAPI") {
      gotLastPacket=true;
    }
    cnxn.enableWrite();
  }
}
