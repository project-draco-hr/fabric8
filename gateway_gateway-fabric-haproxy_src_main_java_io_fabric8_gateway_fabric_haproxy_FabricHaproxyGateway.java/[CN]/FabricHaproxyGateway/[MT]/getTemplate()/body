{
  String oldTemplateText=templateText;
  if (templateText == null && fabricService != null) {
    Profile overlayProfile=fabricService.getCurrentContainer().getOverlayProfile();
    Profile effectiveProfile=Profiles.getEffectiveProfile(fabricService,overlayProfile);
    byte[] bytes=effectiveProfile.getFileConfiguration(TEMPLATE_FILE_NAME);
    if (bytes != null) {
      templateText=new String(bytes);
    }
  }
  Objects.notNull(templateText,"Could not find template text in profile config file: " + TEMPLATE_FILE_NAME);
  if (template == null || oldTemplateText == null || !oldTemplateText.equals(templateText)) {
    template=TemplateCompiler.compileTemplate(templateText,parserContext);
  }
  return template;
}
