{
  clear();
  getLocalIndexDir().mkdirs();
  loadDirectory(getLocalIndexDir(),err);
  for (  Map.Entry<String,URL> entry : repos.entrySet()) {
    String name=entry.getKey();
    URL url=entry.getValue();
    File file=new File(directory,"repo-" + name + ".zip");
    if ("file".equals(url.getProtocol())) {
      file=new File(url.getFile());
    }
 else {
      if (download) {
        err.println("Downloading: " + url);
        try {
          InputStream is=url.openStream();
          try {
            FileOutputStream os=new FileOutputStream(file);
            try {
              copy(is,os);
            }
  finally {
              os.close();
            }
          }
  finally {
            is.close();
          }
        }
 catch (        IOException e) {
          if (err != null) {
            err.println(String.format("Error occurred while downloading '%s'.  Error: %s",url,e));
          }
        }
      }
    }
    if (file.isDirectory()) {
      loadDirectory(file,err);
    }
 else {
      try {
        loadJar(file);
      }
 catch (      IOException e) {
        if (err != null) {
          err.println(String.format("Error occurred while loading repo '%s'.  Error: %s",name,e));
        }
      }
    }
  }
}
