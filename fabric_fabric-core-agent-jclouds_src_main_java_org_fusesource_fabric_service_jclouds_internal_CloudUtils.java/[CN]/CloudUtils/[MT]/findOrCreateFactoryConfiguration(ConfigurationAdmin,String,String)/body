{
  Configuration configuration=null;
  try {
    Configuration[] configurations=configurationAdmin.listConfigurations(String.format(FACTORY_FILTER,factoryPid));
    if (configurations != null) {
      for (      Configuration conf : configurations) {
        Dictionary dictionary=conf.getProperties();
        if (dictionary != null && provider.equals(dictionary.get("provider"))) {
          return conf;
        }
      }
    }
  }
 catch (  Exception e) {
    LOGGER.warn("Failed to lookup configuration admin for existing cloud providers.",e);
  }
  LOGGER.debug("No configuration found with factoryPid org.jclouds.compute. Creating new one.");
  configuration=configurationAdmin.createFactoryConfiguration(factoryPid,null);
  return configuration;
}
