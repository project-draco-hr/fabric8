{
  boolean result;
  if ((result=initialized.compareAndSet(false,true))) {
    PropertyUtils.setProperties(configuration,args);
    configuration.addChangeListener(this);
    apmAgentContext.initialize();
    this.strategy=new TraceStrategy(apmAgentContext,instrumentation);
    this.strategy.initialize();
    Thread cleanup=new Thread(){
      @Override public void run(){
        try {
          ApmAgent apmAgent=ApmAgent.INSTANCE;
          apmAgent.shutDown();
        }
 catch (        Exception e) {
          LOG.error("Failed to run shutdown hook",e);
        }
      }
    }
;
    Runtime.getRuntime().addShutdownHook(cleanup);
  }
  return result;
}
