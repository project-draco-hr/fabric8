{
  boolean result=false;
  if ((result=initialized.compareAndSet(false,true))) {
    this.instrumentation=instrumentation;
    cleanUp.set(false);
    this.instrumentation=instrumentation;
    PropertyUtils.setProperties(configuration,args);
    ApmAgentContext apmAgentContext=ApmAgentContext.INSTANCE;
    apmAgentContext.initialize();
    Thread cleanup=new Thread(){
      @Override public void run(){
        try {
          ApmAgent apmAgent=ApmAgent.INSTANCE;
          apmAgent.shutdowm("");
        }
 catch (        Exception e) {
          LOG.error("Failed to run shutdown hook",e);
        }
      }
    }
;
    Runtime.getRuntime().addShutdownHook(cleanup);
  }
  return result;
}
