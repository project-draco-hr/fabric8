{
  Set<String> repositoryUris=new LinkedHashSet<String>();
  Set<Repository> repositories=new LinkedHashSet<Repository>();
  Container container=fabricService.get().getCurrentContainer();
  Set<Profile> profilesWithParents=new HashSet<Profile>();
  Profile[] profiles=container.getProfiles();
  if (profiles != null) {
    for (    Profile profile : profiles) {
      addProfiles(profile,profilesWithParents);
    }
    for (    Profile profile : profilesWithParents) {
      if (profile.getRepositories() != null) {
        for (        String uri : profile.getRepositories()) {
          repositoryUris.add(uri);
          addRepositoryUri(uri,repositoryUris);
        }
      }
    }
  }
  for (  String uri : repositoryUris) {
    try {
      repositories.add(new RepositoryImpl(new URI(uri)));
    }
 catch (    URISyntaxException e) {
      LOGGER.debug("Error while adding repository with uri {}.",uri);
    }
  }
  return repositories.toArray(new Repository[repositories.size()]);
}
