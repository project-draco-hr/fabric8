{
  assertValid();
  if (repositories.isEmpty()) {
    Set<String> repositoryUris=new LinkedHashSet<String>();
    for (    String uri : getAllProfilesOverlay().getRepositories()) {
      repositoryUris.add(uri);
      addRepositoryUri(uri,repositoryUris);
    }
    for (    String uri : repositoryUris) {
      try {
        RepositoryImpl r=new RepositoryImpl(new URI(uri));
        r.load();
        repositories.add(r);
      }
 catch (      URISyntaxException e) {
        LOGGER.debug("Error while adding repository with uri {}.",uri);
      }
catch (      IOException e) {
        LOGGER.debug("Error while loading repository with uri {}.",uri);
      }
    }
  }
  return repositories.toArray(new Repository[repositories.size()]);
}
