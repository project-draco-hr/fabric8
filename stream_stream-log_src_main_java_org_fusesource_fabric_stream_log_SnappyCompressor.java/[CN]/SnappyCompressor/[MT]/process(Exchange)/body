{
  Message in=exchange.getIn();
  if (in.getBody() != null) {
    byte[] data=in.getMandatoryBody(byte[].class);
    byte[] compressed=compress(data);
    if (exchange.getPattern().isOutCapable()) {
      Message out=exchange.getOut();
      out.copyFrom(in);
      out.setBody(compressed);
    }
 else {
      in.setBody(compressed);
    }
  }
}
