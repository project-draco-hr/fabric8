{
  running=true;
  MessageConsumer consumer=null;
  try {
    consumer=service.createConsumer(dest);
    while (running && received < messageCount) {
      Message msg=consumer.receive(3000);
      if (msg != null) {
        LOG.info("Received " + ((TextMessage)msg).getText());
        received++;
      }
 else {
        if (breakOnNull) {
          break;
        }
      }
    }
  }
 catch (  JMSException e) {
    e.printStackTrace();
  }
 finally {
    if (consumer != null) {
      try {
        consumer.close();
      }
 catch (      JMSException e) {
        e.printStackTrace();
      }
    }
  }
}
