{
  try {
    final DataByteArrayInputStream bais=new DataByteArrayInputStream((Buffer)data);
    final int size=bais.readInt();
    final long correlation=bais.readVarLong();
    final UTF8Buffer service=readBuffer(bais).utf8();
    final Buffer encoded_method=readBuffer(bais);
    final ServiceFactoryHolder holder=holders.get(service);
    final Method method=holder.method(encoded_method);
    SerializationStrategy serializationStrategy=new ObjectSerializationStrategy();
    final InvocationStrategy strategy;
    if (AsyncInvocationStrategy.isAsyncMethod(method)) {
      strategy=new AsyncInvocationStrategy(serializationStrategy);
    }
 else {
      strategy=new BlockingInvocationStrategy(serializationStrategy);
    }
    final Object svc=holder.factory.get();
    Runnable task=new Runnable(){
      public void run(){
        final DataByteArrayOutputStream baos=new DataByteArrayOutputStream();
        try {
          baos.writeInt(0);
          baos.writeVarLong(correlation);
        }
 catch (        IOException e) {
          throw new RuntimeException(e);
        }
        strategy.service(holder.loader,method,svc,bais,baos,new Runnable(){
          public void run(){
            holder.factory.unget();
            final Buffer command=baos.toBuffer();
            BufferEditor editor=command.buffer().bigEndianEditor();
            editor.writeInt(command.length);
            queue.execute(new Runnable(){
              public void run(){
                transport.offer(command);
              }
            }
);
          }
        }
);
      }
    }
;
    Executor executor;
    if (svc instanceof Dispatched) {
      executor=((Dispatched)svc).getDispatchQueue();
    }
 else {
      executor=blockingExecutor;
    }
    executor.execute(task);
  }
 catch (  Exception e) {
    LOGGER.info("Error while reading request",e);
  }
}
