{
  for (  Type type : composites) {
    String sectionPackage=sanitize(sections.get(type.getName()));
    String name=toJavaClassName(type.getName());
    name=packagePrefix + "." + sectionPackage+ "."+ name;
    JDefinedClass cls=cm._getClass(name);
    if (cls == null) {
      cls=cm._class(name);
    }
    if (type.getProvides() != null && !type.getProvides().equals(type.getName())) {
      cls._implements(cm.ref(packagePrefix + ".common." + toJavaClassName(type.getProvides())));
    }
    Log.info("");
    Log.info("Generating %s",cls.binaryName());
    for (    Object obj : type.getEncodingOrDescriptorOrFieldOrChoiceOrDoc()) {
      if (obj instanceof Field) {
        Field field=(Field)obj;
        Log.info("Field name=%s type=%s",field.getName(),field.getType());
        String fieldType=field.getType();
        String fieldName=sanitize(field.getName());
        if (fieldType.equals("*") && field.getRequires() != null) {
          fieldType=packagePrefix + ".common." + toJavaClassName(field.getRequires());
          Log.info("Trying required type %s",fieldType);
        }
 else {
          while (!mapping.containsKey(fieldType)) {
            fieldType=restrictedMapping.get(fieldType);
            if (fieldType == null) {
              break;
            }
            Log.info("Trying field type %s for field %s",fieldType,fieldName);
          }
        }
        if (fieldType == null) {
          fieldType=compositeMapping.get(field.getType());
        }
        if (fieldType != null) {
          boolean array=false;
          if (field.getMultiple() != null && field.getMultiple().equals("true")) {
            array=true;
          }
          Class clazz=mapping.get(fieldType);
          JClass c=null;
          if (clazz == null) {
            c=cm._getClass(fieldType);
            if (c == null) {
              c=cm._class(fieldType);
            }
          }
 else {
            c=cm.ref(clazz.getName());
          }
          if (array) {
            c=c.array();
          }
          Log.info("%s %s",c.binaryName(),fieldName);
          cls.field(0,c,fieldName);
        }
 else {
          Log.info("Skipping field %s, type not found",field.getName());
        }
      }
    }
  }
}
