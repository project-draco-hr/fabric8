{
  System.err.println(executeCommand("fabric:create -n"));
  addStagingRepoToDefaultProfile();
  Thread.sleep(10000);
  executeCommand("mq-create --group us-east --networks us-west --create-container us-east --jmx-user admin --jmx-password admin --networks-username admin --networks-password admin --minimumInstances 1 us-east");
  executeCommand("mq-create --group us-west --networks us-east --create-container us-west --jmx-user admin --jmx-password admin --networks-username admin --networks-password admin --minimumInstances 1 us-west");
  Container container1=getFabricService().getContainer("us-east1");
  containers.add(container1);
  Container container2=getFabricService().getContainer("us-west1");
  containers.add(container2);
  Provision.containersStatus(containers,"success",PROVISION_TIMEOUT);
  containers.addAll(ContainerBuilder.create().withName("example-producer").withProfiles("example-mq-producer").withProfiles("mq-client-us-east").assertProvisioningResult().build());
  containers.addAll(ContainerBuilder.create().withName("example-consumer").withProfiles("example-mq-consumer").withProfiles("mq-client-us-west").assertProvisioningResult().build());
  Thread.sleep(10000);
  installAndCheckFeature("activemq");
  BrokerViewMBean brokerEast=(BrokerViewMBean)getMBean(container1,new ObjectName("org.apache.activemq:type=Broker,brokerName=us-east"),BrokerViewMBean.class);
  BrokerViewMBean brokerWest=(BrokerViewMBean)getMBean(container2,new ObjectName("org.apache.activemq:type=Broker,brokerName=us-west"),BrokerViewMBean.class);
  assertFalse("Messages not sent",brokerEast.getTotalEnqueueCount() == 0);
  assertFalse("Messages not received",brokerWest.getTotalDequeueCount() == 0);
}
