{
  BundleContext context=createNiceMock(BundleContext.class);
  ServiceReference reference=createNiceMock(ServiceReference.class);
  expect(context.getServiceReference("org.osgi.service.cm.ConfigurationAdmin")).andReturn(reference);
  ConfigurationAdmin admin=createNiceMock(ConfigurationAdmin.class);
  expect(context.getService(reference)).andReturn(admin);
  Configuration configuration=createNiceMock(Configuration.class);
  expect(admin.getConfiguration(PID)).andReturn(configuration);
  expect(configuration.getProperties()).andReturn(PROPERTIES).anyTimes();
  replay(context,admin,configuration);
  Dictionary properties=getProperties(context,PID);
  assertNotNull(properties);
  assertEquals(VALUE1,properties.get(KEY1));
}
