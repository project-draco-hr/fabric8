{
  assertValid();
  String containerPortsPidKeyPath=ZkPath.PORTS_CONTAINER_PID_KEY.getPath(container.getId(),pid,key);
  String ipPortsPath=ZkPath.PORTS_IP.getPath(container.getIp());
  try {
    if (interProcessLock.acquire(60,TimeUnit.SECONDS)) {
      if (exists(curator.get(),containerPortsPidKeyPath) != null) {
        int port=lookupPort(container,pid,key);
        deleteSafe(curator.get(),containerPortsPidKeyPath);
        Set<Integer> allPorts=findUsedPortByHost(container);
        allPorts.remove(port);
        StringBuilder sb=new StringBuilder();
        boolean first=true;
        for (        Integer p : allPorts) {
          if (first) {
            sb.append(p);
            first=false;
          }
 else {
            sb.append(" ").append(p);
          }
        }
        setData(curator.get(),ipPortsPath,sb.toString());
      }
    }
 else {
      throw new FabricException("Could not acquire port lock");
    }
  }
 catch (  Exception ex) {
    throw new FabricException(ex);
  }
 finally {
    releaseLock();
  }
}
