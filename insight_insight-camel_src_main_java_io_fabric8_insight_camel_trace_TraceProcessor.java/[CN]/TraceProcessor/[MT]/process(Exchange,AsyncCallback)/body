{
  if (tracer.isEnabled(exchange)) {
    try {
      int drain=queue.size() - tracer.getQueueSize();
      if (drain > 0) {
        for (int i=0; i < drain; i++) {
          queue.poll();
        }
      }
      Date timestamp=new Date();
      String toNode=processorDefinition.getId();
      String exchangeId=exchange.getExchangeId();
      String messageAsXml=MessageHelper.dumpAsXml(exchange.getIn());
      if (first) {
        Date created=exchange.getProperty(Exchange.CREATED_TIMESTAMP,timestamp,Date.class);
        String routeId=routeDefinition.getId();
        TracerEventMessage pseudo=new TracerEventMessage(tracer.incrementTraceCounter(),created,routeId,exchangeId,messageAsXml);
        queue.add(pseudo);
      }
      TracerEventMessage event=new TracerEventMessage(tracer.incrementTraceCounter(),timestamp,toNode,exchangeId,messageAsXml);
      queue.add(event);
    }
 catch (    Exception e) {
      exchange.setException(e);
      callback.done(true);
      return true;
    }
  }
  return processor.process(exchange,callback);
}
