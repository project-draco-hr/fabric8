{
  if (processor == null) {
    return null;
  }
  boolean first=false;
  RouteDefinition route=ProcessorDefinitionHelper.getRoute(definition);
  if (route != null) {
    if (routeContext.getCamelContext().getNodeIdFactory() != null) {
      RouteDefinitionHelper.forceAssignIds(routeContext.getCamelContext(),route);
    }
    if (!route.getOutputs().isEmpty()) {
      first=route.getOutputs().get(0) == definition;
    }
  }
  routeContexts.add(routeContext);
  processors.add(definition);
  return new TraceProcessor(queue,processor,definition,route,first,this);
}
