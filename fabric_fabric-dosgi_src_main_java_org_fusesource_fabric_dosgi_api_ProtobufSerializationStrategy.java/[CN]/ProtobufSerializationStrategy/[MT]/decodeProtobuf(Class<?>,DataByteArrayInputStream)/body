{
  if (!PBMessage.class.isAssignableFrom(type)) {
    throw new IllegalArgumentException("Invalid " + name() + " serialization method: method argument not a "+ PBMessage.class.getName());
  }
  PBMessageFactory factory=(PBMessageFactory)type.getEnclosingClass().getField("FACTORY").get(null);
  PBMessage msg=factory.parseUnframed(source);
  String name=type.getName();
  Object rc;
  if (name.endsWith("$Getter") || name.endsWith("$Buffer")) {
    rc=msg;
  }
 else {
    rc=msg.copy();
  }
  return rc;
}
