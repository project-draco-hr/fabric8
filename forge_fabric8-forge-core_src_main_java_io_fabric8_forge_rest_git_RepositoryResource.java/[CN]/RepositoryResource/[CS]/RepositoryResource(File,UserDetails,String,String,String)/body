{
  this.gitFolder=gitFolder;
  this.userDetails=userDetails;
  this.remoteRepository=remoteRepository;
  this.basedir=gitFolder.getParentFile();
  this.origin=origin;
  String user=userDetails.getUser();
  String authorEmail=userDetails.getEmail();
  this.personIdent=new PersonIdent(user,authorEmail);
  this.branch=branch;
  if (!gitFolder.exists() || !gitFolder.isDirectory()) {
    throw new IOException(".git folder does not exist at " + gitFolder.getPath());
  }
  FileRepositoryBuilder builder=new FileRepositoryBuilder();
  this.repository=builder.setGitDir(gitFolder).readEnvironment().findGitDir().build();
  this.git=new Git(repository);
  if (Strings.isNullOrBlank(origin)) {
    throw new IOException("Could not find remote git URL for folder " + gitFolder.getPath());
  }
  checkoutBranch();
}
