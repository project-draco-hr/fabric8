{
  File[] dirList=directory.listFiles();
  byte[] readBuffer=new byte[8192];
  int bytesIn=0;
  for (int i=0; i < dirList.length; i++) {
    File f=dirList[i];
    if (f.isDirectory()) {
      String prefix=path + f.getName() + "/";
      zos.putNextEntry(new ZipEntry(prefix));
      zipDir(f,zos,prefix,exclusions);
      continue;
    }
    String entry=path + f.getName();
    if (!exclusions.contains(entry)) {
      FileInputStream fis=new FileInputStream(f);
      try {
        ZipEntry anEntry=new ZipEntry(entry);
        zos.putNextEntry(anEntry);
        bytesIn=fis.read(readBuffer);
        while (bytesIn != -1) {
          zos.write(readBuffer,0,bytesIn);
          bytesIn=fis.read(readBuffer);
        }
      }
  finally {
        fis.close();
      }
    }
  }
}
