{
  int state=bundle.getState();
  if (state == Bundle.INSTALLED || state == Bundle.RESOLVED && !Bundles.isFragment(bundle)) {
    LOG.debug("Starting bundle %s version %s",bundle.getSymbolicName(),bundle.getVersion());
    try {
      bundle.start();
      if (startTime == 0L) {
        startTime=System.currentTimeMillis();
      }
      long end=startTime + timeout;
      while (true) {
        state=bundle.getState();
        if (state == Bundle.ACTIVE || state == Bundle.STOPPING || System.currentTimeMillis() > end) {
          break;
        }
        try {
          Thread.sleep(500L);
        }
 catch (        InterruptedException e) {
        }
      }
    }
 catch (    BundleException e) {
      System.out.println("Failed to start " + bundle.getSymbolicName() + " "+ bundle.getVersion()+ ". "+ e);
      e.printStackTrace();
    }
  }
}
