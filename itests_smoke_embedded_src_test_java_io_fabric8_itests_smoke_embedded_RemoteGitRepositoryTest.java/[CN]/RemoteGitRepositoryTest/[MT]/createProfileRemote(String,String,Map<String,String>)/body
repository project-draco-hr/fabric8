{
  checkoutRequiredBranch(versionId);
  Properties agentprops=new Properties();
  if (attributes != null) {
    for (    Entry<String,String> entry : attributes.entrySet()) {
      agentprops.setProperty(Profile.ATTRIBUTE_PREFIX + entry.getKey(),entry.getValue());
    }
  }
  File pidFile=new File(remoteRoot,"fabric/profiles/" + profileId + ".profile/"+ Constants.AGENT_PROPERTIES);
  pidFile.getParentFile().mkdirs();
  DataStoreUtils.toBytes(agentprops);
  FileOutputStream fos=new FileOutputStream(pidFile);
  try {
    fos.write(DataStoreUtils.toBytes(agentprops));
  }
  finally {
    fos.close();
  }
  git.add().addFilepattern(".").call();
  git.commit().setMessage("Create profile: " + profileId).call();
  return profileId;
}
