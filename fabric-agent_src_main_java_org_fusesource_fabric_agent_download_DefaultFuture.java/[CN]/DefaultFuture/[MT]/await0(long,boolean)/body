{
  long endTime=System.currentTimeMillis() + timeoutMillis;
synchronized (lock) {
    if (ready) {
      return ready;
    }
 else     if (timeoutMillis <= 0) {
      return ready;
    }
    waiters++;
    try {
      for (; ; ) {
        try {
          long timeOut=Math.min(timeoutMillis,DEAD_LOCK_CHECK_INTERVAL);
          lock.wait(timeOut);
        }
 catch (        InterruptedException e) {
          if (interruptable) {
            throw e;
          }
        }
        if (ready) {
          return true;
        }
 else {
          if (endTime < System.currentTimeMillis()) {
            return ready;
          }
        }
      }
    }
  finally {
      waiters--;
      if (!ready) {
        checkDeadLock();
      }
    }
  }
}
