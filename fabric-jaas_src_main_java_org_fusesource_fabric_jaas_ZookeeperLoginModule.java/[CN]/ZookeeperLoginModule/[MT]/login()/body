{
  Callback[] callbacks=new Callback[2];
  callbacks[0]=new NameCallback("Username: ");
  callbacks[1]=new PasswordCallback("Password: ",false);
  try {
    callbackHandler.handle(callbacks);
  }
 catch (  IOException ioe) {
    throw new LoginException(ioe.getMessage());
  }
catch (  UnsupportedCallbackException uce) {
    throw new LoginException(uce.getMessage() + " not available to obtain information from user");
  }
  user=((NameCallback)callbacks[0]).getName();
  char[] tmpPassword=((PasswordCallback)callbacks[1]).getPassword();
  if (tmpPassword == null) {
    tmpPassword=new char[0];
  }
  if (user == null) {
    throw new FailedLoginException("user name is null");
  }
  String password=users.getProperty(user);
  if (password == null) {
    throw new FailedLoginException("User does exist");
  }
  boolean passwordOK=false;
  if (password.startsWith("(ENC)")) {
    if (encryptor.checkPassword(new String(tmpPassword),password.substring(5))) {
      passwordOK=true;
    }
  }
 else {
    if (password.equals(new String(tmpPassword))) {
      passwordOK=true;
    }
  }
  if (!passwordOK) {
    throw new FailedLoginException("Password does not match");
  }
  loginSucceeded=true;
  if (debug) {
    LOG.debug("login " + user);
  }
  return loginSucceeded;
}
