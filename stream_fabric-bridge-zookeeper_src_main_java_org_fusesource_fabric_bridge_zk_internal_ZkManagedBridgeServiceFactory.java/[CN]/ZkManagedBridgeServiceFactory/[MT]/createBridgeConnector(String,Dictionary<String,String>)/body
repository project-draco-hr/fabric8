{
  ZkBridgeConnector bridgeConnector=new ZkBridgeConnector();
  bridgeConnector.setCurator(getZooKeeper());
  bridgeConnector.setFabricService(getFabricService());
  bridgeConnector.setId(pid);
  if (StringUtils.hasText(properties.get("versionName"))) {
    bridgeConnector.setVersionName(properties.get("versionName"));
  }
  if (StringUtils.hasText(properties.get("gatewayProfileName"))) {
    bridgeConnector.setGatewayProfileName(properties.get("gatewayProfileName"));
  }
  if (StringUtils.hasText(properties.get("gatewayConnectRetries"))) {
    bridgeConnector.setGatewayConnectRetries(Integer.parseInt(properties.get("gatewayConnectRetries")));
  }
  if (StringUtils.hasText(properties.get("gatewayStartupDelay"))) {
    bridgeConnector.setGatewayStartupDelay(Integer.parseInt(properties.get("gatewayStartupDelay")));
  }
  if (StringUtils.hasText(properties.get("inboundDestinationsRef"))) {
    bridgeConnector.setInboundDestinations(createDestinationsConfig(pid,properties.get("inboundDestinationsRef")));
  }
  if (StringUtils.hasText(properties.get("outboundDestinationsRef"))) {
    bridgeConnector.setOutboundDestinations(createDestinationsConfig(pid,properties.get("outboundDestinationsRef")));
  }
  bridgeConnector.setLocalBrokerConfig(createBrokerConfig(pid,"localBroker",properties));
  bridgeConnector.setExportedBrokerConfig(createBrokerConfig(pid,"exportedBroker",properties));
  bridgeConnector.setApplicationContext(createApplicationContext(pid));
  try {
    bridgeConnector.afterPropertiesSet();
    bridgeConnector.start();
  }
 catch (  Exception e) {
    String msg="Error starting bridge " + pid + " : "+ e.getMessage();
    LOG.error(msg);
    throw new ConfigurationException("Start",msg,e);
  }
  return bridgeConnector;
}
