{
  ServiceReference reference=bundleContext.getServiceReference(FeaturesService.class.getName());
  try {
    final FeaturesService service=(FeaturesService)bundleContext.getService(reference);
    for (    URI uri : classPathResolver.getInstallFeatureURLs()) {
      try {
        service.addRepository(uri);
      }
 catch (      Exception e) {
        LOG.warn("Unable to add feature repository URL {} - FAB {} may not get installed properly",uri,url);
      }
    }
    for (    String feature : classPathResolver.getInstallFeatures()) {
      try {
        installMissingFeature(service,feature);
      }
 catch (      Exception e) {
        LOG.warn(String.format("Unable to install missing feature %s - FAB %s may not get installed properly",feature,url),e);
      }
    }
  }
  finally {
    bundleContext.ungetService(reference);
  }
}
