{
  VersionedDependencyId id=descriptor.getId();
  remove(id);
  VersionedModule rc=new VersionedModule(descriptor,file);
  moduleVersions.put(id,rc);
  DependencyId dependencyId=id.toDependencyId();
  Module module=modules.get(dependencyId);
  if (module == null) {
    module=new Module(dependencyId);
    modules.put(dependencyId,module);
  }
  module.versions.put(id.getVersion(),rc);
  for (  VersionedDependencyId key : descriptor.getExtendsModules()) {
    TreeMap<String,VersionedModule> map=extensions.get(key);
    if (map == null) {
      map=new TreeMap<String,VersionedModule>();
      extensions.put(key,map);
    }
    map.put(rc.getName(),rc);
  }
  return rc;
}
