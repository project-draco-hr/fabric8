{
  final ProfileImpl profile=new ProfileImpl(name,version);
  profile.setBundles(template.execute(ZkPath.PROFILE_BUNDLES.getPath(version,name),new DataToUriCallback()));
  profile.setFeatures(template.execute(ZkPath.PROFILE_FEATURES.getPath(version,name),new ZooKeeperTemplate.StringArrayCallback()));
  profile.setConfigurations(template.execute(ZkPath.PROFILE_CONFIG_PIDS.getPath(version,name),new ConfigurationsCallback(version,name)));
  profile.setFeatureRepositories(template.execute(ZkPath.PROFILE_REPOSITORIES.getPath(version,name),new DataToUriCallback()));
  profile.setParents(template.execute(ZkPath.PROFILE_PARENTS.getPath(version,name),new ZooKeeperTemplate.ChildrenCallback<Profile[]>(){
    public Profile[] execute(    List<String> children) throws Exception {
      Profile[] array=new Profile[children.size()];
      int i=0;
      for (      String profileName : children) {
        if (profiles.containsKey(profileName)) {
          array[i++]=profiles.get(profileName);
        }
 else {
          array[i++]=createProfile(profiles,extensions,profileName);
        }
        if (!extensions.containsKey(profileName)) {
          extensions.put(profileName,new ArrayList<Profile>());
        }
        extensions.get(profileName).add(profile);
      }
      return array;
    }
  }
));
  return profile;
}
