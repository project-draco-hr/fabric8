{
  Object service=bundleContext.getService(reference);
  if (ConnectionStateListener.class.isAssignableFrom(service.getClass())) {
    final ConnectionStateListener listener=(ConnectionStateListener)service;
    if (curator.getZookeeperClient().isConnected()) {
      executor.submit(new Runnable(){
        @Override public void run(){
          listener.stateChanged(curator,ConnectionState.CONNECTED);
        }
      }
);
    }
    curator.getConnectionStateListenable().addListener(listener,executor);
  }
  return service;
}
