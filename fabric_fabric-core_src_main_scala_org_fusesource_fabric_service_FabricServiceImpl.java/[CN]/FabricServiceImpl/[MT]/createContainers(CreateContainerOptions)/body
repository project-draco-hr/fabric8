{
  if (options.getZookeeperUrl() == null && !options.isDebugContainer()) {
    options.setZookeeperUrl(getZookeeperUrl());
  }
  if (options.getProxyUri() == null) {
    options.setProxyUri(getMavenRepoURI());
  }
  try {
    ContainerProvider provider=getProvider(options.getProviderType());
    if (provider == null) {
      throw new FabricException("Unable to find an container provider type '" + options.getProviderType() + "'");
    }
    Container parent=options.getParent() != null ? getContainer(options.getParent()) : null;
    Set<? extends CreateContainerMetadata> createMetadata=provider.create(options);
    Container[] containers=new Container[createMetadata.size()];
    int container=0;
    for (    CreateContainerMetadata metadata : createMetadata) {
      if (!options.isEnsembleServer()) {
        createContainerConfig(parent != null ? parent.getId() : "",metadata.getContainerName());
      }
      containers[container]=new ContainerImpl(parent,metadata.getContainerName(),FabricServiceImpl.this);
      containers[container++].setCreateContainerMetadata(metadata);
    }
    return containers;
  }
 catch (  FabricException e) {
    throw e;
  }
catch (  Exception e) {
    throw new FabricException(e);
  }
}
