{
  int idx=expression.indexOf(ELVIS_OPERATOR);
  String defaultValue=null;
  String name=expression;
  if (idx > 0) {
    defaultValue=expression.substring(idx + ELVIS_OPERATOR.length());
    name=expression.substring(0,idx);
  }
  String answer=environmentVariables != null ? environmentVariables.get(name) : null;
  if (answer == null) {
    answer=System.getenv(name);
    if (answer == null) {
      return preserveUnresolved ? expression : defaultValue;
    }
  }
  return answer;
}
