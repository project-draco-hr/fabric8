{
  ProfileService profileService=fabricService.adapt(ProfileService.class);
  Map<String,Map<String,String>> answer=new HashMap<String,Map<String,String>>();
  if (profiles != null) {
    for (    Profile profile : profiles) {
      Profile overlay=profileService.getOverlayProfile(profile);
      Map<String,Map<String,String>> configurations=overlay.getConfigurations();
      Set<Entry<String,Map<String,String>>> entries=configurations.entrySet();
      for (      Entry<String,Map<String,String>> entry : entries) {
        String pid=entry.getKey();
        Map<String,String> configuration=entry.getValue();
        if (configuration != null) {
          Map<String,String> oldConfig=answer.get(pid);
          if (oldConfig == null) {
            oldConfig=new HashMap<>();
            answer.put(pid,oldConfig);
          }
          oldConfig.putAll(configuration);
        }
      }
    }
  }
  return answer;
}
