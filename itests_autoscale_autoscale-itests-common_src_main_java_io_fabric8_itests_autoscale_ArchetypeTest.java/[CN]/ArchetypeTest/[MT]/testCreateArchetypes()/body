{
  List<ArchetypeInfo> archetypes=findArchetypes();
  File mavenSettingsFile=getMavenSettingsFile();
  assertFileExists(mavenSettingsFile);
  File workDir=new File(System.getProperty("basedir","."),"target/generated-projects");
  workDir.mkdirs();
  Map<ArchetypeInfo,String> archetypeToProfileMap=new HashMap<>();
  for (  ArchetypeInfo archetype : archetypes) {
    String profileId=assertGenerateArchetype(archetype,workDir,mavenSettingsFile);
    archetypeToProfileMap.put(archetype,profileId);
  }
  FabricRequirements requirements=new FabricRequirements();
  requirements.profile("mq-default").minimumInstances(1);
  FabricAssertions.assertSetRequirementsAndTheyAreSatisfied(fabricController,requirements);
  for (  ArchetypeInfo archetype : archetypes) {
    String profileId=archetypeToProfileMap.get(archetype);
    assertNotNull("Should have a profile ID for " + archetype,profileId);
    requirements.profile(profileId).minimumInstances(1);
  }
  FabricAssertions.assertSetRequirementsAndTheyAreSatisfied(fabricController,requirements);
}
