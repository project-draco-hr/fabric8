{
  String loadBalancerType=LoadBalancers.STICKY_LOAD_BALANCER;
  int stickyLoadBalancerCacheSize=LoadBalancers.STICKY_LOAD_BALANCER_DEFAULT_CACHE_SIZE;
  LoadBalancer<ServiceDetails> serviceLoadBalancer=LoadBalancers.createLoadBalancer(loadBalancerType,stickyLoadBalancerCacheSize);
  ArrayList<Protocol> protocols=new ArrayList<Protocol>();
  protocols.add(new StompProtocol());
  protocols.add(new MqttProtocol());
  protocols.add(new AmqpProtocol());
  protocols.add(new OpenwireProtocol());
  DetectingGatewayProtocolHandler handler=new DetectingGatewayProtocolHandler();
  handler.setVertx(vertx);
  handler.setServiceMap(serviceMap);
  handler.setProtocols(protocols);
  handler.setServiceLoadBalancer(serviceLoadBalancer);
  handler.setDefaultVirtualHost("broker1");
  return new DetectingGateway(vertx,0,handler);
}
