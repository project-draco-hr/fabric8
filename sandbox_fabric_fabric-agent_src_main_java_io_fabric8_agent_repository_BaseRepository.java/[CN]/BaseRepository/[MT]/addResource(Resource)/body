{
  for (  Capability cap : resource.getCapabilities(null)) {
    String ns=cap.getNamespace();
    CapabilitySet set=capSets.get(ns);
    if (set == null) {
      if ("service-reference".equals(ns) || "osgi.service".equals(ns)) {
        set=new CapabilitySet(Collections.singletonList("objectClass"));
      }
 else {
        set=new CapabilitySet(Collections.singletonList(ns));
      }
      capSets.put(ns,set);
    }
    set.addCapability(cap);
  }
  resources.add(resource);
}
