{
  System.err.println(executeCommand("fabric:create -n"));
  ServiceProxy<FabricService> fabricProxy=ServiceProxy.createServiceProxy(bundleContext,FabricService.class);
  try {
    FabricService fabricService=fabricProxy.getService();
    CuratorFramework curator=fabricService.adapt(CuratorFramework.class);
    Set<ContainerProxy> containers=ContainerBuilder.create(fabricProxy).withName("esb").withProfiles("jboss-fuse-minimal").assertProvisioningResult().build();
    try {
      prepareFeaturesForTesting(containers,"connector","jboss-fuse-minimal","geronimo-connector");
      prepareFeaturesForTesting(containers,"saaj","jboss-fuse-minimal","saaj-impl");
      prepareFeaturesForTesting(containers,"cxf-nmr","jboss-fuse-minimal","org.apache.servicemix.cxf.binding.nmr");
      prepareFeaturesForTesting(containers,"camel-nmr","jboss-fuse-minimal","org.apache.servicemix.camel.component");
      assertFeatures(fabricService,curator);
    }
  finally {
      ContainerBuilder.destroy(containers);
    }
  }
  finally {
    fabricProxy.close();
  }
}
