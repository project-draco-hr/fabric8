{
  try {
    ServiceReference configAdminServiceReference=bundleContext.getServiceReference(ConfigurationAdmin.class.getName());
    if (configAdminServiceReference != null) {
      ConfigurationAdmin configAdmin=(ConfigurationAdmin)bundleContext.getService(configAdminServiceReference);
      if (configAdmin != null) {
        Configuration[] configuration=configAdmin.listConfigurations("(service.pid=" + Constants.AGENT_PID + ")");
        return (configuration != null && configuration.length > 0) ? configuration[0].getProperties() : null;
      }
    }
  }
 catch (  Exception e) {
    LOGGER.warn("Unable to retrieve agent configuration",e);
  }
  return null;
}
