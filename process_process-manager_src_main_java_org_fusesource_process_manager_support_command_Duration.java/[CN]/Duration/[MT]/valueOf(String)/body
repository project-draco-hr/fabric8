{
  Preconditions.checkNotNull(duration,"duration is null");
  Preconditions.checkArgument(!duration.isEmpty(),"duration is empty");
  Matcher matcher=DURATION_PATTERN.matcher(duration);
  if (!matcher.matches()) {
    throw new IllegalArgumentException("duration is not a valid duration string: " + duration);
  }
  String magnitudeString=matcher.group(1);
  double magnitude=Double.parseDouble(magnitudeString);
  String timeUnitString=matcher.group(2);
  TimeUnit timeUnit;
  if (timeUnitString.equals("ms")) {
    timeUnit=TimeUnit.MILLISECONDS;
  }
 else   if (timeUnitString.equals("s")) {
    timeUnit=TimeUnit.SECONDS;
  }
 else   if (timeUnitString.equals("m")) {
    timeUnit=TimeUnit.MINUTES;
  }
 else   if (timeUnitString.equals("h")) {
    timeUnit=TimeUnit.HOURS;
  }
 else   if (timeUnitString.equals("d")) {
    timeUnit=TimeUnit.DAYS;
  }
 else {
    throw new IllegalArgumentException("Unknown time unit: " + timeUnitString);
  }
  return new Duration(magnitude,timeUnit);
}
