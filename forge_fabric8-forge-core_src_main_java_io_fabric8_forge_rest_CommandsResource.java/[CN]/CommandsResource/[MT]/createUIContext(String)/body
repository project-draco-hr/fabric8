{
  AddonRegistry addonRegistry=furnace.getAddonRegistry();
  Imported<ResourceFactory> resourceFactoryImport=addonRegistry.getServices(ResourceFactory.class);
  ResourceFactory resourceFactory=null;
  try {
    resourceFactory=resourceFactoryImport.get();
  }
 catch (  Exception e) {
    LOG.warn("Failed to get ResourceFactory injected: " + e,e);
  }
  if (resourceFactory == null) {
    resourceFactory=resourceFactoryImport.get();
  }
  Resource<?> selection=null;
  if (Strings.isNotBlank(resourcePath) && resourceFactory != null) {
    String path=Strings.stripPrefix(resourcePath,"/");
    String userFolder="user/";
    if (path.startsWith(userFolder)) {
      path=Strings.stripPrefix(path,userFolder);
      String[] userAndPath=path.split("/",2);
      if (userAndPath.length < 2) {
        LOG.warn("Could not extract user name and path from resource: " + resourcePath);
      }
 else {
        String userId=userAndPath[0];
        String repositoryName=userAndPath[1];
        UserDetails userDetails=gitUserHelper.createUserDetails(request);
        File file=projectFileSystem.cloneOrPullProjetFolder(userId,repositoryName,userDetails);
        selection=resourceFactory.create(file);
      }
    }
 else {
      LOG.warn("Unknown path of the form user/{userId}/{repositoryName}");
      throw new RuntimeException("Expected path of the form user/{userId}/{repositoryName} but got: " + path);
    }
  }
  return new RestUIContext(selection);
}
