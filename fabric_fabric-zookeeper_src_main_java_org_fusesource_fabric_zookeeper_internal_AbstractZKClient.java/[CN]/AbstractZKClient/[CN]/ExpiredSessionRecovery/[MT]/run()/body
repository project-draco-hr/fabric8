{
  LOG.info("Entering recovery mode");
synchronized (_lock) {
    try {
      int count=0;
      while (_state == OsgiZkClient.State.NONE) {
        try {
          count++;
          LOG.warn("Recovery mode: trying to reconnect to zookeeper [" + count + "]");
          AbstractZKClient.this.connect();
        }
 catch (        Throwable e) {
          LOG.warn("Recovery mode: reconnect attempt failed [" + count + "]... waiting for "+ _reconnectTimeout,e);
          try {
            _lock.wait(_reconnectTimeout.getDurationInMilliseconds());
          }
 catch (          InterruptedException e1) {
            throw new RuntimeException("Recovery mode: wait interrupted... bailing out",e1);
          }
        }
      }
    }
  finally {
      _expiredSessionRecovery=null;
      LOG.info("Exiting recovery mode.");
    }
  }
}
