{
  List<Version> versions;
  if (version != null && !version.isEmpty()) {
    versions=Collections.singletonList(fabricService.getVersion(version));
  }
 else   if (allVersions) {
    versions=Arrays.asList(fabricService.getVersions());
  }
 else {
    versions=Collections.singletonList(fabricService.getDefaultVersion());
  }
  username=username != null && !username.isEmpty() ? username : ShellUtils.retrieveFabricUser(session);
  password=password != null ? password : ShellUtils.retrieveFabricUserPassword(session);
  for (  Version version : versions) {
    fabricService.getPatchService().applyPatch(version,patch,username,password);
  }
  return null;
}
