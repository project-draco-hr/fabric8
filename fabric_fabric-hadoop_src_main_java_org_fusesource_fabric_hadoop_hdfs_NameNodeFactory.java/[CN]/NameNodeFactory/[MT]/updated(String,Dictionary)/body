{
  ClassLoader oldTccl=Thread.currentThread().getContextClassLoader();
  try {
    Thread.currentThread().setContextClassLoader(getClass().getClassLoader());
    deleted(pid);
    Configuration conf=new Configuration();
    for (Enumeration e=properties.keys(); e.hasMoreElements(); ) {
      Object key=e.nextElement();
      Object val=properties.get(key);
      conf.set(key.toString(),val.toString());
    }
    boolean exists=false;
    for (    File file : FSNamesystem.getNamespaceDirs(conf)) {
      exists|=file.exists();
    }
    if (!exists) {
      NameNode.format(conf);
    }
    NameNode nameNode=NameNode.createNameNode(null,conf);
    nameNodes.put(pid,nameNode);
    services.put(pid,bundleContext.registerService(NameNode.class.getName(),nameNode,properties));
  }
 catch (  Exception e) {
    throw (ConfigurationException)new ConfigurationException(null,"Unable to parse HDFS configuration: " + e.getMessage()).initCause(e);
  }
 finally {
    Thread.currentThread().setContextClassLoader(oldTccl);
  }
}
