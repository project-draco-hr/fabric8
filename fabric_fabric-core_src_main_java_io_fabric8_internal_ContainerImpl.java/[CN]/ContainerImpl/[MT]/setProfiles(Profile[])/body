{
  String versionId=dataStore.getContainerVersion(id);
  List<String> currentProfileIds=dataStore.getContainerProfiles(id);
  List<String> profileIds=new ArrayList<String>();
  if (profiles != null) {
    for (    Profile profile : profiles) {
      IllegalArgumentAssertion.assertTrue(versionId.equals(profile.getVersion()),"Version mismatch setting profile " + profile + ", expected version "+ versionId);
      IllegalArgumentAssertion.assertFalse(profile.isAbstract(),"The profile " + profile + " is abstract and can not be associated to containers");
      IllegalArgumentAssertion.assertFalse(profile.getId().matches(ENSEMBLE_PROFILE_PATTERN) && !currentProfileIds.contains(profile.getId()),"The profile " + profile + " is not assignable.");
      profileIds.add(profile.getId());
    }
  }
  if (profileIds.isEmpty()) {
    profileIds.add(ZkDefs.DEFAULT_PROFILE);
  }
  dataStore.setContainerProfiles(id,profileIds);
}
